<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="FLIPPED Android">
<meta name="description" content="The higher I got, the more amazed I was by the view.">
<meta name="theme-color" content="#000">
<title>Hello Gridea | Flipped&#39;s Blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1697116290420">
<link rel="stylesheet" href="/media/css/gemini.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/default.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>





  <meta name="description" content="Hello Gridea" />
  <meta name="keywords" content="Gridea" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="gemini">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>Flipped&#39;s Blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">The higher I got, the more amazed I was by the view.</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> å…³äº
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹æƒ…é“¾æ¥
                  
                </a>
              </li>
            
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">æœç´¢</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout gemini ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">æ–‡ç« ç›®å½•</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">ç«™ç‚¹æ¦‚è§ˆ</span>
          </div>
        </div>
      
      <div class="sidebar-body gemini" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Flipped</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">23</span>
        <span class="site-item-stat-name language" data-lan="article">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">9</span>
        <span class="site-item-stat-name language" data-lan="category">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">9</span>
        <span class="site-item-stat-name language" data-lan="tag">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            <a href="">
              <i class="fa " title=""></i>
            </a>
          
        
        
      </div>
    </div>
  



</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E7%89%B9%E6%80%A7">ç‰¹æ€§ğŸ‘‡</a></li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // ä¿å­˜liå…ƒç´ 
      if (elem.children[0] && elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // å¤„ç†ä¸æ˜¯ä»#ä¸€çº§æ ‡é¢˜å¼€å§‹ç›®å½•
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://flipped94.github.io/post/hello-gridea/">
      Hello Gridea
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">å‘å¸ƒäº</span>
      <span class="publish-time" data-t="2018-12-12 00:00:00">2018-12-12</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show language" data-lan="category-in">åˆ†ç±»äº</span>
      
      
      <a href="https://flipped94.github.io/tag/FPbhuH0jn/">
        <span>Gridea</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>2<span class="language" data-lan="minute">åˆ†é’Ÿ</span></span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>298<span class="pc-show language" data-lan="words">å­—æ•°</span></span>
    </span>
    
  </div>
</section>
            <div class="post-body next-md-body" id="post_body">
              <p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>

            </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">æœ¬æ–‡ä½œè€…ï¼š</strong>
      Flipped
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://flipped94.github.io/post/hello-gridea/" title="Hello Gridea">https://flipped94.github.io/post/hello-gridea/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://flipped94.github.io/tag/FPbhuH0jn/"># Gridea</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
    </div>
    <div class="nav-next">
      
    </div>
  </div>
</div>
            
            
  <script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<div id="vcomments" style="padding: 10px 0px 0px 0px"></div>

<style>
  .v .veditor {
    min-height: 10rem;
    background-image: url('');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: right;
    background-color: rgba(255, 255, 255, 0);
    resize: none;
  }

  .v .vwrap {
    border: 1px solid #000 !important;
  }

  .v .vbtn {
    padding: .4rem 1.2rem !important;
    border-color: #fff !important;
    background-color: #49b1f5 !important;
    color: #fff !important;
    font-size: .7rem !important;
  }

  .v .vcards .vcard .vh .vmeta .vat {
    padding: 0 .8rem !important;
    border: 1px solid #00c4b6 !important;
    border-radius: 5px !important;
    color: #00c4b6 !important;
  }
</style>
<script>
  new Valine({
    el: '#vcomments',
    appId: 'DGyCPKITbi6q4QfsWGStzRf5-gzGzoHsz',
    appKey: 'NVlEHSP0PUlYakIMkKvt1LRL',
    avatar: '',
    placeholder: '',
    pageSize: '',
    lang: 'zh-cn',
    enableQQ: 'true' === 'false',
    visitor: 'true' === 'false',
    highlight: 'true' === 'true',
    avatarForce: 'true' === 'false',
  });
</script>

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a
        href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      
    </div>
  </footer>
  
  
  <div class="gemini back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
    back2TopText = document.querySelector('#back_to_top_text'),
    drawerBox = document.querySelector('#drawer_box'),
    rightSideBar = document.querySelector('.sidebar'),
    viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {

    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener('scroll', function (e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });


  let hasCacu = false;
  window.onresize = function () {
    calcuHeight();
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, transitionDir, {});
          }
        })
        window.Velocity(viewport, openProp, {
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp, {
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target", "_blank");
      }
    })
  }

  let faSearch = document.querySelector('#fa_search');
  faSearch.addEventListener('click', function () {
    document.querySelector('#search_mask').style = ''
  })

  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();
  
  // ç¦»å¼€å½“å‰é¡µtitleå˜åŒ–
  var leaveTitle = "";
  if (leaveTitle) {
    document.addEventListener('visibilitychange', function () {
      if (document.visibilityState == 'hidden') {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px;border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p>
      <p class="reward-tip">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        window.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        window.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        window.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        window.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      window.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      window.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

<div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="æœç´¢">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">æ¡ç›¸å…³æ¡ç›®ï¼Œä½¿ç”¨äº†</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">æ¯«ç§’</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/jr1KpXQgr/"" data-c="
          &lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•æ­å»º Redis é›†ç¾¤ã€ä¸é›†ç¾¤äº¤äº’ã€é‡æ–°åˆ†ç‰‡ã€æ•…éšœè½¬ç§»ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‡†å¤‡å·¥ä½œ&#34;&gt;å‡†å¤‡å·¥ä½œ&lt;/h3&gt;
&lt;p&gt;è¦åˆ›å»º Redis é›†ç¾¤ï¼Œé¦–å…ˆéœ€è¦æœ‰ä¸€äº›ä»¥é›†ç¾¤æ¨¡å¼è¿è¡Œçš„ç©º Redis å®ä¾‹ã€‚ä¸‹é¢æ˜¯ä»¥é›†ç¾¤æ¨¡å¼è¿è¡Œ Redis å®ä¾‹çš„æœ€å°åŒ–é…ç½®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-properties&#34;&gt;port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¦å¯ç”¨é›†ç¾¤æ¨¡å¼ï¼Œéœ€å°† &lt;code&gt;cluster-enabled&lt;/code&gt; æŒ‡ä»¤è®¾ç½®ä¸º &amp;quot;yes&amp;quot;ã€‚ æ¯ä¸ªå®ä¾‹è¿˜åŒ…å«å­˜å‚¨è¯¥èŠ‚ç‚¹é…ç½®çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º nodes.confã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶ç”± Redis é›†ç¾¤çš„èŠ‚ç‚¹è‡ªè¡Œåˆ›å»ºå’Œæ›´æ–°ï¼Œä¸èƒ½æ‰‹åŠ¨åœ°å»ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæœ€å°çš„é›†ç¾¤éœ€è¦æœ€å°‘ï¼“ä¸ªä¸»èŠ‚ç‚¹ï¼Œå»ºè®®é…ç½®ï¼–ä¸ªèŠ‚ç‚¹ï¼šï¼“ä¸ªä¸»èŠ‚ç‚¹å’Œï¼“ä¸ªä»èŠ‚ç‚¹ã€‚åœ¨æœ¬åœ°å¯ä»¥é€šè¿‡ç›®å½•å’Œç«¯å£åŒºåˆ†èŠ‚ç‚¹ï¼Œè¿›è¡Œéƒ¨ç½²æµ‹è¯•ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir cluster-test
cd cluster-test
mkdir 7000 7001 7002 7003 7004 7005
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ 7000-7005 çš„æ¯ä¸ªç›®å½•ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ redis.confï¼Œå†…å®¹å°±ç”¨ä¸Šé¢çš„æœ€ç®€é…ç½®åšæ¨¡æ¿ï¼Œæ³¨æ„ä¿®æ”¹ç«¯å£å·ä¸ºæ–‡ä»¶å¤¹åç§°ã€‚ç„¶åæ‰“å¼€ 6 ä¸ªç»ˆç«¯ï¼Œåœ¨æ¯ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ä¸€ä¸ªå®ä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd 7000
../redis-server ./redis.conf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»æ—¥å¿—ä¸­çœ‹åˆ°æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸ºè‡ªå·±åˆ†é…äº†ä¸€ä¸ªæ–° IDï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;12678:M 12 Oct 2023 10:12:05.847 * No cluster configuration found, I&#39;m 5d35bda6ad172d2bef65791657065794c2b06225
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªIDå°†ä¸€ç›´è¢«æ­¤èŠ‚ç‚¹ä½¿ç”¨ï¼Œä½œä¸ºæ­¤èŠ‚ç‚¹åœ¨æ•´ä¸ªé›†ç¾¤ä¸­çš„å”¯ä¸€æ ‡è¯†ã€‚èŠ‚ç‚¹åŒºåˆ†å…¶ä»–èŠ‚ç‚¹ä¹Ÿæ˜¯é€šè¿‡æ­¤IDæ¥æ ‡è¯†ï¼Œè€ŒéIPæˆ–ç«¯å£ã€‚IPå¯ä»¥æ”¹ï¼Œç«¯å£å¯ä»¥æ”¹ï¼Œä½†æ­¤IDä¸èƒ½æ”¹ï¼Œç›´åˆ°è¿™ä¸ªèŠ‚ç‚¹ç¦»å¼€é›†ç¾¤ã€‚è¿™ä¸ªIDç§°ä¹‹ä¸ºèŠ‚ç‚¹ID(Node ID)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­å»ºé›†ç¾¤&#34;&gt;æ­å»ºé›†ç¾¤&lt;/h3&gt;
&lt;p&gt;ç»è¿‡ä¸Šä¸€æ­¥éª¤ï¼Œç°åœ¨å·²ç»è¿è¡Œäº† 6 ä¸ª Redis å®ä¾‹ï¼Œè¿˜éœ€è¦é€šè¿‡å‘èŠ‚ç‚¹å†™å…¥ä¸€äº›é…ç½®æ¥åˆ›å»ºé›†ç¾¤ã€‚è¿™é‡Œåªä»‹ç» &lt;code&gt;redis-cli&lt;/code&gt; åˆ›å»ºé›†ç¾¤ï¼ˆredisæºç  utils/create-clusterç›®å½•ä¸­çš„create-clusterè„šæœ¬ä¹Ÿå¯ä»¥åˆ›å»ºé›†ç¾¤ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 \
127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \
--cluster-replicas 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;create&lt;/code&gt; å‘½ä»¤æ˜¯åˆ›å»ºæ–°çš„é›†ç¾¤ã€‚ é€‰é¡¹ &lt;code&gt;--cluster-replicas 1&lt;/code&gt; è¡¨ç¤ºä¸ºæ¯ä¸€ä¸ªä¸»æœåŠ¡å™¨é…ä¸€ä¸ªé‡æœåŠ¡å™¨ã€‚å…¶ä½™çš„å‚æ•°æ˜¯è¦åˆ›å»ºçš„é›†ç¾¤ä¸­å„å®ä¾‹çš„åœ°å€åˆ—è¡¨&lt;/p&gt;
&lt;p&gt;redis-cli å‘½ä»¤ä¼šç»™å‡ºä¸€ä¸ªé…ç½®ã€‚ è¾“å…¥ &amp;quot;yes&amp;quot; æ¥å—é…ç½®ã€‚ é›†ç¾¤ä¼šè¢«é…ç½®å¹¶å½¼æ­¤è¿æ¥å¥½ï¼Œæ„æ€æ˜¯å„èŠ‚ç‚¹å®ä¾‹è¢«å¼•å¯¼å½¼æ­¤é€šè¯å¹¶æœ€ç»ˆå½¢æˆé›†ç¾¤ã€‚æœ€åï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;[OK] All 16384 slots covered.
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ä¸é›†ç¾¤äº¤äº’&#34;&gt;ä¸é›†ç¾¤äº¤äº’&lt;/h3&gt;
&lt;p&gt;è¦è¿æ¥åˆ° Redis é›†ç¾¤ï¼Œéœ€è¦ä¸€ä¸ªæ”¯æŒé›†ç¾¤çš„ Redis å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨ &lt;code&gt;redis-cli&lt;/code&gt; æµ‹è¯• Redis é›†ç¾¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ redis-cli -c -p 7000
127.0.0.1:7000&amp;gt; set foo bar
-&amp;gt; Redirected to slot [12182] located at 127.0.0.1:7002
OK
127.0.0.1:7002&amp;gt; set hello world
-&amp;gt; Redirected to slot [866] located at 127.0.0.1:7000
OK
127.0.0.1:7000&amp;gt; get foo
-&amp;gt; Redirected to slot [12182] located at 127.0.0.1:7002
&amp;quot;bar&amp;quot;
127.0.0.1:7002&amp;gt; get hello
-&amp;gt; Redirected to slot [866] located at 127.0.0.1:7000
&amp;quot;world&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;redis-cli&lt;/code&gt; é›†ç¾¤åŠŸèƒ½æ”¯æŒéå¸¸åŸºç¡€ï¼Œå®ƒåˆ©ç”¨ Redis é›†ç¾¤èŠ‚ç‚¹èƒ½å¤Ÿå°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°æ­£ç¡®èŠ‚ç‚¹ï¼ˆä¾‹å¦‚set foo å’Œ get foo é‡å®šå‘åˆ°äº† 7002 èŠ‚ç‚¹ï¼‰ã€‚ æ›´å¥½çš„å®¢æˆ·ç«¯èƒ½å¤Ÿç¼“å­˜å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹åœ°å€ä¹‹é—´çš„æ˜ å°„ï¼Œç›´æ¥ä½¿ç”¨æ­£ç¡®è¿æ¥ï¼Œä»…å½“é›†ç¾¤é…ç½®å‘ç”Ÿæ›´æ”¹æ—¶ï¼ˆä¾‹å¦‚æ•…éšœè½¬ç§»åæˆ–ç³»ç»Ÿç®¡ç†å‘˜é€šè¿‡æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹æ›´æ”¹é›†ç¾¤å¸ƒå±€åï¼‰ï¼Œæ‰ä¼šåˆ·æ–°æ˜ å°„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬ä¸€ä¸ªç¤ºä¾‹åº”ç”¨&#34;&gt;ç¬¬ä¸€ä¸ªç¤ºä¾‹åº”ç”¨&lt;/h3&gt;
&lt;p&gt;åœ¨æ¼”ç¤ºå¦‚ä½•æ“ä½œ Redis é›†ç¾¤ã€æ‰§è¡Œæ•…éšœè½¬ç§»æˆ–é‡æ–°åˆ†ç‰‡ç­‰æ“ä½œä¹‹å‰ï¼Œéœ€è¦ä¸€äº›ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œæˆ–è€…è‡³å°‘èƒ½å¤Ÿç†è§£ç®€å•çš„ Redis é›†ç¾¤å®¢æˆ·ç«¯äº¤äº’çš„è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚ç”¨ä¸¤ä¸ªç¤ºä¾‹åº”ç”¨ä»‹ç» &lt;a href=&#34;https://github.com/antirez/redis-rb-cluster&#34;&gt;redis-rb-cluster&lt;/a&gt;çš„åŸºæœ¬ç”¨æ³•ã€‚ç¬¬ä¸€ä¸ªæ˜¯ redis-rb-cluster åº“ä¸­çš„ example.rb æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;require &#39;./cluster&#39;

if ARGV.length != 2
    startup_nodes = [
        {:host =&amp;gt; &amp;quot;127.0.0.1&amp;quot;, :port =&amp;gt; 6379},
        {:host =&amp;gt; &amp;quot;127.0.0.1&amp;quot;, :port =&amp;gt; 6380}
    ]
else
    startup_nodes = [
        {:host =&amp;gt; ARGV[0], :port =&amp;gt; ARGV[1].to_i}
    ]
end

rc = RedisCluster.new(startup_nodes,32,:timeout =&amp;gt; 0.1)

last = false

while not last
    begin
        last = rc.get(&amp;quot;__last__&amp;quot;)
        last = 0 if !last
    rescue =&amp;gt; e
        puts &amp;quot;error #{e.to_s}&amp;quot;
        sleep 1
    end
end

((last.to_i+1)..1000000000).each{|x|
    begin
        rc.set(&amp;quot;foo#{x}&amp;quot;,x)
        puts rc.get(&amp;quot;foo#{x}&amp;quot;)
        rc.set(&amp;quot;__last__&amp;quot;,x)
    rescue =&amp;gt; e
        puts &amp;quot;error #{e.to_s}&amp;quot;
    end
    sleep 0.1
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¯¥åº”ç”¨åšäº†ä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹ä¸€äº›å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;SET foo0 0
SET foo1 1
SET foo2 2
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿è¡Œè¯¥åº”ç”¨ä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;ruby ./example.rb
1
2
3
4
5
6
7
8
9
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªåº”ç”¨åšçš„äº‹æƒ…è™½ç„¶ç®€å•ï¼Œä½†æ˜¯é€šè¿‡å®ƒå¯ä»¥çœ‹åˆ°é‡æ–°åˆ†ç‰‡æœŸé—´ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;é‡æ–°åˆ†ç‰‡&#34;&gt;é‡æ–°åˆ†ç‰‡&lt;/h3&gt;
&lt;p&gt;ç°åœ¨å‡†å¤‡å°è¯•é›†ç¾¤é‡æ–°åˆ†ç‰‡ï¼Œé¡»ä¿æŒ example.rb ç¨‹åºè¿è¡Œï¼Œä»¥ä¾¿æŸ¥çœ‹æ˜¯å¦å¯¹ç¨‹åºè¿è¡Œäº§ç”Ÿä¸€äº›å½±å“ã€‚ å¦å¤–ï¼Œå¯ä»¥æ³¨é‡Š sleep è°ƒç”¨ï¼Œä»¥ä¾¿åœ¨é‡æ–°åˆ†ç‰‡æœŸé—´äº§ç”Ÿæ›´å¤§çš„å†™å…¥è´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;é‡æ–°åˆ†ç‰‡åŸºæœ¬ä¸Šæ„å‘³ç€å°†å“ˆå¸Œæ§½ä»ä¸€ç»„èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ç»„èŠ‚ç‚¹ã€‚ ä¸é›†ç¾¤åˆ›å»ºä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ &lt;code&gt;redis-cli&lt;/code&gt;å®Œæˆã€‚&lt;br&gt;
åªéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¼€å§‹é‡æ–°åˆ†ç‰‡ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster reshard 127.0.0.1:7000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åªéœ€è¦æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œ&lt;code&gt;redis-cli&lt;/code&gt; ä¼šè‡ªåŠ¨æ‰¾åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚&lt;br&gt;
ç›®å‰ï¼Œ&lt;code&gt;redis-cli&lt;/code&gt; åªèƒ½åœ¨ç®¡ç†å‘˜æ”¯æŒä¸‹è¿›è¡Œé‡æ–°åˆ†ç‰‡ï¼Œä¸èƒ½åªæ˜¯è¯´å°† 5% çš„æ§½ä»è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä½†è¿™å®ç°èµ·æ¥éå¸¸ç®€å•ï¼‰ã€‚ redis-cli ä¼šé—®å‡ ä¸ªé—®é¢˜ã€‚ ç¬¬ä¸€ä¸ªæ˜¯æƒ³è¦å¤šå°‘æ§½é‡æ–°åˆ†ç‰‡ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;How many slots do you want to move (from 1 to 16384)?
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥å°è¯•é‡æ–°åˆ†ç‰‡ 1000 ä¸ªå“ˆå¸Œæ§½ï¼Œå¦‚æœ example.rb åœ¨æ²¡æœ‰ sleep è°ƒç”¨çš„æƒ…å†µä¸‹ä»åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›æ§½åº”è¯¥å·²ç»åŒ…å«äº†å¤§é‡çš„é”®ã€‚&lt;/p&gt;
&lt;p&gt;redis-cli éœ€è¦çŸ¥é“é‡æ–°åˆ†ç‰‡çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå³æ¥æ”¶å“ˆå¸Œæ§½çš„èŠ‚ç‚¹ã€‚é€šè¿‡èŠ‚ç‚¹ ID æŒ‡å®šå®ä¾‹èŠ‚ç‚¹ï¼ˆè¿™é‡Œä½¿ç”¨ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°èŠ‚ç‚¹çš„ IDï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli -p 7000 cluster nodes | grep myself 
5d35bda6ad172d2bef65791657065794c2b06225 127.0.0.1:7000@17000 myself,master - 0 1697080901000 1 connected 0-5460
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œç›®æ ‡èŠ‚ç‚¹æ˜¯ &amp;quot;5d35bda6ad172d2bef65791657065794c2b062&amp;quot;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œç³»ç»Ÿä¼šè¯¢é—®æƒ³è¦ä»å“ªäº›èŠ‚ç‚¹è·å–è¿™äº› keyã€‚ åªéœ€è¾“å…¥ &amp;quot;all&amp;quot; å³å¯ä»æ‰€æœ‰å…¶ä»–ä¸»èŠ‚ç‚¹è·å–å“ˆå¸Œæ§½ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆç¡®è®¤åï¼Œå°†çœ‹åˆ°æ¯ä¸ªæ’æ§½çš„æ¶ˆæ¯ï¼Œè¡¨æ˜å°†ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å½“é‡æ–°åˆ†ç‰‡æ­£åœ¨è¿›è¡Œæ—¶ï¼Œåº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ç¤ºä¾‹ç¨‹åºçš„è¿è¡Œä¸å—å½±å“ã€‚ å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨é‡æ–°åˆ†ç‰‡æœŸé—´å¤šæ¬¡åœæ­¢å¹¶é‡æ–°å¯åŠ¨å®ƒã€‚é‡æ–°åˆ†ç‰‡ç»“æŸåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•é›†ç¾¤çš„å¥åº·çŠ¶å†µï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster check 127.0.0.1:7000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æ‰€æœ‰å“ˆå¸Œæ§½çš„åˆ†å¸ƒï¼Œä½†è¿™æ¬¡ä¸»èŠ‚ç‚¹ 127.0.0.1:7000 å°†æ‹¥æœ‰æ›´å¤šå“ˆå¸Œæ’æ§½ï¼Œçº¦ä¸º 6461 ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å­—æ®µè¿›è¡Œé‡æ–°åˆ†ç‰‡ï¼Œè€Œæ— éœ€ä»¥äº¤äº’æ–¹å¼æ‰‹åŠ¨è¾“å…¥å‚æ•°ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster reshard &amp;lt;host&amp;gt;:&amp;lt;port&amp;gt; --cluster-from &amp;lt;node-id&amp;gt; --cluster-to &amp;lt;node-id&amp;gt; --cluster-slots &amp;lt;number of slots&amp;gt; --cluster-yes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœå¯èƒ½ç»å¸¸é‡æ–°åˆ†ç‰‡ï¼Œè¿™ä¸ªç»™å‘½ä»¤æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯ç›®å‰ redis-cli æ— æ³•è‡ªåŠ¨é‡æ–°å¹³è¡¡é›†ç¾¤ï¼Œæ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹ä¸Šé”®çš„åˆ†å¸ƒå¹¶æ ¹æ®éœ€è¦æ™ºèƒ½åœ°ç§»åŠ¨å“ˆå¸Œæ§½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--cluster-yes&lt;/code&gt; é€‰é¡¹è¡¨ç¤ºé›†ç¾¤ç®¡ç†å™¨è‡ªåŠ¨å¯¹è¯¢é—®å›ç­”â€œæ˜¯â€ï¼Œä»è€Œä»¥éäº¤äº’æ¨¡å¼è¿è¡Œã€‚ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® &lt;code&gt;REDISCLI_CLUSTER_YES&lt;/code&gt; ç¯å¢ƒå˜é‡æ¥æ¿€æ´»æ­¤é€‰é¡¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬äºŒä¸ªç¤ºä¾‹åº”ç”¨&#34;&gt;ç¬¬äºŒä¸ªç¤ºä¾‹åº”ç”¨&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºä¸æ˜¯å¾ˆå®Œç¾ã€‚å®ƒåªæ˜¯ç®€å•å†™æ•°æ®ï¼Œæ²¡æœ‰æ£€æŸ¥å†™å…¥çš„å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚ä»æˆ‘ä»¬çš„è§’åº¦æ¥çœ‹ï¼Œæ€»æ˜¯å¯ä»¥å°† key &amp;quot;foo&amp;quot; çš„æ¯ä¸ªå†™æ“ä½œéƒ½å†™å…¥ 42ã€‚åœ¨ redis-rb-cluster åº“ä¸­ï¼Œæœ‰ä¸€ä¸ªæ›´æœ‰è¶£çš„åº”ç”¨ consistency-test.rb ã€‚ å®ƒä½¿ç”¨äº†ä¸€äº›è®¡æ•°å™¨ï¼ˆé»˜è®¤ä¸º 1000ï¼‰ï¼Œå¹¶å‘é€ &lt;code&gt;INCR&lt;/code&gt; å‘½ä»¤å¯¹è®¡æ•°å™¨è¿›è¡Œè‡ªå¢ã€‚è¯¥åº”ç”¨è¿˜åšäº†ä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´æ–°è®¡æ•°å™¨æ—¶ï¼Œä¼šä¿å­˜è¯¥å†™å…¥ã€‚&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡å†™å…¥ä¹‹å‰è¯»å–è®¡æ•°å™¨ï¼Œå¹¶å°†å…¶ä¸å†…å­˜ä¸­çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæ£€æŸ¥è¯¥å€¼æ˜¯å¦æ˜¯æˆ‘ä»¬æœŸæœ›çš„å€¼ï¼Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ„å‘³ç€è¯¥åº”ç”¨æ˜¯ä¸€ä¸ªç®€å•çš„ä¸€è‡´æ€§æ£€æŸ¥å™¨ï¼Œå¹¶ä¸”èƒ½å¤ŸçŸ¥é“é›†ç¾¤æ˜¯å¦ä¸¢å¤±äº†æŸäº›å†™å…¥ï¼Œæˆ–è€…å®ƒæ˜¯å¦æ¥å—äº†æœªæ”¶åˆ°ç¡®è®¤çš„å†™å…¥ã€‚ åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œä¼šçœ‹åˆ°è®¡æ•°å™¨çš„å€¼å°äºä¿å­˜çš„å†™å…¥ï¼Œè€Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œè¯¥å€¼ä¼šæ›´å¤§ã€‚&lt;/p&gt;
&lt;p&gt;è¿è¡Œè¯¥åº”ç”¨æ¯ç§’ä¼šäº§ç”Ÿä¸€è¡Œè¾“å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ruby consistency-test.rb 127.0.0.1 7000
925 R (0 err) | 925 W (0 err) |
5030 R (0 err) | 5030 W (0 err) |
9261 R (0 err) | 9261 W (0 err) |
13517 R (0 err) | 13517 W (0 err) |
17780 R (0 err) | 17780 W (0 err) |
22025 R (0 err) | 22025 W (0 err) |
25818 R (0 err) | 25818 W (0 err) |
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¯¥è¡Œæ˜¾ç¤ºæ‰§è¡Œçš„è¯»å– ï¼ˆRï¼‰å’Œå†™å…¥ï¼ˆWï¼‰æ¬¡æ•°ä»¥åŠé”™è¯¯ï¼ˆç”±äºç³»ç»Ÿä¸å¯ç”¨ï¼Œå› æ­¤ç”±äºé”™è¯¯è€Œæœªæ¥å—æŸ¥è¯¢ï¼‰æ•°ï¼ˆerrï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå‘ç°æŸäº›ä¸ä¸€è‡´ï¼Œåˆ™ä¼šå°†æ–°è¡Œæ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç¨‹åºè¿è¡Œæ—¶æ‰‹åŠ¨é‡ç½®è®¡æ•°å™¨ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ redis-cli -h 127.0.0.1 -p 7000 set key_217 0
OK

(in the other tab I see...)

94774 R (0 err) | 94774 W (0 err) |
98821 R (0 err) | 98821 W (0 err) |
102886 R (0 err) | 102886 W (0 err) | 114 lost |
107046 R (0 err) | 107046 W (0 err) | 114 lost |
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å½“å°†è®¡æ•°å™¨è®¾ç½®ä¸º 0 æ—¶ï¼Œå®é™…å€¼ä¸º 114ï¼Œå› æ­¤åº”ç”¨æŠ¥å‘Š 114 ä¸ªä¸¢å¤±çš„å†™å…¥ï¼ˆé›†ç¾¤æœªè®°ä½çš„ INCR å‘½ä»¤ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç¨‹åºä¹Ÿä¼šå®ƒæ¥æµ‹è¯• Redis é›†ç¾¤æ•…éšœè½¬ç§»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµ‹è¯•æ•…éšœè½¬ç§»&#34;&gt;æµ‹è¯•æ•…éšœè½¬ç§»&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½® enable-debug-command yesï¼Œç„¶åé‡å¯&lt;/strong&gt;ï¼Œæ‰èƒ½æ‰§è¡Œ &lt;code&gt;debug segfault&lt;/code&gt;ã€‚&lt;br&gt;
è§¦å‘æ•…éšœè½¬ç§»ï¼Œæœ€ç®€å•çš„ï¼ˆè¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¯èƒ½å‘ç”Ÿçš„è¯­ä¹‰ä¸Šæœ€ç®€å•çš„æ•…éšœï¼‰æ˜¯ä½¿å•ä¸ªè¿›ç¨‹å´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ä¸»èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ redis-cli -p 7000 cluster nodes | grep master
5d35bda6ad172d2bef65791657065794c2b06225 127.0.0.1:7000@17000 myself,master - 0 1697091768000 7 connected 0-5961 10923-11421
2a4af186044cf3a0264e90d20a8ebce778a79df1 127.0.0.1:7002@17002 master - 0 1697091768000 3 connected 11422-16383
9ee6e1a99dc0e1a6aa41666f70a3132bd2fa6e41 127.0.0.1:7001@17001 master - 0 1697091767571 2 connected 5962-10922
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° 7000ã€7001ã€7002 æ˜¯ä¸»èŠ‚ç‚¹ï¼Œç„¶åï¼Œä½¿ç”¨ &lt;code&gt;DEBUG SEGAULT&lt;/code&gt; å‘½ä»¤ä½¿ä¸»èŠ‚ç‚¹ 7002 å´©æºƒï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ redis-cli -p 7002 debug segfault
Error: Server closed the connection
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥æŸ¥çœ‹ä¸€è‡´æ€§æµ‹è¯•çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;18849 R (0 err) | 18849 W (0 err) |
23151 R (0 err) | 23151 W (0 err) |
27302 R (0 err) | 27302 W (0 err) |
...
29659 R (578 err) | 29660 W (577 err) |
33749 R (578 err) | 33750 W (577 err) |
37918 R (578 err) | 37919 W (577 err) |
42077 R (578 err) | 42078 W (577 err) |
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨æ•…éšœè½¬ç§»æœŸé—´ï¼Œç³»ç»Ÿæ— æ³•æ¥å— 578 æ¬¡è¯»å–å’Œ 577 æ¬¡å†™å…¥ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­æ²¡æœ‰å‡ºç°ä¸ä¸€è‡´æƒ…å†µã€‚ è¿™å¬èµ·æ¥å¯èƒ½å‡ºä¹æ„æ–™ï¼Œå› ä¸ºåœ¨æœ¬æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å‡º Redis é›†ç¾¤å¯èƒ½ä¼šåœ¨æ•…éšœè½¬ç§»æœŸé—´ä¸¢å¤±å†™å…¥ï¼Œå› ä¸ºå®ƒä½¿ç”¨å¼‚æ­¥å¤åˆ¶ã€‚ æ²¡æœ‰è¯´çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå› ä¸º Redis å‡ ä¹åŒæ—¶å‘å®¢æˆ·ç«¯å‘é€å›å¤ï¼Œå¹¶å°†å¤åˆ¶å‘½ä»¤å‘é€åˆ°å‰¯æœ¬ï¼Œå› æ­¤ä¸¢å¤±æ•°æ®çš„çª—å£éå¸¸å°ã€‚ ä½†å¾ˆéš¾è§¦å‘å¹¶ä¸æ„å‘³ç€ä¸å¯èƒ½ï¼Œæ‰€ä»¥è¿™å¹¶ä¸ä¼šæ”¹å˜ Redis é›†ç¾¤æä¾›çš„ä¸€è‡´æ€§ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥æ£€æŸ¥æ•…éšœè½¬ç§»åçš„é›†ç¾¤è®¾ç½®æ˜¯ä»€ä¹ˆï¼ˆè¯·æ³¨æ„ï¼ŒåŒæ—¶é‡æ–°å¯åŠ¨äº†å´©æºƒçš„å®ä¾‹ï¼Œä»¥ä¾¿å®ƒä½œä¸ºå‰¯æœ¬é‡æ–°åŠ å…¥é›†ç¾¤ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$  redis-cli -p 7000 cluster nodes
bcfdb9cb8cea74d4392512e5ce9d1595f78b58b7 127.0.0.1:7003@17003 slave 9ee6e1a99dc0e1a6aa41666f70a3132bd2fa6e41 0 1697092771903 2 connected
514272b9dcd053f2ec4ff62a268fa2eeb1f93dbd 127.0.0.1:7005@17005 slave 5d35bda6ad172d2bef65791657065794c2b06225 0 1697092770000 7 connected
5d35bda6ad172d2bef65791657065794c2b06225 127.0.0.1:7000@17000 myself,master - 0 1697092771000 7 connected 0-5961 10923-11421
2a4af186044cf3a0264e90d20a8ebce778a79df1 127.0.0.1:7002@17002 slave 58680287a896d053b2a1005f2ff6a91cdafc604a 0 1697092771402 8 connected
58680287a896d053b2a1005f2ff6a91cdafc604a 127.0.0.1:7004@17004 master - 0 1697092771000 8 connected 11422-16383
9ee6e1a99dc0e1a6aa41666f70a3132bd2fa6e41 127.0.0.1:7001@17001 master - 0 1697092770000 2 connected 5962-10922
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸»æœåŠ¡å™¨åœ¨ç«¯å£ 7000ã€7001 å’Œ 7004 ä¸Šè¿è¡Œã€‚ä»¥å‰çš„ä¸»æœåŠ¡å™¨ï¼ˆå³åœ¨ç«¯å£ 7002 ä¸Šè¿è¡Œçš„ Redis å®ä¾‹ï¼‰ç°åœ¨æ˜¯ 7004 çš„å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CLUSTER NODES&lt;/code&gt; å‘½ä»¤çš„è¾“å‡ºå¯èƒ½çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®é™…ä¸Šéå¸¸ç®€å•ï¼Œå¹¶ä¸”ç”±ä»¥ä¸‹æ ‡è®°ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹ID&lt;/li&gt;
&lt;li&gt;IP:ç«¯å£&lt;/li&gt;
&lt;li&gt;æ ‡å¿—ï¼šä¸»ã€ä»ã€è‡ªå·±ã€å¤±è´¥&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ä»ï¼Œåˆ™ä¸ºä¸»èŠ‚ç‚¹çš„èŠ‚ç‚¹ ID&lt;/li&gt;
&lt;li&gt;æœ€åä¸€æ¬¡ç­‰å¾… PING ç­‰å¾…å›å¤çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åæ”¶åˆ° PONG çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;è¯¥èŠ‚ç‚¹çš„é…ç½®çºªå…ƒï¼ˆè¯·å‚é˜…é›†ç¾¤è§„èŒƒï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åˆ°è¯¥èŠ‚ç‚¹çš„è¿æ¥çš„çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å“ˆå¸Œæ§½&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ‰‹åŠ¨æ•…éšœè½¬ç§»&#34;&gt;æ‰‹åŠ¨æ•…éšœè½¬ç§»&lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶ï¼Œå¼ºåˆ¶æ•…éšœè½¬ç§»è€Œä¸ä¼šå¯¹ä¸»èŠ‚ç‚¹é€ æˆä»»ä½•é—®é¢˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ ä¾‹å¦‚ï¼Œè¦å‡çº§ä¸»èŠ‚ç‚¹çš„ Redis è¿›ç¨‹ï¼Œæœ€å¥½å¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå°†å…¶è½¬å˜ä¸ºå‰¯æœ¬ï¼ŒåŒæ—¶å¯¹å¯ç”¨æ€§çš„å½±å“æœ€å°ã€‚&lt;/p&gt;
&lt;p&gt;Redis é›†ç¾¤æ”¯æŒä½¿ç”¨ &lt;code&gt;CLUSTER FAILOVER&lt;/code&gt; å‘½ä»¤è¿›è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œè¯¥å‘½ä»¤å¿…é¡»åœ¨è¦è¿›è¡Œæ•…éšœè½¬ç§»çš„ä¸»èŠ‚ç‚¹çš„å‰¯æœ¬ä¹‹ä¸€ä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ‰‹åŠ¨æ•…éšœè½¬ç§»å¾ˆç‰¹æ®Šï¼Œå¹¶ä¸”ä¸å®é™…ä¸»æ•…éšœå¯¼è‡´çš„æ•…éšœè½¬ç§»ç›¸æ¯”æ›´å®‰å…¨ã€‚ å®ƒä»¬ä»¥ä¸€ç§é¿å…æ•…éšœè½¬ç§»è¿‡ç¨‹ä¸­æ•°æ®ä¸¢å¤±çš„æ–¹å¼è¿›è¡Œï¼Œä»…å½“ç³»ç»Ÿç¡®å®šæ–°ä¸»èŠ‚ç‚¹å¤„ç†äº†æ—§ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å¤åˆ¶æ—¶ï¼Œæ‰åˆ‡æ¢ä¸»ä»ã€‚&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»æ—¶åœ¨å‰¯æœ¬æ—¥å¿—ä¸­å°†çœ‹åˆ°æ—¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;# Manual failover user request accepted.
# Received replication offset for paused master manual failover: 347540
# All master replication stream processed, manual failover can start.
# Start of election delayed for 0 milliseconds (rank #0, offset 347540).
# Starting a failover election for epoch 7545.
# Failover election won: I&#39;m the new master.
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ·»åŠ èŠ‚ç‚¹&#34;&gt;æ·»åŠ èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;æ·»åŠ æ–°èŠ‚ç‚¹çš„ç¬¬ä¸€æ­¥æ˜¯æ·»åŠ ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œç„¶åå°†ä¸€äº›æ•°æ®ç§»å…¥å…¶ä¸­ï¼ˆå¦‚æœå®ƒæ˜¯æ–°ä¸»èŠ‚ç‚¹ï¼‰ï¼Œæˆ–è€…å‘Šè¯‰å®ƒè®¾ç½®ä¸ºå·²çŸ¥èŠ‚ç‚¹çš„å‰¯æœ¬ï¼ˆå¦‚æœå®ƒæ˜¯å‰¯æœ¬ï¼‰ã€‚è¿™é‡Œä¼šå±•ç¤ºæ·»åŠ ä¸»ä»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ·»åŠ ä¸»èŠ‚ç‚¹&#34;&gt;æ·»åŠ ä¸»èŠ‚ç‚¹ã€‚&lt;/h4&gt;
&lt;p&gt;åœ¨ç»ˆç«¯ä¸­æ‰“å¼€ä¸€ä¸ªæ–° tabï¼Œè¿›å…¥ cluster-test ç›®å½•ï¼Œåˆ›å»ºåä¸º 7006 çš„ç›®å½•ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ª redis.conf æ–‡ä»¶ï¼Œä¸å…¶ä»–èŠ‚ç‚¹ä½¿ç”¨çš„æ–‡ä»¶ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ 7006 ä½œä¸ºç«¯å£å·ã€‚æœ€åä½¿ç”¨ &lt;code&gt;redis-server redis.conf&lt;/code&gt; å¯åŠ¨æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œä½¿ç”¨ redis-cli æ¥å°†èŠ‚ç‚¹æ·»åŠ åˆ°ç°æœ‰é›†ç¾¤ä¸­ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;add-node&lt;/code&gt; å‘½ä»¤åŠ å…¥é›†ç¾¤ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–°èŠ‚ç‚¹çš„åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€‚&lt;br&gt;
ç°åœ¨å¯ä»¥è¿æ¥åˆ°æ–°èŠ‚ç‚¹æ¥çœ‹çœ‹å®ƒæ˜¯å¦çœŸçš„åŠ å…¥äº†é›†ç¾¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ redis-cli -h 127.0.0.1 -p 7006
127.0.0.1:7006&amp;gt; cluster nodes
5d35bda6ad172d2bef65791657065794c2b06225 127.0.0.1:7000@17000 master - 0 1697094039602 7 connected 0-5961 10923-11421
58680287a896d053b2a1005f2ff6a91cdafc604a 127.0.0.1:7004@17004 master - 0 1697094039501 8 connected 11422-16383
2a4af186044cf3a0264e90d20a8ebce778a79df1 127.0.0.1:7002@17002 slave,fail - 1697093742395 0 0 disconnected
9ee6e1a99dc0e1a6aa41666f70a3132bd2fa6e41 127.0.0.1:7001@17001 master - 0 1697094040000 2 connected 5962-10922
57e63c3535f293425cc6573d15b24fa38920ae22 127.0.0.1:7006@17006 myself,master - 0 1697094040000 0 connected
514272b9dcd053f2ec4ff62a268fa2eeb1f93dbd 127.0.0.1:7005@17005 slave 5d35bda6ad172d2bef65791657065794c2b06225 0 1697094039602 7 connected
bcfdb9cb8cea74d4392512e5ce9d1595f78b58b7 127.0.0.1:7003@17003 slave 9ee6e1a99dc0e1a6aa41666f70a3132bd2fa6e41 0 1697094040605 2 connected
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ³¨æ„ï¼Œç”±äºè¯¥èŠ‚ç‚¹å·²ç»è¿æ¥åˆ°é›†ç¾¤ï¼Œå› æ­¤å®ƒå·²ç»èƒ½å¤Ÿæ­£ç¡®é‡å®šå‘å®¢æˆ·ç«¯æŸ¥è¯¢ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†ã€‚ ä½†ä¸å…¶ä¸»èŠ‚ç‚¹ç›¸æ¯”ï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸åŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒä¸ä¿å­˜ä»»ä½•æ•°æ®ï¼Œå› ä¸ºå®ƒæ²¡æœ‰åˆ†é…å“ˆå¸Œæ§½ã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ²¡æœ‰åˆ†é…å“ˆå¸Œæ§½çš„masterï¼Œæ‰€ä»¥å½“replicaæƒ³è¦æˆä¸ºmasteræ—¶ï¼Œå®ƒä¸å‚ä¸é€‰ä¸¾è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚åŒå‰é¢é‡æ–°åˆ†ç‰‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ redis-cli çš„é‡æ–°åˆ†ç‰‡åŠŸèƒ½å°†å“ˆå¸Œæ§½åˆ†é…ç»™è¯¥èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ·»åŠ ä»èŠ‚ç‚¹&#34;&gt;æ·»åŠ ä»èŠ‚ç‚¹&lt;/h4&gt;
&lt;p&gt;æ·»åŠ æ–°å‰¯æœ¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ‰§è¡Œã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ redis-cliï¼Œå¹¶ä¸”ä½¿ç”¨ &lt;code&gt;--cluster-slave&lt;/code&gt; é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7000 --cluster-slave
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ­¤å¤„çš„å‘½ä»¤ä¸æ·»åŠ ä¸»èŠ‚ç‚¹å‘½ä»¤ç›¸åŒï¼Œå› æ­¤æ²¡æœ‰æŒ‡å®šè¯¥èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œredis-cli ä¼šå°†æ–°èŠ‚ç‚¹æ·»åŠ ä¸ºä»èŠ‚ç‚¹è¾ƒå°‘çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‡å®šæˆä¸ºæŒ‡å®šä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7000 --cluster-slave --cluster-master-id 5d35bda6ad172d2bef65791657065794c2b06225
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ç§»é™¤èŠ‚ç‚¹&#34;&gt;ç§»é™¤èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;è¦åˆ é™¤å‰¯æœ¬èŠ‚ç‚¹ï¼Œåªéœ€ä½¿ç”¨ redis-cli çš„ &lt;code&gt;del-node&lt;/code&gt; å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli --cluster del-node 127.0.0.1:7000 `&amp;lt;node-id&amp;gt;`
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦å¾…åˆ é™¤èŠ‚ç‚¹çš„ IDã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼åˆ é™¤ä¸»èŠ‚ç‚¹ï¼Œä½†æ˜¯å®ƒå¿…é¡»ä¸ºç©ºä¸»èŠ‚ç‚¹ã€‚ å¦‚æœä¸»èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™åœ¨åˆ é™¤ä¹‹å‰é¡»å°†å…¶æ•°æ®é‡æ–°åˆ†ç‰‡åˆ°æ‰€æœ‰å…¶ä»–ä¸»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤ä¸»èŠ‚ç‚¹çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¯¹å…¶æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œå¹¶åœ¨è¯¥èŠ‚ç‚¹å˜æˆæ–°ä¸»èŠ‚ç‚¹çš„å‰¯æœ¬ååˆ é™¤è¯¥èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‰¯æœ¬è¿ç§»&#34;&gt;å‰¯æœ¬è¿ç§»&lt;/h3&gt;
&lt;p&gt;æœ‰ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œå¸Œæœ›å‰¯æœ¬è‡ªåŠ¨ä»ä¸€ä¸ªä¸»èŠ‚ç‚¹è¿ç§»åˆ°å¦ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œè€Œæ— éœ€ç³»ç»Ÿç®¡ç†å‘˜çš„å¸®åŠ©ã€‚å‰¯æœ¬çš„è‡ªåŠ¨é‡æ–°é…ç½®ç§°ä¸ºå‰¯æœ¬è¿ç§»ï¼Œèƒ½å¤Ÿæé«˜Redisé›†ç¾¤çš„å¯é æ€§ã€‚åœ¨ Redis é›†ç¾¤ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä»èŠ‚ç‚¹é…ç½®ä¸ºå¦ä¸€ä¸ªä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;CLUSTER REPLICATE &amp;lt;master-node-id&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¸Œæœ›è®©é›†ç¾¤å‰¯æœ¬ä»ä¸€ä¸ªä¸»èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå› ä¸ºé€šå¸¸ Redis é›†ç¾¤å¯¹æ•…éšœçš„æŠµæŠ—èƒ½åŠ›ä¸å®šä¸»èŠ‚ç‚¹çš„å‰¯æœ¬æ•°é‡ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸»èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼ŒåŒäº‹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤å°†æ— æ³•ç»§ç»­æ“ä½œï¼Œå› ä¸ºæ²¡æœ‰å…¶ä»–å®ä¾‹æœ‰ä¸»èŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¯é æ€§ï¼Œå¯ä»¥é€‰æ‹©å‘æ¯ä¸ªä¸»èŠ‚ç‚¹æ·»åŠ é¢å¤–çš„å‰¯æœ¬ï¼Œä½†è¿™å¾ˆæ˜‚è´µã€‚ å‰¯æœ¬è¿ç§»å…è®¸å‘ä¸€äº›ä¸»èŠ‚ç‚¹æ·»åŠ é¢å¤–å‰¯æœ¬ã€‚ ä¾‹å¦‚ï¼Œæœ‰ 10 ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹æœ‰ 1 ä¸ªå‰¯æœ¬ï¼Œæ€»å…± 20 ä¸ªå®ä¾‹ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥æ·»åŠ  3 ä¸ªå®ä¾‹ä½œä¸ºæŸäº›ä¸»å®ä¾‹çš„å‰¯æœ¬ï¼Œå³æŸäº›ä¸»å®ä¾‹å°†æ‹¥æœ‰å¤šä¸ªå‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å‰¯æœ¬è¿ç§»ï¼Œå¯ä»¥å…·æœ‰å¤šä¸ªå‰¯æœ¬çš„ä¸»èŠ‚ç‚¹ä¸­çš„å‰¯æœ¬è¿ç§»åˆ°æ²¡æœ‰å‰¯æœ¬çš„ä¸»èŠ‚ç‚¹ï¼Œä½œä¸ºå…¶å‰¯æœ¬ã€‚ å› æ­¤ï¼Œå½“å‰¯æœ¬åœ¨å‡Œæ™¨ 4 ç‚¹å‡ºç°æ•…éšœåï¼Œå¦ä¸€ä¸ªå‰¯æœ¬å°†å–ä»£å®ƒï¼Œå¹¶ä¸”å½“ä¸»æœåŠ¡å™¨åœ¨å‡Œæ™¨ 5 ç‚¹ä¹Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œä»ç„¶å¯ä»¥é€‰ä¸¾ä¸€ä¸ªå‰¯æœ¬ï¼Œä»¥ä¾¿é›†ç¾¤å¯ä»¥ç»§ç»­è¿è¡Œ æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå‰¯æœ¬è¿ç§»ï¼Œä»¥ä¸‹ä¸‰ç‚¹éœ€è¦äº†è§£&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é›†ç¾¤å°†å°è¯•ä»æ‹¥æœ‰æœ€å¤šå‰¯æœ¬æ•°çš„ä¸»èŠ‚ç‚¹è¿ç§»å‰¯æœ¬&lt;/li&gt;
&lt;li&gt;è¦ä»å‰¯æœ¬è¿ç§»ä¸­å—ç›Šï¼Œåªéœ€å‘é›†ç¾¤ä¸­çš„æŸä¸ªä¸»èŠ‚ç‚¹æ·»åŠ æ›´å¤šå‰¯æœ¬&lt;/li&gt;
&lt;li&gt;cluster-migration-barrieré…ç½®æ§åˆ¶å‰¯æœ¬è¿ç§»åŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å‡çº§-redis-é›†ç¾¤ä¸­çš„èŠ‚ç‚¹&#34;&gt;å‡çº§ Redis é›†ç¾¤ä¸­çš„èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;å‡çº§å‰¯æœ¬èŠ‚ç‚¹å¾ˆå®¹æ˜“ï¼Œå› ä¸ºåªéœ€åœæ­¢èŠ‚ç‚¹å¹¶ä½¿ç”¨æ›´æ–°ç‰ˆæœ¬çš„ Redis é‡æ–°å¯åŠ¨å®ƒã€‚ å¦‚æœå­˜åœ¨ä½¿ç”¨å‰¯æœ¬èŠ‚ç‚¹è¯»å–çš„å®¢æˆ·ç«¯ï¼Œåˆ™å½“å‰¯æœ¬ä¸å¯ç”¨æ—¶ï¼Œå®ƒä»¬åº”è¯¥èƒ½å¤Ÿé‡æ–°è¿æ¥åˆ°å…¶ä»–å‰¯æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å‡çº§åˆ™ç¨æ˜¾å¤æ‚ï¼Œå»ºè®®çš„è¿‡ç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ CLUSTER FAILOVER è§¦å‘ä¸»èŠ‚ç‚¹åˆ°å…¶å‰¯æœ¬ä¹‹ä¸€çš„æ‰‹åŠ¨æ•…éšœè½¬ç§»ã€‚&lt;/li&gt;
&lt;li&gt;ç­‰å¾…ä¸»èŠ‚ç‚¹å˜æˆä»èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;æœ€ååƒå‡çº§å‰¯æœ¬ä¸€æ ·å‡çº§èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœå¸Œæœ›ä¸»èŠ‚ç‚¹æˆä¸ºåˆšåˆšå‡çº§çš„èŠ‚ç‚¹ï¼Œè¯·è§¦å‘æ–°çš„æ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œä»¥ä¾¿å°†å‡çº§åçš„èŠ‚ç‚¹æ¢å¤ä¸ºä¸»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§æ­¤è¿‡ç¨‹ï¼Œä¾æ¬¡å‡çº§ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°å‡çº§æ‰€æœ‰èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿ç§»åˆ°-redis-é›†ç¾¤&#34;&gt;è¿ç§»åˆ° Redis é›†ç¾¤&lt;/h3&gt;
&lt;p&gt;æ„¿æ„è¿ç§»åˆ° Redis é›†ç¾¤çš„ç”¨æˆ·å¯èƒ½åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œæˆ–è€…å¯èƒ½å·²ç»ä½¿ç”¨äº†é¢„å…ˆå­˜åœ¨çš„åˆ†ç‰‡è®¾ç½®ï¼Œå…¶ä¸­key åœ¨ N ä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†é…ï¼Œä½¿ç”¨ä¸€äº›å†…éƒ¨ç®—æ³•æˆ–ç”±å…¶å®¢æˆ·ç«¯åº“æˆ– Redis ä»£ç†å®ç°çš„åˆ†ç‰‡ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥è½»æ¾è¿ç§»åˆ° Redis é›†ç¾¤ï¼Œä½†æœ€é‡è¦çš„ç»†èŠ‚æ˜¯åº”ç”¨ç¨‹åºæ˜¯å¦ä½¿ç”¨å¤š key æ“ä½œä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚ å­˜åœ¨ä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ä½¿ç”¨å¤šä¸ª key æ“ä½œã€äº‹åŠ¡ã€æˆ–æ¶‰åŠå¤šä¸ª key çš„ Lua è„šæœ¬ï¼ˆå³ä½¿é€šè¿‡äº‹åŠ¡æˆ– Lua è„šæœ¬å°†å¤šä¸ªå‘½ä»¤ï¼ˆå…³äºåŒä¸€ keyï¼‰åˆ†ç»„åœ¨ä¸€èµ·è¿›è¡Œè®¿é—®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¶‰åŠå¤šä¸ª key çš„å¤šä¸ªæ“ä½œã€äº‹åŠ¡ã€ Lua è„šæœ¬ï¼Œä½†ä»…é™äºå…·æœ‰ç›¸åŒå“ˆå¸Œæ ‡ç­¾çš„ keyï¼Œè¿™æ„å‘³ç€ä¸€èµ·ä½¿ç”¨çš„é”®éƒ½å…·æœ‰æ°å¥½ç›¸åŒçš„ {...} å­å­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚ï¼ŒSUNION {user:1000}.foo {user:1000}.bar æ˜¯åœ¨åŒä¸€å“ˆå¸Œæ ‡ç­¾çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ã€‚&lt;/li&gt;
&lt;li&gt;å¤šä¸ª key æ“ä½œã€äº‹åŠ¡æˆ–æ¶‰åŠå¤šä¸ªé”®çš„ Lua è„šæœ¬ä¸ä¸å…·æœ‰æ˜¾å¼æˆ–ç›¸åŒå“ˆå¸Œæ ‡ç­¾çš„ key ä¸€èµ·ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸‰ç§æƒ…å†µä¸æ˜¯ç”± Redis é›†ç¾¤å¤„ç†çš„ï¼šéœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºï¼Œä¸ä½¿ç”¨å¤š key æ“ä½œæˆ–ä»…åœ¨åŒä¸€å“ˆå¸Œæ ‡ç­¾çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾é¢„å…ˆå­˜åœ¨çš„æ•°æ®é›†æ‹†åˆ†ä¸º N ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é¢„å…ˆå­˜åœ¨çš„åˆ†ç‰‡ï¼Œåˆ™ N=1ï¼Œåˆ™éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ‰èƒ½å°†æ•°æ®é›†è¿ç§»åˆ° Redis é›†ç¾¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœæ­¢å®¢æˆ·ç«¯ã€‚ ç›®å‰æ— æ³•è‡ªåŠ¨å®æ—¶è¿ç§»åˆ° Redis é›†ç¾¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ BGREWRITEAOF å‘½ä»¤ä¸ºæ‰€æœ‰ N ä¸ª master ç”Ÿæˆ AOF æ–‡ä»¶ï¼ˆaof-1~ aof-nï¼‰ï¼Œå¹¶ç­‰å¾… AOF æ–‡ä»¶å®Œå…¨ç”Ÿæˆã€‚&lt;/li&gt;
&lt;li&gt;å°† AOF æ–‡ä»¶ ä¿å­˜åˆ°æŸå¤„ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªç”± N ä¸ªä¸»èŠ‚ç‚¹å’Œ 0 ä¸ªå‰¯æœ¬èŠ‚ç‚¹ç»„æˆçš„ Redis é›†ç¾¤ã€‚ ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹éƒ½ä½¿ç”¨ AOF æŒä¹…åŒ–æ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;åœæ­¢æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ï¼Œæ›¿æ¢å®ƒä»¬çš„ AOF æ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä½¿ç”¨ aof-1ï¼Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä½¿ç”¨ aof-2ï¼Œä»¥æ­¤ç±»æ¨ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ–°çš„ AOF æ–‡ä»¶é‡æ–°å¯åŠ¨ Redis é›†ç¾¤èŠ‚ç‚¹ã€‚ä¼šæç¤ºæœ‰äº› key æ ¹æ®èŠ‚ç‚¹çš„é…ç½®ä¸åº”è¯¥åœ¨è¯¥èŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;redis-cli --cluster fix&lt;/code&gt; å‘½ä»¤ä¿®å¤é›†ç¾¤ï¼Œä»¥ä¾¿æ ¹æ®å“ˆå¸Œæ§½æ¥è¿ç§» keyã€‚&lt;/li&gt;
&lt;li&gt;æœ€åä½¿ç”¨ &lt;code&gt;redis-cli --cluster check&lt;/code&gt; ç¡®ä¿é›†ç¾¤æ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;é‡æ–°å¯åŠ¨ä¿®æ”¹ä¸ºä½¿ç”¨ Redis é›†ç¾¤æ„ŸçŸ¥å®¢æˆ·ç«¯åº“çš„å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§å°†æ•°æ®ä»å¤–éƒ¨å®ä¾‹å¯¼å…¥åˆ° Redis é›†ç¾¤çš„æ›¿ä»£æ–¹æ³•ï¼Œå³ä½¿ç”¨ &lt;code&gt;redis-cli --cluster import&lt;/code&gt; å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å‘½ä»¤å°†æ­£åœ¨è¿è¡Œçš„å®ä¾‹çš„æ‰€æœ‰ keyï¼ˆä»æºå®ä¾‹ä¸­åˆ é™¤keyï¼‰ç§»åŠ¨åˆ°æŒ‡å®šçš„é¢„å…ˆå­˜åœ¨çš„ Redis é›†ç¾¤ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ Redis 2.8 å®ä¾‹ä½œä¸ºæºå®ä¾‹ï¼Œæ“ä½œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› ä¸º 2.8 æ²¡æœ‰å®ç°è¿ç§»è¿æ¥ç¼“å­˜ï¼Œå› æ­¤å¯èƒ½éœ€è¦ä½¿ç”¨ Redis 3.x ç‰ˆæœ¬é‡æ–°å¯åŠ¨æºå®ä¾‹æ‰èƒ½æ‰§è¡Œæ­¤ç±»æ“ä½œã€‚&lt;/p&gt;
">Redis é›†ç¾¤ï¼ˆ2ï¼‰æ­å»ºé›†ç¾¤</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/qMbMReIQX/"" data-c="
          &lt;p&gt;Redis é›†ç¾¤æä¾›äº†ä¸€ç§æ•°æ®åœ¨å¤šä¸ª Redis èŠ‚ç‚¹ä¹‹é—´è‡ªåŠ¨åˆ†ç‰‡å­˜å‚¨çš„è¿è¡Œæ¨¡å¼ã€‚Redis é›†ç¾¤æ¨¡å¼æä¾›ä¸€å®šç¨‹åº¦çš„é«˜å¯ç”¨ï¼šåœ¨æŸäº›èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæˆ–æ— æ³•é€šä¿¡æ—¶ä»ç„¶å¯ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‘ç”Ÿæ›´å¤§çš„æ•…éšœï¼ˆä¾‹å¦‚ï¼Œå½“å¤§å¤šæ•°ä¸»èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼‰ï¼Œé›†ç¾¤å°†åœæ­¢æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå€ŸåŠ© Redis é›†ç¾¤ï¼Œå¯ä»¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªåŠ¨å°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;å½“éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœæˆ–æ— æ³•ä¸é›†ç¾¤çš„å…¶ä½™èŠ‚ç‚¹é€šä¿¡æ—¶ä»ç„¶å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;redis-é›†ç¾¤-tcp-ç«¯å£&#34;&gt;Redis é›†ç¾¤ TCP ç«¯å£&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ª Redis é›†ç¾¤èŠ‚ç‚¹éƒ½éœ€è¦ä¸¤ä¸ªæ‰“å¼€çš„ TCP è¿æ¥ï¼šä¸€ä¸ªä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡çš„ç«¯å£ï¼ˆä¾‹å¦‚ 6379ï¼‰å’Œä¸€ä¸ªé›†ç¾¤æ€»çº¿ç«¯å£ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤æ€»çº¿ç«¯å£æ˜¯å‰è€…æ¥å£+10000ï¼ˆä¾‹å¦‚16379ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤æ€»çº¿æ˜¯ä¸€ç§ä½¿ç”¨äºŒè¿›åˆ¶åè®®çš„èŠ‚ç‚¹åˆ°èŠ‚ç‚¹çš„é€šä¿¡é€šé“ï¼Œç”±äºå¸¦å®½å’Œå¤„ç†æ—¶é—´è¾ƒå°ï¼Œæ›´é€‚åˆåœ¨èŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¿¡æ¯ã€‚ èŠ‚ç‚¹ä½¿ç”¨é›†ç¾¤æ€»çº¿è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒç­‰ã€‚ å®¢æˆ·ç«¯æ°¸è¿œä¸åº”å°è¯•ä¸é›†ç¾¤æ€»çº¿ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œè€Œåº”ä½¿ç”¨å®¢æˆ·ç«¯é€šä¿¡ç«¯å£ã€‚ éœ€è¦ç¡®ä¿åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾è¿™ä¸¤ä¸ªç«¯å£ï¼Œå¦åˆ™ Redis é›†ç¾¤èŠ‚ç‚¹å°†æ— æ³•é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿ Redis é›†ç¾¤æ­£å¸¸å·¥ä½œï¼ŒèŠ‚ç‚¹ç«¯å£éœ€è¦éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯é€šä¿¡ç«¯å£ï¼ˆä¾‹å¦‚6379ï¼‰éœ€è¦å¼€æ”¾ç»™æ‰€æœ‰ä¸é›†ç¾¤äº¤äº’çš„å®¢æˆ·ç«¯å’Œé›†ç¾¤å†…çš„å…¶å®ƒèŠ‚ç‚¹(ä¸»è¦æ˜¯ç”¨æ¥åš keys è¿ç§»)&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æ€»çº¿ç«¯å£ï¼ˆä¾‹å¦‚16379ï¼‰éœ€è¦èƒ½è¢«é›†ç¾¤å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;redisé›†ç¾¤æ•°æ®åˆ†ç‰‡&#34;&gt;Redisé›†ç¾¤æ•°æ®åˆ†ç‰‡&lt;/h3&gt;
&lt;p&gt;Redis é›†ç¾¤ä¸ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Œè€Œæ˜¯ä½¿ç”¨å“ˆå¸Œæ§½ã€‚æ•´ä¸ª Redis é›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œå†³å®šä¸€ä¸ª key åº”è¯¥åˆ†é…åˆ°é‚£ä¸ªæ§½çš„ç®—æ³•æ˜¯ï¼šè®¡ç®—è¯¥ key çš„ CRC16 ç»“æœå†æ¨¡ 16834ã€‚&lt;/p&gt;
&lt;p&gt;é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ï¼Œæ¯”å¦‚é›†ç¾¤ä¸­æœ‰ï¼“ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èŠ‚ç‚¹ ï¼¡ å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š0 -- 5500&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ ï¼¢ å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š5501 -- 11000&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹ ï¼£ å­˜å‚¨çš„å“ˆå¸Œæ§½èŒƒå›´æ˜¯ï¼š11001 -- 16384&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·çš„åˆ†å¸ƒæ–¹å¼æ–¹ä¾¿èŠ‚ç‚¹çš„æ·»åŠ å’Œåˆ é™¤ã€‚æ¯”å¦‚ï¼Œéœ€è¦æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼¤ï¼Œåªéœ€è¦æŠŠ ï¼¡ã€ï¼¢ã€ï¼£ ä¸­çš„éƒ¨åˆ†å“ˆå¸Œæ§½æ•°æ®ç§»åˆ° ï¼¤ èŠ‚ç‚¹ã€‚åŒæ ·ï¼Œå¦‚æœå¸Œæœ›åœ¨é›†ç¾¤ä¸­åˆ é™¤ ï¼¡ èŠ‚ç‚¹ï¼Œåªéœ€è¦æŠŠ ï¼¡ èŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„æ•°æ®ç§»åˆ° ï¼¢ å’Œ ï¼£ èŠ‚ç‚¹ï¼Œå½“ ï¼¡ èŠ‚ç‚¹çš„æ•°æ®å…¨éƒ¨è¢«ç§»èµ°åï¼Œï¼¡ èŠ‚ç‚¹å°±å¯ä»¥å®Œå…¨ä»é›†ç¾¤ä¸­åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæŠŠå“ˆå¸Œæ§½ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸éœ€è¦åœæœºï¼Œæ‰€ä»¥ï¼Œå¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œæˆ–æ›´æ”¹èŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½ï¼Œä¹Ÿä¸éœ€è¦åœæœºã€‚&lt;/p&gt;
&lt;p&gt;Redis é›†ç¾¤æ”¯æŒå¤šä¸ª key æ“ä½œï¼Œåªè¦å•ä¸ªå‘½ä»¤æ‰§è¡Œï¼ˆæˆ–æ•´ä¸ªäº‹åŠ¡ï¼Œæˆ–Luaè„šæœ¬æ‰§è¡Œï¼‰æ¶‰åŠçš„æ‰€æœ‰ key å±äºåŒä¸€ä¸ªå“ˆå¸Œæ§½ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ç§°ä¸ºå“ˆå¸Œæ ‡ç­¾çš„åŠŸèƒ½å¼ºåˆ¶å¤šä¸ª key åˆ†é…åˆ°åŒä¸€ä¸ªå“ˆå¸Œæ§½ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ key å«æœ‰å¤§æ‹¬å· &lt;code&gt;{}&lt;/code&gt;ï¼Œåˆ™åªæœ‰å¤§æ‹¬å·ä¸­çš„å­—ç¬¦ä¸²è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚ ä¾‹å¦‚ï¼Œ&amp;quot;user:{123}:profile&amp;quot; å’Œ &amp;quot;user:{123}:account&amp;quot; ä¼šåˆ†é…åˆ°åŒä¸€å“ˆå¸Œæ§½ï¼Œå› ä¸ºå®ƒä»¬å“ˆå¸Œæ ‡ç­¾ç›¸åŒã€‚æ‰€ä»¥ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­åŒæ—¶æ“ä½œä»–ä»¬ã€‚&lt;/p&gt;
&lt;h3 id=&#34;redisé›†ç¾¤ä¸»ä»æ¨¡å‹&#34;&gt;Redisé›†ç¾¤ä¸»ä»æ¨¡å‹&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯åœ¨éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœæˆ–ç½‘ç»œä¸é€šæ—¶é›†ç¾¤ä¾ç„¶èƒ½æ­£å¸¸å·¥ä½œï¼Œé›†ç¾¤ä½¿ç”¨äº†ä¸»ä»æ¨¡å‹ï¼Œæ¯ä¸ªå“ˆå¸Œæ§½æœ‰ä¸€ï¼ˆä¸»èŠ‚ç‚¹ï¼‰åˆ°Nä¸ªå‰¯æœ¬ï¼ˆN-1ä¸ªä»èŠ‚ç‚¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆšæ‰çš„é›†ç¾¤ä¾‹å­ä¸­ï¼Œæœ‰ A, B, C ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœ B èŠ‚ç‚¹æ•…éšœé›†ç¾¤å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼Œå› ä¸ºä¸å†æœ‰åŠæ³•ä¸º 5501-11000 èŒƒå›´å†…çš„å“ˆå¸Œæ§½æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¢åŠ ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå°±å˜æˆäº†ï¼šA , B, C ä¸‰ä¸ªèŠ‚ç‚¹æ˜¯ä¸»èŠ‚ç‚¹ï¼ŒA1,  B1,  C1 åˆ†åˆ«æ˜¯ä»–ä»¬çš„ä»èŠ‚ç‚¹ï¼Œå½“ B èŠ‚ç‚¹å®•æœºæ—¶ï¼Œé›†ç¾¤ä¹Ÿèƒ½æ­£å¸¸è¿ä½œã€‚&lt;br&gt;
åœ¨æˆ‘ä»¬çš„å…·æœ‰èŠ‚ç‚¹ Aã€Bã€C çš„ç¤ºä¾‹é›†ç¾¤ä¸­ï¼Œå¦‚æœèŠ‚ç‚¹ B å‘ç”Ÿæ•…éšœï¼Œé›†ç¾¤å°†æ— æ³•ç»§ç»­ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†æœ‰åŠæ³•ä¸º 5501-11000 èŒƒå›´å†…çš„å“ˆå¸Œæ§½æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;B1 èŠ‚ç‚¹æ˜¯ B èŠ‚ç‚¹çš„å‰¯æœ¬ï¼Œå¦‚æœ B èŠ‚ç‚¹æ•…éšœï¼Œé›†ç¾¤ä¼šæå‡ B1 ä¸ºä¸»èŠ‚ç‚¹ï¼Œä»è€Œè®©é›†ç¾¤ç»§ç»­æ­£å¸¸å·¥ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœ B å’Œ B1 åŒæ—¶æ•…éšœï¼Œé›†ç¾¤å°±ä¸èƒ½ç»§ç»­å·¥ä½œäº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;redisé›†ç¾¤ä¸€è‡´æ€§ä¿è¯&#34;&gt;Redisé›†ç¾¤ä¸€è‡´æ€§ä¿è¯&lt;/h3&gt;
&lt;p&gt;Redis é›†ç¾¤ä¸ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³ç€åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒRedis é›†ç¾¤å¯èƒ½ä¼šä¸¢å¤±å†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;Redis é›†ç¾¤ä¸¢å¤±å†™å…¥çš„ç¬¬ä¸€ä¸ªåŸå› æ˜¯å®ƒä½¿ç”¨å¼‚æ­¥å¤åˆ¶ã€‚ è¿™æ„å‘³ç€åœ¨å†™å…¥æœŸé—´ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘ä¸»èŠ‚ç‚¹ B å‘èµ·å†™çš„æ“ä½œ&lt;/li&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹ B å“åº”å®¢æˆ·ç«¯å†™æ“ä½œæˆåŠŸ&lt;/li&gt;
&lt;li&gt;ä¸»èŠ‚ç‚¹ B å‘å®ƒçš„ä»èŠ‚ç‚¹ B1, B2, B3 åŒæ­¥è¯¥å†™æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºæ¥ï¼ŒB åœ¨å“åº”å®¢æˆ·ç«¯ä¹‹å‰ä¸ä¼šç­‰å¾… B1ã€B2ã€B3 çš„ç¡®è®¤ï¼ˆè¿™é€šå¸¸ä¼šå¯¼è‡´æ€§èƒ½è¿‡ä½ï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ B åœ¨é€šçŸ¥å®¢æˆ·ç«¯å†™æ“ä½œæˆåŠŸä¹‹åï¼ŒåŒæ­¥ç»™ä»èŠ‚ç‚¹ä¹‹å‰ï¼Œä¸»èŠ‚ç‚¹ ï¼¢ æ•…éšœäº†ï¼Œå…¶ä¸­ä¸€ä¸ªæ²¡æœ‰æ”¶åˆ°è¯¥å†™æ“ä½œçš„ä»èŠ‚ç‚¹ä¼šæ™‹å‡æˆä¸»èŠ‚ç‚¹ï¼Œè¯¥å†™æ“ä½œå°±è¿™æ ·æ°¸è¿œä¸¢å¤±äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œéœ€è¦åœ¨æ€§èƒ½å’Œä¸€è‡´æ€§ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœçœŸçš„éœ€è¦ï¼ŒRedisé›†ç¾¤æ”¯æŒåŒæ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œé€šè¿‡ WAIT æŒ‡ä»¤æ¥å®ç°ï¼Œè¿™å¯ä»¥è®©ä¸¢å¤±å†™æ“ä½œçš„å¯èƒ½æ€§é™åˆ°å¾ˆä½ã€‚ä½†å°±ç®—ä½¿ç”¨äº†åŒæ­¥å¤åˆ¶çš„æ–¹å¼ï¼ŒRedis é›†ç¾¤ä¾ç„¶ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œåœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä»èŠ‚ç‚¹åœ¨ä¸ä¸»èŠ‚ç‚¹å¤±å»è¿æ¥ä¹‹åè¢«é€‰ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸ä¸€è‡´æ€§è¿˜æ˜¯ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å¦ä¸€ç§å€¼å¾—æ³¨æ„çš„æƒ…å†µï¼ŒRedis é›†ç¾¤ä¼šä¸¢å¤±å†™å…¥ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œå®¢æˆ·ç«¯ä¸å°‘æ•°å®ä¾‹ï¼ˆè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªä¸»å®ä¾‹ï¼‰éš”ç¦»ã€‚ä»¥ 6 èŠ‚ç‚¹é›†ç¾¤ä¸ºä¾‹ï¼Œå½“ç½‘ç»œå‡ºé—®é¢˜æ—¶ï¼Œä»–ä»¬è¢«åˆ†æˆï¼’ç»„ç½‘ç»œï¼Œç»„å†…ç½‘ç»œè”é€šï¼Œä½†ï¼’ç»„ä¹‹é—´çš„ç½‘ç»œä¸é€šï¼Œå‡è®¾ A, C, A1, B1, C1 å½¼æ­¤ä¹‹é—´æ˜¯è”é€šçš„ï¼Œå¦ä¸€è¾¹ï¼ŒB å’Œ Z1 çš„ç½‘ç»œæ˜¯è”é€šçš„ã€‚Z1 å¯ä»¥ç»§ç»­å¾€ B å‘èµ·å†™æ“ä½œï¼Œï¼¢ ä¹Ÿæ¥å— Z1 çš„å†™æ“ä½œã€‚å½“ç½‘ç»œæ¢å¤æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´é—´éš”è¶³å¤ŸçŸ­ï¼Œé›†ç¾¤ä»ç„¶èƒ½ç»§ç»­æ­£å¸¸å·¥ä½œã€‚å¦‚æœæ—¶é—´æ¯”è¾ƒé•¿ï¼Œä»¥è‡´B1åœ¨å¤§å¤šæ•°çš„è¿™è¾¹è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹ï¼Œé‚£åˆšæ‰Z1å‘ç»™ï¼¢çš„å†™æ“ä½œéƒ½å°†ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼ŒZ1ç»™ï¼¢å‘é€å†™æ“ä½œæ˜¯æœ‰ä¸€ä¸ªé™åˆ¶çš„ï¼Œå¦‚æœæ—¶é—´é•¿åº¦è¾¾åˆ°äº†å¤§å¤šæ•°èŠ‚ç‚¹é‚£è¾¹å¯ä»¥é€‰å‡ºä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹æ—¶ï¼Œå°‘æ•°è¿™è¾¹çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹éƒ½ä¸æ¥å—å†™æ“ä½œã€‚è¿™ä¸ªæ—¶é—´çš„é…ç½®ï¼Œç§°ä¹‹ä¸ºèŠ‚ç‚¹è¶…æ—¶ï¼ˆnode timeoutï¼‰ï¼Œå¯¹é›†ç¾¤æ¥è¯´éå¸¸é‡è¦ï¼Œå½“è¾¾åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹è¶…æ—¶çš„æ—¶é—´ä¹‹åï¼Œä¸»èŠ‚ç‚¹è¢«è®¤ä¸ºå·²ç»å®•æœºï¼Œå¯ä»¥ç”¨å®ƒçš„ä¸€ä¸ªä»èŠ‚ç‚¹æ¥ä»£æ›¿ã€‚åŒæ ·ï¼Œåœ¨èŠ‚ç‚¹è¶…æ—¶æ—¶ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ä¾ç„¶ä¸èƒ½è”ç³»åˆ°å…¶ä»–ä¸»èŠ‚ç‚¹ï¼Œå®ƒå°†è¿›å…¥é”™è¯¯çŠ¶æ€ï¼Œä¸å†æ¥å—å†™æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;redisé›†ç¾¤é…ç½®å‚æ•°&#34;&gt;Redisé›†ç¾¤é…ç½®å‚æ•°&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;cluster-enabled &amp;lt;yes/no&amp;gt;&lt;/code&gt;ï¼šå¦‚æœé…ç½® &amp;quot;yes&amp;quot; åˆ™å¼€å¯é›†ç¾¤åŠŸèƒ½ï¼Œæ­¤ Redis å®ä¾‹ä½œä¸ºé›†ç¾¤çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„å• Redis å®ä¾‹ã€‚&lt;br&gt;
&lt;code&gt;cluster-config-file &amp;lt;æ–‡ä»¶å&amp;gt;&lt;/code&gt;ï¼šè™½ç„¶æ­¤é…ç½®çš„åå­—å« &amp;quot;é›†ç¾¤é…ç½®æ–‡ä»¶&amp;quot;ï¼Œä½†æ˜¯æ­¤é…ç½®æ–‡ä»¶ä¸å¯ç¼–è¾‘ï¼Œå®ƒæ˜¯é›†ç¾¤èŠ‚ç‚¹è‡ªåŠ¨ç»´æŠ¤çš„æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºè®°å½•é›†ç¾¤ä¸­æœ‰å“ªäº›èŠ‚ç‚¹ã€ä»–ä»¬çš„çŠ¶æ€ä»¥åŠä¸€äº›æŒä¹…åŒ–å‚æ•°ç­‰ï¼Œæ–¹ä¾¿åœ¨é‡å¯æ—¶æ¢å¤è¿™äº›çŠ¶æ€ã€‚é€šå¸¸æ˜¯åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åè¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«æ›´æ–°ã€‚&lt;br&gt;
&lt;code&gt;cluster-node-timeout &amp;lt;æ¯«ç§’&amp;gt;&lt;/code&gt;ï¼šè¿™æ˜¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹èƒ½å¤Ÿå¤±è”çš„æœ€å¤§æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šè¢«è®¤ä¸ºæ•…éšœã€‚å¦‚æœä¸»èŠ‚ç‚¹è¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ˜¯ä¸å¯è¾¾ï¼Œåˆ™å®ƒçš„ä»èŠ‚ç‚¹å°†å¯åŠ¨æ•…éšœè¿ç§»ï¼Œå‡çº§æˆä¸»èŠ‚ç‚¹ã€‚æ³¨æ„ï¼Œä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹åœ¨è¿™ä¸ªæ—¶é—´ä¹‹å†…å¦‚æœè¿˜æ˜¯æ²¡æœ‰è¿ä¸Šå¤§éƒ¨åˆ†çš„ä¸»èŠ‚ç‚¹ï¼Œåˆ™æ­¤èŠ‚ç‚¹å°†åœæ­¢æ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚&lt;br&gt;
&lt;code&gt;cluster-slave-validity-factor &amp;lt;factor&amp;gt;&lt;/code&gt;ï¼šå¦‚æœè®¾ç½®æˆï¼ï¼Œåˆ™æ— è®ºä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹å¤±è”å¤šä¹…ï¼Œä»èŠ‚ç‚¹éƒ½ä¼šå°è¯•å‡çº§æˆä¸»èŠ‚ç‚¹ã€‚å¦‚æœè®¾ç½®æˆæ­£æ•°ï¼Œåˆ™ &lt;code&gt;cluster-node-timeout&lt;/code&gt; ä¹˜ä»¥&lt;code&gt;cluster-slave-validity-factor&lt;/code&gt; å¾—åˆ°çš„æ—¶é—´ï¼Œæ˜¯ä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹å¤±è”åï¼Œæ­¤ä»èŠ‚ç‚¹æ•°æ®æœ‰æ•ˆçš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»èŠ‚ç‚¹ä¸ä¼šå¯åŠ¨æ•…éšœè¿ç§»ã€‚å‡è®¾ &lt;code&gt;cluster-node-timeout=5&lt;/code&gt;ï¼Œ&lt;code&gt;cluster-slave-validity-factor=10&lt;/code&gt;ï¼Œåˆ™å¦‚æœä»èŠ‚ç‚¹è·Ÿä¸»èŠ‚ç‚¹å¤±è”è¶…è¿‡50ç§’ï¼Œæ­¤ä»èŠ‚ç‚¹ä¸èƒ½æˆä¸ºä¸»èŠ‚ç‚¹ã€‚æ³¨æ„ï¼Œ&lt;strong&gt;å¦‚æœæ­¤å‚æ•°é…ç½®ä¸ºé0ï¼Œå°†å¯èƒ½å‡ºç°ç”±äºæŸä¸»èŠ‚ç‚¹å¤±è”å´æ²¡æœ‰ä»èŠ‚ç‚¹èƒ½é¡¶ä¸Šçš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´é›†ç¾¤ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç­‰åˆ°åŸæ¥çš„ä¸»èŠ‚ç‚¹é‡æ–°å›å½’åˆ°é›†ç¾¤ï¼Œé›†ç¾¤æ‰æ¢å¤&lt;/strong&gt;ã€‚&lt;br&gt;
&lt;code&gt;cluster-migration-barrier &amp;lt;count&amp;gt;&lt;/code&gt;ï¼šä¸»èŠ‚ç‚¹éœ€è¦çš„æœ€å°ä»èŠ‚ç‚¹æ•°ï¼Œåªæœ‰è¾¾åˆ°è¿™ä¸ªæ•°ï¼Œä¸»èŠ‚ç‚¹å¤±è´¥æ—¶ï¼Œå®ƒä»èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œè¿ç§»ã€‚&lt;br&gt;
&lt;code&gt;cluster-require-full-coverage &amp;lt;yes/no&amp;gt;&lt;/code&gt;ï¼šåœ¨éƒ¨åˆ† key æ‰€åœ¨çš„èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œå¦‚æœæ­¤å‚æ•°è®¾ç½®ä¸º &amp;quot;yes&amp;quot; (é»˜è®¤å€¼), åˆ™æ•´ä¸ªé›†ç¾¤åœæ­¢æ¥å—æ“ä½œï¼›å¦‚æœæ­¤å‚æ•°è®¾ç½®ä¸º &amp;quot;no&amp;quot;ï¼Œåˆ™é›†ç¾¤ä¾ç„¶ä¸ºå¯è¾¾èŠ‚ç‚¹ä¸Šçš„ key æä¾›è¯»æ“ä½œã€‚&lt;br&gt;
&lt;code&gt;cluster-allow-reads-when-down &amp;lt;yes/no&amp;gt;&lt;/code&gt;ï¼šé»˜è®¤æ˜¯ &amp;quot;no&amp;quot;ï¼Œè¡¨ç¤ºå½“é›†ç¾¤å› ä¸»èŠ‚ç‚¹æ•°é‡è¾¾ä¸åˆ°æœ€å°å€¼æˆ–è€…å“ˆå¸Œæ§½æ²¡æœ‰å®Œå…¨åˆ†é…è€Œè¢«æ ‡è®°ä¸ºå¤±æ•ˆæ—¶ï¼ŒèŠ‚ç‚¹å°†åœæ­¢æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ã€‚è®¾ç½®æˆ &amp;quot;yes&amp;quot;ï¼Œåˆ™å…è®¸é›†ç¾¤å¤±æ•ˆçš„æƒ…å†µä¸‹ä¾ç„¶å¯ä»èŠ‚ç‚¹ä¸­è¯»å–æ•°æ®ï¼Œä¿è¯äº†é«˜å¯ç”¨ã€‚&lt;/p&gt;
">Redis é›†ç¾¤ï¼ˆ1ï¼‰Redis é›†ç¾¤æ¦‚å¿µ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/g8uDppTc1/"" data-c="
          &lt;p&gt;æœ¬æ–‡ä»‹ç» ArrayList çš„æ‰©å®¹è¿‡ç¨‹ã€‚ArrayList åº•å±‚æ˜¯æ•°ç»„ elementDataï¼Œç”¨äºå­˜æ”¾æ’å…¥çš„æ•°æ®ã€‚å®ƒçš„å®¹é‡èƒ½åŠ¨æ€å¢é•¿ã€‚åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ ensureCapacity æ“ä½œæ¥å¢åŠ  ArrayList å®ä¾‹çš„å®¹é‡ã€‚è¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;ArrayList çš„æ ¸å¿ƒå­—æ®µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * é»˜è®¤åˆå§‹å®¹é‡
     */
    private static final int DEFAULT_CAPACITY = 10;

    /**
     * ç©ºå®ä¾‹å…±äº«è¿™ä¸ªæ•°ç»„
     */
    private static final Object[] EMPTY_ELEMENTDATA = {};

    /**
     * æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºçš„å®ä¾‹å…±äº«è¿™ä¸ªæ•°ç»„ã€‚
     * ä¸ EMPTY_ELEMENTDATA åŒºåˆ†ï¼Œæ˜¯ä¸ºäº†çŸ¥é“ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶æ‰©å®¹å¤šå°‘
     */
    private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};

    /**
     * å®é™…å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼ŒArrayList çš„å®¹é‡æ˜¯è¿™ä¸ªæ•°ç»„çš„é•¿åº¦ã€‚
     * æ‰€æœ‰æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºçš„å®ä¾‹ elementData éƒ½æ˜¯ DEFAULTCAPACITY_EMPTY_ELEMENTDATA
     * é¦–æ¬¡æ·»åŠ å…ƒç´ æ—¶æ‰©å®¹åˆ° DEFAULT_CAPACITYThe
     */
    transient Object[] elementData; // non-private to simplify nested class access

    /**
     * å…ƒç´ ä¸ªæ•°
     */
    private int size;

    /**
     * å¯ä»¥åˆ†é…å®¹é‡çš„æœ€å¤§å€¼ï¼Œå°è¯•åˆ†é…æ›´å¤§å†…å­˜ä¼šæŠ›å‡º OutOfMemoryError
     */
    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ArrayList çš„æ„é€ æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * åˆ›å»ºæŒ‡å®šå®¹é‡çš„ç©ºåˆ—è¡¨
     * 
     * @param  initialCapacity  åˆ—è¡¨åˆå§‹å®¹é‡
     * @throws IllegalArgumentException å¦‚æœåˆ—è¡¨åˆå§‹å®¹é‡å°äºé›¶æŠ›å‡ºéæ³•å‚æ•°å¼‚å¸¸
     * 
     */
    public ArrayList(int initialCapacity) {
        if (initialCapacity &amp;gt; 0) {
            // åˆ›å»º initialCapacity å¤§å°çš„æ•°ç»„
            this.elementData = new Object[initialCapacity];
        } else if (initialCapacity == 0) {
            // èµ‹å€¼ç©ºæ•°ç»„
            this.elementData = EMPTY_ELEMENTDATA;
        } else {
            // åˆå§‹å®¹é‡å°äºé›¶æŠ›å‡ºéæ³•å‚æ•°å¼‚å¸¸
            throw new IllegalArgumentException(&amp;quot;Illegal Capacity: &amp;quot; + initialCapacity);
        }
    }

    /**
     * åˆ›å»ºåˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨
     */
    public ArrayList() {
        // é»˜è®¤ç©ºæ•°ç»„
        this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
    }

    /**
     * æŒ‰ç…§é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºæ„é€ åŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ã€‚
     *
     * @param c è¦å°†å…¶å…ƒç´ æ”¾å…¥åˆ—è¡¨çš„é›†åˆ
     * @throws NullPointerException å¦‚æœé›†åˆä¸º nullï¼ŒæŠ›å‡º NullPointerException å¼‚å¸¸
     */
    public ArrayList(Collection&amp;lt;? extends E&amp;gt; c) {
        // å¦‚æœ C ä¸º nulï¼ŒæŠ›å‡º NullPointerException å¼‚å¸¸
        Object[] a = c.toArray();
        if ((size = a.length) != 0) {
            // å¦‚æœ c ä¹Ÿæ˜¯ ArrayListï¼Œç›´æ¥èµ‹å€¼
            if (c.getClass() == ArrayList.class) {
                elementData = a;
            } else {
                // å¦‚æœä¸æ˜¯ï¼Œåˆ™æ‹·è´å…ƒç´ 
                elementData = Arrays.copyOf(a, size, Object[].class);
            }
        } else {
            // ç©ºæ•°ç»„
            elementData = EMPTY_ELEMENTDATA;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»º &lt;code&gt;ArrayList&lt;/code&gt; æ—¶ï¼Œå…ƒç´ æ•°ç»„è¢«èµ‹å€¼é»˜è®¤ç©ºæ•°ç»„ã€‚å½“é¦–æ¬¡æ·»åŠ å…ƒç´ æ—¶åˆ†é…å®¹é‡ 10 çš„æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ &lt;code&gt;public boolean add(E e)&lt;/code&gt; ä¸ºä¾‹ï¼Œåˆ†ææ‰©å®¹æœºåˆ¶ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * å°†å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨æœ«å°¾
     *
     * @param e å¾…æ·»åŠ çš„å…ƒç´ 
     * @return &amp;lt;tt&amp;gt;true&amp;lt;/tt&amp;gt; 
     */
    public boolean add(E e) {
        // æ£€æŸ¥å®¹é‡å’Œæ‰©å®¹ï¼Œsize+1 ä¸ºæ‰€éœ€æœ€å°å®¹é‡
        ensureCapacityInternal(size + 1);
        // æ·»åŠ å…ƒç´ 
        elementData[size++] = e;
        return true;
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨çœ‹ &lt;code&gt;ensureCapacityInternal&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void ensureCapacityInternal(int minCapacity) {
    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆï¼Œ&lt;code&gt;ensureCapacityInternal&lt;/code&gt; æ–¹æ³•è°ƒç”¨ &lt;code&gt;calculateCapacity&lt;/code&gt; è®¡ç®—æ‰€éœ€æœ€å°å®¹é‡ï¼šå¦‚æœæ˜¯é»˜è®¤ç©ºåˆ—è¡¨é¦–æ¬¡æ·»åŠ å…ƒç´ ï¼Œæœ€å°å®¹é‡ä¸ºé»˜è®¤å®¹é‡ï¼ˆ&lt;code&gt;DEFAULT_CAPACITY&lt;/code&gt;ï¼Œå³ 10ï¼‰ï¼Œå¦åˆ™ä¸ºå½“å‰å…ƒç´ ä¸ªæ•° + 1ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private static int calculateCapacity(Object[] elementData, int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        return Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    return minCapacity;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç„¶åï¼Œè°ƒç”¨&lt;code&gt;ensureExplicitCapacity&lt;/code&gt;æ–¹æ³•æ‰§è¡Œæ˜¯å¦æ‰©å®¹åˆ¤æ–­å’Œæ‰©å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void ensureExplicitCapacity(int minCapacity) {
    modCount++;
    // æ‰©å®¹åˆ¤æ–­
    if (minCapacity - elementData.length &amp;gt; 0)
        grow(minCapacity);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœå½“å‰å®¹é‡å°äºæ‰€éœ€æœ€å°å®¹é‡ï¼Œåˆ™æ‰§è¡Œæ‰©å®¹é€»è¾‘ï¼Œå³ grow æ–¹æ³•è¡¨ç¤ºå¼€å§‹çœŸæ­£æ‰©å®¹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /**
     * å¢åŠ å®¹é‡ä»¥ç¡®ä¿è‡³å°‘å¯ä»¥å®¹çº³ç”±æœ€å°å®¹é‡å‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°é‡ã€‚
     *
     * @param minCapacity æ‰€éœ€æœ€å°å®¹é‡
     */
    private void grow(int minCapacity) {
        // æ—§å®¹é‡
        int oldCapacity = elementData.length;
        // æ–°å®¹é‡ä¸ºæ—§å®¹é‡çš„ 1.5 å€
        int newCapacity = oldCapacity + (oldCapacity &amp;gt;&amp;gt; 1);
        // å¦‚æœæ–°å®¹é‡æ¯”æœ€å°å®¹é‡å°ï¼Œåˆ™æ–°å®¹é‡ä¸ºæœ€å°å®¹é‡
        if (newCapacity - minCapacity &amp;lt; 0)
            newCapacity = minCapacity;
        // å¦‚æœæ–°å®¹é‡æ¯”åˆ—è¡¨æœ€å¤§å®¹é‡å¤§ï¼Œåˆ™ä¼šè¿›è¡Œå¤§å®¹é‡å¤„ç†
        if (newCapacity - MAX_ARRAY_SIZE &amp;gt; 0)
            // å¦‚æœæ‰€éœ€æœ€å°å®¹é‡å¤§äºåˆ—è¡¨æœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡ä¸º Integer.MAX_VALUEï¼Œå¦åˆ™ä¸º MAX_ARRAY_SIZE
            newCapacity = hugeCapacity(minCapacity);
        // æ‰©å®¹
        elementData = Arrays.copyOf(elementData, newCapacity);
    }

    private static int hugeCapacity(int minCapacity) {
        // æº¢å‡ºæŠ›å‡º OutOfMemoryError å¼‚å¸¸
        if (minCapacity &amp;lt; 0) // overflow
            throw new OutOfMemoryError();
        return (minCapacity &amp;gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;
    }
&lt;/code&gt;&lt;/pre&gt;
">ArrayList æ‰©å®¹åˆ†æ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/gnbZ_m69L/"" data-c="
          &lt;p&gt;æ¥æºã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº JVM é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®æˆ˜ã€‹&lt;/p&gt;
&lt;p&gt;JVM å†…å­˜ç»“æ„ä¸ Java å†…å­˜æ¨¡å‹å®¹æ˜“æ··æ·†ï¼Œå…¶å®å®ƒä»¬æ˜¯ä¸åŒçš„ã€‚ä¸¤è€…çš„ä¸»è¦ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;JVM å†…å­˜ç»“æ„å’Œ Java è™šæ‹Ÿæœºçš„è¿è¡Œæ—¶åŒºåŸŸæœ‰å…³ã€‚&lt;/li&gt;
&lt;li&gt;Java å†…å­˜æ¨¡å‹å’Œ Java çš„å¹¶å‘ç¼–ç¨‹æœ‰å…³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼ŒJava è™šæ‹Ÿæœºåœ¨ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹ç§æœ‰ï¼š
&lt;ul&gt;
&lt;li&gt;ç¨‹åºè®¡æ•°å™¨&lt;/li&gt;
&lt;li&gt;è™šæ‹Ÿæœºæ ˆ&lt;/li&gt;
&lt;li&gt;æœ¬åœ°æ–¹æ³•æ ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹å…±äº«ï¼š
&lt;ul&gt;
&lt;li&gt;å †&lt;/li&gt;
&lt;li&gt;æ–¹æ³•åŒº&lt;/li&gt;
&lt;li&gt;ç›´æ¥å†…å­˜ (éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ç¨‹åºè®¡æ•°å™¨&#34;&gt;ç¨‹åºè®¡æ•°å™¨&lt;/h2&gt;
&lt;p&gt;ç¨‹åºè®¡æ•°å™¨å¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚&lt;br&gt;
ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è™šæ‹Ÿæœºæ ˆ&#34;&gt;è™šæ‹Ÿæœºæ ˆ&lt;/h2&gt;
&lt;p&gt;Java è™šæ‹Ÿæœºæ ˆçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚é™¤äº†ä¸€äº› Native æ–¹æ³•è°ƒç”¨æ˜¯é€šè¿‡æœ¬åœ°æ–¹æ³•æ ˆå®ç°ï¼Œå…¶ä»–æ‰€æœ‰çš„ Java æ–¹æ³•è°ƒç”¨éƒ½æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„ï¼ˆä¹Ÿéœ€è¦å’Œå…¶ä»–è¿è¡Œæ—¶æ•°æ®åŒºåŸŸæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨é…åˆï¼‰ã€‚æ–¹æ³•è°ƒç”¨çš„æ•°æ®éœ€è¦é€šè¿‡æ ˆè¿›è¡Œä¼ é€’ï¼Œæ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥æ ˆä¸­ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚æ ˆç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€‚&lt;br&gt;
å±€éƒ¨å˜é‡è¡¨ ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ã€‚&lt;br&gt;
ç¨‹åºè¿è¡Œä¸­æ ˆå¯èƒ½ä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;StackOverFlowErrorï¼š è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;OutOfMemoryErrorï¼š å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœ¬åœ°æ–¹æ³•æ ˆ&#34;&gt;æœ¬åœ°æ–¹æ³•æ ˆ&lt;/h2&gt;
&lt;p&gt;å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š&lt;strong&gt;è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡&lt;/strong&gt;ã€‚&lt;br&gt;
ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåœ¨æ ˆæ·±åº¦æº¢å‡ºæˆ–è€…æ ˆæ‰©å±•å¤±è´¥æ—¶åˆ†åˆ«æŠ›å‡º StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å †&#34;&gt;å †&lt;/h2&gt;
&lt;p&gt;å †å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚Java ä¸–ç•Œä¸­â€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…ï¼Œä½†æ˜¯ï¼Œéšç€ JIT ç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œå¦‚æœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ GC å †ï¼ˆGarbage Collected Heapï¼‰ã€‚ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenã€Survivorã€Old ç­‰ç©ºé—´ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚&lt;br&gt;
åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–°ç”Ÿä»£å†…å­˜(Young Generation)&lt;/li&gt;
&lt;li&gt;è€ç”Ÿä»£(Old Generation)&lt;/li&gt;
&lt;li&gt;æ°¸ä¹…ä»£(Permanent Generation)&lt;br&gt;
Java å †æ—¢å¯ä»¥è¢«å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡ä¸»æµæ˜¯å¯æ‰©å±•çš„ï¼ˆé€šè¿‡-Xmxå’ŒXmsè®¾å®šï¼‰ï¼Œå¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †å†ä¹Ÿæ— æ³•æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ–¹æ³•åŒº&#34;&gt;æ–¹æ³•åŒº&lt;/h2&gt;
&lt;p&gt;æ–¹æ³•åŒºä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚æ°¸ä¹…ä»£æ˜¯ JDK 1.8 ä¹‹å‰çš„æ–¹æ³•åŒºå®ç°ï¼ŒJDK 1.8 åŠä»¥åæ–¹æ³•åŒºçš„å®ç°å˜æˆäº†å…ƒç©ºé—´ã€‚å¦‚æœæ–¹æ³•å»æ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæ—¶å¸¸é‡æ± &#34;&gt;è¿è¡Œæ—¶å¸¸é‡æ± &lt;/h2&gt;
&lt;p&gt;è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼ŒClass æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰çš„ å¸¸é‡æ± è¡¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¼šåœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å­—ç¬¦ä¸²å¸¸é‡æ± &#34;&gt;å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/h2&gt;
&lt;p&gt;å­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚JDK1.7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£ã€‚JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± å’Œé™æ€å˜é‡ä»æ°¸ä¹…ä»£ç§»åŠ¨äº† Java å †ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›´æ¥å†…å­˜&#34;&gt;ç›´æ¥å†…å­˜&lt;/h2&gt;
&lt;p&gt;ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ï¼Œå¯èƒ½å‡ºç° OutOfMemoryError å¼‚å¸¸ã€‚ç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚&lt;/p&gt;
">Java å†…å­˜ç»“æ„</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/joFVkvmFu/"" data-c="
          &lt;p&gt;MyBatis æœ‰ä¸¤æ–¹é¢çš„ XML é…ç½®ï¼Œä¸€ä¸ªæ˜¯å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆå‡è®¾æ–‡ä»¶åä¸ºmybatis-config.xmlï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ Mapper.xml é…ç½®æ–‡ä»¶ä¸­çš„ SQL è¯­å¥ã€‚åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼ŒMyBatis ä¼šè¯»å–å…¨å±€é…ç½®æ–‡ä»¶ä»¥åŠæ‰€æœ‰çš„ Mapper æ˜ å°„é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šåŠ è½½è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»ï¼Œè§£æç±»ä¸­çš„ç›¸å…³æ³¨è§£ï¼Œæœ€ç»ˆå°†è§£æå¾—åˆ°çš„ä¿¡æ¯è½¬æ¢æˆé…ç½®å¯¹è±¡ã€‚å®Œæˆé…ç½®åŠ è½½ä¹‹åï¼ŒMyBatis å°±ä¼šæ ¹æ®å¾—åˆ°çš„é…ç½®å¯¹è±¡åˆå§‹åŒ–å„ä¸ªæ¨¡å—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mybatis-configxml-è§£æ&#34;&gt;mybatis-config.xml è§£æ&lt;/h2&gt;
&lt;p&gt;MyBatis åˆå§‹åŒ–çš„ç¬¬ä¸€ä¸ªæ­¥éª¤å°±æ˜¯åŠ è½½å’Œè§£æ mybatis-config.xml è¿™ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ï¼Œå…¥å£æ˜¯ &lt;code&gt;XMLConfigBuilder&lt;/code&gt;ï¼Œå®ƒç”± &lt;code&gt;SqlSessionFactoryBuilder.build()&lt;/code&gt; æ–¹æ³•åˆ›å»ºã€‚&lt;code&gt;XMLConfigBuilder&lt;/code&gt; ä¼šè§£æ mybatis-config.xml é…ç½®æ–‡ä»¶å¾—åˆ°å¯¹åº”çš„ &lt;code&gt;Configuration&lt;/code&gt; å…¨å±€é…ç½®å¯¹è±¡ï¼Œç„¶å &lt;code&gt;SqlSessionFactoryBuilder&lt;/code&gt; ä¼šæ ¹æ®å¾—åˆ°çš„ &lt;code&gt;Configuration&lt;/code&gt; å…¨å±€é…ç½®å¯¹è±¡åˆ›å»ºä¸€ä¸ª &lt;code&gt;DefaultSqlSessionFactory&lt;/code&gt; å¯¹è±¡ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
  public void test() throws IOException {
    // è¯»å–é…ç½®æ–‡ä»¶
    try (InputStream resourceAsStream = Resources.getResourceAsStream(&amp;quot;mybatis-config.xml&amp;quot;)) {
      // è§£æé…ç½®æ–‡ä»¶ï¼Œå°è£… Configuration å¯¹è±¡ï¼Œåˆ›å»º DefaultSqlSessionFactory å¯¹è±¡
      SqlSessionFactory sqlSessionFactory =
       new SqlSessionFactoryBuilder().build(resourceAsStream);
    }
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;XMLConfigBuilder å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯è§£æ mybatis-config.xml é…ç½®æ–‡ä»¶ï¼Œå®ƒç»§æ‰¿è‡ª BaseBuilder æŠ½è±¡ç±»ï¼Œ BaseBuilder å®šä¹‰äº†å¦‚ä¸‹ä¸‰ä¸ªå­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;configurationï¼ˆConfiguration ç±»å‹ï¼‰ï¼šMyBatis åˆå§‹åŒ–è§£æåˆ°çš„å…¨éƒ¨é…ç½®ä¿¡æ¯éƒ½ä¼šè®°å½•åˆ° Configuration å¯¹è±¡ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;typeAliasRegistryï¼ˆTypeAliasRegistry ç±»å‹ï¼‰ï¼šåˆ«åæ³¨å†Œä¸­å¿ƒã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;&amp;lt;typeAliases&amp;gt;&lt;/code&gt; æ ‡ç­¾ä¸ºç±»å®šä¹‰åˆ«åã€‚&lt;/li&gt;
&lt;li&gt;typeHandlerRegistryï¼ˆTypeHandlerRegistry ç±»å‹ï¼‰ï¼šTypeHandler æ³¨å†Œä¸­å¿ƒã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ &lt;code&gt;&amp;lt;typeHandlers&amp;gt;&lt;/code&gt; æ ‡ç­¾è‡ªå®šä¹‰ &lt;code&gt;TypeHandler&lt;/code&gt;ï¼Œå®ç°æ•°æ®åº“ç±»å‹ä¸ Java ç±»å‹çš„è‡ªå®šä¹‰è½¬æ¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;XMLConfigBuilder å®šä¹‰äº†ä»¥ä¸‹æ ¸å¿ƒå­—æ®µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;parsedï¼ˆboolean ç±»å‹ï¼‰ï¼šçŠ¶æ€æ ‡è¯†å­—æ®µï¼Œè®°å½•å½“æ˜¯å¦å·²ç»æˆåŠŸè§£æå®Œé…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;parserï¼ˆXPathParser ç±»å‹ï¼‰ï¼šç”¨æ¥è§£æé…ç½®æ–‡ä»¶çš„ XML è§£æå™¨ã€‚&lt;/li&gt;
&lt;li&gt;environmentï¼ˆString ç±»å‹ï¼‰ï¼š æ ‡ç­¾å®šä¹‰çš„ç¯å¢ƒåç§°ã€‚&lt;/li&gt;
&lt;li&gt;localReflectorFactoryï¼ˆReflectorFactory ç±»å‹ï¼‰ï¼šå®ç°å¯¹ Reflector å¯¹è±¡çš„åˆ›å»ºå’Œç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;XMLConfigBuilder.parse()&lt;/code&gt; æ–¹æ³•è§¦å‘äº†é…ç½®æ–‡ä»¶çš„è§£æï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
   * è§£æ mybatis-config.xml é…ç½®æ–‡ä»¶å¾—åˆ° Configuration å…¨å±€é…ç½®å¯¹è±¡
   * @return Configuration
   */
  public Configuration parse() {
    if (parsed) {
      throw new BuilderException(&amp;quot;Each XMLConfigBuilder can only be used once.&amp;quot;);
    }
    parsed = true;
    parseConfiguration(parser.evalNode(&amp;quot;/configuration&amp;quot;));
    return configuration;
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­çš„ &lt;code&gt;parseConfiguration()&lt;/code&gt; æ–¹æ³•å®šä¹‰äº†è§£æé…ç½®æ–‡ä»¶çš„å®Œæ•´æµç¨‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// è§£æé…ç½®æ–‡ä»¶
  private void parseConfiguration(XNode root) {
    try {
      // è§£æ &amp;lt;properties&amp;gt; æ ‡ç­¾ï¼›
      propertiesElement(root.evalNode(&amp;quot;properties&amp;quot;));
      // è§£æ &amp;lt;settings&amp;gt; æ ‡ç­¾ï¼›
      Properties settings = settingsAsProperties(root.evalNode(&amp;quot;settings&amp;quot;));
      // å¤„ç†æ—¥å¿—ç›¸å…³ç»„ä»¶ï¼›
      loadCustomVfs(settings);
      loadCustomLogImpl(settings);
      // è§£æ &amp;lt;typeAliases&amp;gt; æ ‡ç­¾ï¼›
      typeAliasesElement(root.evalNode(&amp;quot;typeAliases&amp;quot;));
      // è§£æ &amp;lt;plugins&amp;gt; æ ‡ç­¾ï¼›
      pluginElement(root.evalNode(&amp;quot;plugins&amp;quot;));
      // è§£æ &amp;lt;objectFactory&amp;gt; æ ‡ç­¾ï¼›
      objectFactoryElement(root.evalNode(&amp;quot;objectFactory&amp;quot;));
      // è§£æ &amp;lt;objectWrapperFactory&amp;gt; æ ‡ç­¾ï¼›
      objectWrapperFactoryElement(root.evalNode(&amp;quot;objectWrapperFactory&amp;quot;));
      // è§£æ &amp;lt;reflectorFactory&amp;gt; æ ‡ç­¾ï¼›
      reflectorFactoryElement(root.evalNode(&amp;quot;reflectorFactory&amp;quot;));
      settingsElement(settings);
      // read it after objectFactory and objectWrapperFactory issue #631
      // è§£æ &amp;lt;environments&amp;gt; æ ‡ç­¾ï¼›
      environmentsElement(root.evalNode(&amp;quot;environments&amp;quot;));
      // è§£æ &amp;lt;databaseIdProvider&amp;gt; æ ‡ç­¾ï¼›
      databaseIdProviderElement(root.evalNode(&amp;quot;databaseIdProvider&amp;quot;));
      // è§£æ &amp;lt;typeHandlers&amp;gt; æ ‡ç­¾ï¼›
      typeHandlerElement(root.evalNode(&amp;quot;typeHandlers&amp;quot;));
      // è§£æ &amp;lt;mappers&amp;gt; æ ‡ç­¾ã€‚
      mapperElement(root.evalNode(&amp;quot;mappers&amp;quot;));
    } catch (Exception e) {
      throw new BuilderException(&amp;quot;Error parsing SQL Mapper Configuration. Cause: &amp;quot; + e, e);
    }
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œé€‰æ‹©  &lt;code&gt;&amp;lt;properties&amp;gt;&lt;/code&gt;ï¼Œ&lt;code&gt;&amp;lt;settings&amp;gt;&lt;/code&gt;ï¼Œ&lt;code&gt;&amp;lt;plugins&amp;gt;&lt;/code&gt;ï¼Œ&lt;code&gt;&amp;lt;mappers&amp;gt;&lt;/code&gt; ç®€è¦ä»‹ç»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£æ-properties-æ ‡ç­¾&#34;&gt;è§£æ &lt;code&gt;&amp;lt;properties&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ &lt;code&gt;&amp;lt;properties&amp;gt;&lt;/code&gt; æ ‡ç­¾å®šä¹‰ KV ä¿¡æ¯ä¾› MyBatis ä½¿ç”¨ï¼Œä» &lt;code&gt;&amp;lt;properties&amp;gt;&lt;/code&gt; æ ‡ç­¾ä¸­è§£æå‡ºæ¥çš„ KV ä¿¡æ¯ä¼šè¢«è®°å½•åˆ° &lt;code&gt;Properties&lt;/code&gt; å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ &lt;code&gt;Configuration&lt;/code&gt; å…¨å±€é…ç½®å¯¹è±¡çš„ &lt;code&gt;variables&lt;/code&gt; å­—æ®µï¼‰ï¼Œè§£æå…¶ä»–æ ‡ç­¾æ—¶ï¼ŒMyBatis ä¼šä½¿ç”¨è¿™ä¸ª &lt;code&gt;Properties&lt;/code&gt; å¯¹è±¡ä¸­è®°å½•çš„ KV ä¿¡æ¯æ›¿æ¢åŒ¹é…çš„å ä½ç¬¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£æ-settings-æ ‡ç­¾&#34;&gt;è§£æ &lt;code&gt;&amp;lt;settings&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;settings&amp;gt;&lt;/code&gt; æ ‡ç­¾é…ç½®å…¨å±€æ€§çš„é…ç½®ï¼Œä¾‹å¦‚ï¼Œæ˜¯å¦ä½¿ç”¨äºŒçº§ç¼“å­˜ã€æ˜¯å¦å¼€å¯æ‡’åŠ è½½åŠŸèƒ½ç­‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è§£æ-plugins-æ ‡ç­¾&#34;&gt;è§£æ &lt;code&gt;&amp;lt;plugins&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;/h3&gt;
&lt;p&gt;å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå®ç°äº† Interceptor æ¥å£çš„æ’ä»¶æ¥æ‰©å±• MyBatis çš„è¡Œä¸ºã€‚&lt;code&gt;pluginElement()&lt;/code&gt; æ–¹æ³•å°±æ˜¯è§£æ &lt;code&gt;&amp;lt;plugins&amp;gt;&lt;/code&gt; æ ‡ç­¾ä¸­é…ç½®çš„è‡ªå®šä¹‰æ’ä»¶ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void pluginElement(XNode parent) throws Exception {
    if (parent != null) {
      // éå†å…¨éƒ¨çš„ &amp;lt;plugin&amp;gt; å­æ ‡ç­¾
      for (XNode child : parent.getChildren()) {
        // è·å–æ¯ä¸ª &amp;lt;plugin&amp;gt; æ ‡ç­¾ä¸­çš„interceptorå±æ€§
        String interceptor = child.getStringAttribute(&amp;quot;interceptor&amp;quot;);
        // è·å– &amp;lt;plugin&amp;gt; æ ‡ç­¾ä¸‹çš„å…¶ä»–é…ç½®ä¿¡æ¯
        Properties properties = child.getChildrenAsProperties();
        // åˆå§‹åŒ– interceptor å±æ€§æŒ‡å®šçš„è‡ªå®šä¹‰æ’ä»¶
        Interceptor interceptorInstance = (Interceptor) resolveClass(interceptor).getDeclaredConstructor().newInstance();
        // åˆå§‹åŒ–æ’ä»¶çš„é…ç½®
        interceptorInstance.setProperties(properties);
        // å°† Interceptor å¯¹è±¡æ·»åŠ åˆ° Configuration çš„æ’ä»¶é“¾ä¸­
        configuration.addInterceptor(interceptorInstance);
      }
    }
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;è§£æ-mappers-æ ‡ç­¾&#34;&gt;è§£æ &lt;code&gt;&amp;lt;mappers&amp;gt;&lt;/code&gt; æ ‡ç­¾&lt;/h3&gt;
&lt;p&gt;MyBatis åˆå§‹åŒ–çš„æ—¶å€™è¿˜ä¼šåŠ è½½ &lt;code&gt;&amp;lt;mappers&amp;gt;&lt;/code&gt; æ ‡ç­¾ä¸‹å®šä¹‰çš„ Mapper æ˜ å°„æ–‡ä»¶ã€‚&lt;code&gt;&amp;lt;mappers&amp;gt;&lt;/code&gt; æ ‡ç­¾æ˜ å°„æ–‡ä»¶çš„ä½ç½®ï¼Œ&lt;code&gt;mapperElement()&lt;/code&gt; æ–¹æ³•å°±æ˜¯åŠ è½½å„ä¸ª Mapper.xml æ˜ å°„æ–‡ä»¶ã€‚åŒæ—¶ï¼Œè¿˜ä¼šæ‰«ææ–‡ä»¶ç›¸åº”çš„ Mapper æ¥å£ï¼Œå¤„ç†å…¶ä¸­çš„æ³¨è§£å¹¶å°† Mapper æ¥å£æ³¨å†Œåˆ° &lt;code&gt;MapperRegistry&lt;/code&gt; ä¸­ã€‚mapperElement() æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private void mapperElement(XNode parent) throws Exception {
    if (parent != null) {
      for (XNode child : parent.getChildren()) {
        // æ‰«ææŒ‡å®šåŒ…
        if (&amp;quot;package&amp;quot;.equals(child.getName())) {
          String mapperPackage = child.getStringAttribute(&amp;quot;name&amp;quot;);
          configuration.addMappers(mapperPackage);
        } else {
          // è§£æ mapper æ ‡ç­¾ï¼Œ resourceã€urlã€class ä¸‰ä¸ªå±æ€§ï¼Œåªèƒ½è®¾ç½®ä¸€ä¸ª
          String resource = child.getStringAttribute(&amp;quot;resource&amp;quot;);
          String url = child.getStringAttribute(&amp;quot;url&amp;quot;);
          String mapperClass = child.getStringAttribute(&amp;quot;class&amp;quot;);
          // å¦‚æœ&amp;lt;mapper&amp;gt;å­æ ‡ç­¾æŒ‡å®šäº†resourceæˆ–æ˜¯urlå±æ€§ï¼Œä¼šåˆ›å»ºXMLMapperBuilderå¯¹è±¡è§£ææ˜ å°„æ–‡ä»¶
          if (resource != null &amp;amp;&amp;amp; url == null &amp;amp;&amp;amp; mapperClass == null) {
            ErrorContext.instance().resource(resource);
            InputStream inputStream = Resources.getResourceAsStream(resource);
            XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments());
            mapperParser.parse();
          } else if (resource == null &amp;amp;&amp;amp; url != null &amp;amp;&amp;amp; mapperClass == null) {
            ErrorContext.instance().resource(url);
            InputStream inputStream = Resources.getUrlAsStream(url);
            XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, url, configuration.getSqlFragments());
            mapperParser.parse();
          } else if (resource == null &amp;amp;&amp;amp; url == null &amp;amp;&amp;amp; mapperClass != null) {
            // å¦‚æœ&amp;lt;mapper&amp;gt;å­æ ‡ç­¾æŒ‡å®šäº†classå±æ€§ï¼Œåˆ™å‘MapperRegistryæ³¨å†Œclasså±æ€§æŒ‡å®šçš„Mapperæ¥å£
            Class&amp;lt;?&amp;gt; mapperInterface = Resources.classForName(mapperClass);
            configuration.addMapper(mapperInterface);
          } else {
            throw new BuilderException(&amp;quot;A mapper element may only specify a url, resource or class, but not more than one.&amp;quot;);
          }
        }
      }
    }
  }
&lt;/code&gt;&lt;/pre&gt;
">MyBatis å¯åŠ¨æµç¨‹ï¼ˆä¸Šï¼‰å…¨å±€é…ç½®æ–‡ä»¶è§£æ</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/wWHOe505F/"" data-c="
          &lt;p&gt;æŒä¹…åŒ–æŒ‡å°†æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨ï¼Œä¾‹å¦‚å›ºæ€ç¡¬ç›˜ (SSD)ã€‚ Redis æä¾›äº†ä»¥ä¸‹æŒä¹…åŒ–é€‰é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RDBï¼ˆRedis Databaseï¼‰ï¼šRDB æŒä¹…åŒ–ä»¥æŒ‡å®šçš„æ—¶é—´é—´éš”ä¿å­˜æ•°æ®å¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;AOFï¼ˆAppend Only Fileï¼‰ï¼šAOF æŒä¹…åŒ–è®°å½•æœåŠ¡å™¨æ”¶åˆ°çš„æ¯ä¸€ä¸ªå†™æ“ä½œï¼ŒæœåŠ¡å™¨å¯åŠ¨æ—¶å†æ¬¡æ‰§è¡Œè¿™äº›æ“ä½œé‡å»ºåŸå§‹æ•°æ®é›†ã€‚&lt;/li&gt;
&lt;li&gt;RDB + AOFï¼šåŒæ—¶ä½¿ç”¨ AOF å’Œ RDBã€‚&lt;/li&gt;
&lt;li&gt;æ— æŒä¹…åŒ–ï¼šç¦ç”¨æŒä¹…åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rdb-æŒä¹…åŒ–&#34;&gt;RDB æŒä¹…åŒ–&lt;/h2&gt;
&lt;h3 id=&#34;rdb-ä¼˜ç‚¹&#34;&gt;RDB ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;RDB  æ–‡ä»¶éå¸¸ç´§å‡‘ï¼Œéå¸¸é€‚åˆå¤‡ä»½ã€‚ ä¾‹å¦‚ï¼Œå¸Œæœ›åœ¨æœ€è¿‘ 24 å°æ—¶å†…æ¯å°æ—¶å½’æ¡£ä¸€æ¬¡ RDB æ–‡ä»¶ï¼Œå¹¶åœ¨ 30 å¤©å†…æ¯å¤©ä¿å­˜ä¸€ä¸ª RDB å¿«ç…§ï¼Œè¿™å¯ä»¥åœ¨ç¾éš¾æ¢å¤æ—¶è½»æ¾æ¢å¤ä¸åŒç‰ˆæœ¬çš„æ•°æ®é›†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;RDB æ–‡ä»¶éå¸¸é€‚åˆç¾éš¾æ¢å¤ï¼Œå®ƒæ˜¯å¯ä»¥è¿œç¨‹ä¼ è¾“çš„ç´§å‡‘æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;RDB æœ€å¤§é™åº¦åœ°æé«˜äº† Redis çš„æ€§èƒ½ï¼Œå› ä¸º Redis çˆ¶è¿›ç¨‹ä¸ºäº†æŒä¹…åŒ–éœ€è¦åšçš„å”¯ä¸€å·¥ä½œå°±æ˜¯ fork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¼šå®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚ çˆ¶è¿›ç¨‹æ°¸è¿œä¸ä¼šæ‰§è¡Œç£ç›˜ I/O æˆ–ç±»ä¼¼æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ä¸ AOF ç›¸æ¯”ï¼ŒRDB æ›´å¿«ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¸»å¤‡å¤åˆ¶æ—¶ï¼ŒRDB æ”¯æŒé‡å¯å’Œæ•…éšœè½¬ç§»åçš„éƒ¨åˆ†é‡åŒæ­¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;rdb-ç¼ºç‚¹&#34;&gt;RDB ç¼ºç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœéœ€è¦åœ¨ Redis åœæ­¢å·¥ä½œï¼ˆä¾‹å¦‚æ–­ç”µï¼‰çš„æƒ…å†µä¸‹å°†æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§é™åˆ°æœ€ä½ï¼Œåˆ™ RDB å¹¶ä¸é€‚ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;RDB éœ€è¦ç»å¸¸ fork() ä»¥ä¾¿ä½¿ç”¨å­è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–ã€‚å¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼Œfork() å¯èƒ½ä¼šå¾ˆè€—æ—¶ï¼Œå¦‚æœæ•°æ®é›†å¾ˆå¤§ä¸” CPU æ€§èƒ½ä¸ä½³ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Redis åœæ­¢å‡ æ¯«ç§’ç”šè‡³ä¸€ç§’çš„æœåŠ¡ã€‚AOF ä¹Ÿéœ€è¦ fork() ä½†é¢‘ç‡è¾ƒä½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;aof-æŒä¹…åŒ–&#34;&gt;AOF æŒä¹…åŒ–&lt;/h2&gt;
&lt;h3 id=&#34;aof-ä¼˜ç‚¹&#34;&gt;AOF ä¼˜ç‚¹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;AOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼šå­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼ˆ &lt;code&gt;fsync&lt;/code&gt; ç­–ç•¥ï¼‰ï¼š&lt;code&gt;no&lt;/code&gt;ã€&lt;code&gt;everysec&lt;/code&gt; å’Œ &lt;code&gt;always&lt;/code&gt;ã€‚é»˜è®¤æ˜¯ &lt;code&gt;everysec&lt;/code&gt;ã€‚&lt;code&gt;fsync&lt;/code&gt; ä½¿ç”¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå½“æ²¡æœ‰è¿›è¡Œ &lt;code&gt;fsync&lt;/code&gt; æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåŠªåŠ›æ‰§è¡Œå†™å…¥æ“ä½œï¼Œå› æ­¤åªæŸå¤±ä¸€ç§’é’Ÿçš„å†™å…¥æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;AOF æ—¥å¿—æ˜¯ä¸€ä¸ªä»…è¿½åŠ çš„æ—¥å¿—ï¼Œå› æ­¤ä¸ä¼šå‡ºç°è¦†ç›–æˆ–æŸåé—®é¢˜ã€‚å³ä½¿ç”±äºæŸç§åŸå› ï¼ˆç£ç›˜å·²æ»¡æˆ–å…¶ä»–åŸå› ï¼‰ï¼Œæ—¥å¿—ä»¥åŠå†™å‘½ä»¤ç»“æŸï¼Œredis-check-aof å·¥å…·ä¹Ÿèƒ½å¾ˆå®¹æ˜“åœ°ä¿®å¤ã€‚&lt;/li&gt;
&lt;li&gt;Redis èƒ½å¤Ÿåœ¨ AOF è¿‡å¤§æ—¶è‡ªåŠ¨åœ¨åå°é‡å†™å®ƒã€‚é‡å†™æ˜¯å®Œå…¨å®‰å…¨çš„ï¼Œå› ä¸ºå½“ Redis ç»§ç»­è¿½åŠ åˆ°æ—§æ–‡ä»¶æ—¶ï¼Œä¼šç”¨åˆ›å»ºå½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°æ“ä½œé›†ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„æ–‡ä»¶ï¼Œä¸€æ—¦ç¬¬äºŒä¸ªæ–‡ä»¶å‡†å¤‡å¥½ï¼ŒRedis å°±ä¼šåˆ‡æ¢è¿™ä¸¤ä¸ªæ–‡ä»¶å¹¶å¼€å§‹è¿½åŠ åˆ°æ–°æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
">Redis ï¼ˆ4ï¼‰æŒä¹…åŒ–</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/rd9wJW_LL/"" data-c="
          &lt;p&gt;æ¥æº&lt;a href=&#34;https://redis.io/docs/data-types/&#34;&gt;Redis æ•°æ®ç±»å‹&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;stream-æµ&#34;&gt;Stream æµ&lt;/h2&gt;
&lt;p&gt;Redis æµæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºä»…è¿½åŠ æ—¥å¿—ã€‚å¯ä»¥ä½¿ç”¨æµå®æ—¶è®°å½•å’Œå¤„ç†äº‹ä»¶ï¼ŒRedisæµçš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹ä»¶æºï¼ˆä¾‹å¦‚ï¼Œè·Ÿè¸ªç”¨æˆ·è¡Œä¸ºã€ç‚¹å‡»ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;ä¼ æ„Ÿå™¨ç›‘æ§ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªç°åœºè®¾å¤‡çš„æ•°æ®ï¼‰&lt;/li&gt;
&lt;li&gt;é€šçŸ¥ï¼ˆä¾‹å¦‚ï¼Œå­˜å‚¨ç”¨æˆ·çš„é€šçŸ¥è®°å½•ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redisä¸ºæµæ¡ç›®ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDã€‚å¯ä»¥ä½¿ç”¨è¿™äº›IDåœ¨ä»¥åæ£€ç´¢ç›¸å…³çš„æ¡ç›®ï¼Œæˆ–è€…è¯»å–å’Œå¤„ç†æµä¸­æ‰€æœ‰çš„åç»­æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;Redisæµæ”¯æŒå‡ ç§ä¿®å‰ªç­–ç•¥ï¼ˆé˜²æ­¢æµæ— é™åˆ¶å¢é•¿ï¼‰å’Œå‡ ç§æ¶ˆè´¹ç­–ç•¥ï¼ˆè§ &lt;strong&gt;XREAD&lt;/strong&gt;ã€&lt;strong&gt;XREADGROUP&lt;/strong&gt; å’Œ &lt;strong&gt;XRANGE&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å‘æµä¸­æ·»åŠ å‡ æ¡å¤©æ°”æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; XADD temperatures:us-ny:10007 * temp_f 87.2 pressure 29.69 humidity 46
&amp;quot;1658354918398-0&amp;quot;
&amp;gt; XADD temperatures:us-ny:10007 * temp_f 83.1 pressure 29.21 humidity 46.5
&amp;quot;1658354934941-0&amp;quot;
&amp;gt; XADD temperatures:us-ny:10007 * temp_f 81.9 pressure 28.37 humidity 43.7
&amp;quot;1658354957524-0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ &lt;b&gt;*&lt;/b&gt; è¡¨ç¤ºç”± redis ç”Ÿæˆ IDï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯è¦ä¿è¯é€’å¢æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–ä»ID 1658354934941-0 å¼€å§‹çš„ä¸¤ä¸ªæ¡ç›®&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; XRANGE temperatures:us-ny:10007 1658354934941-0 + COUNT 2
1) 1) &amp;quot;1658354934941-0&amp;quot;
   2) 1) &amp;quot;temp_f&amp;quot;
      2) &amp;quot;83.1&amp;quot;
      3) &amp;quot;pressure&amp;quot;
      4) &amp;quot;29.21&amp;quot;
      5) &amp;quot;humidity&amp;quot;
      6) &amp;quot;46.5&amp;quot;
2) 1) &amp;quot;1658354957524-0&amp;quot;
   2) 1) &amp;quot;temp_f&amp;quot;
      2) &amp;quot;81.9&amp;quot;
      3) &amp;quot;pressure&amp;quot;
      4) &amp;quot;28.37&amp;quot;
      5) &amp;quot;humidity&amp;quot;
      6) &amp;quot;43.7&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä»æµå°¾éƒ¨è¯»å–æœ€å¤š100ä¸ªæ–°æ¡ç›®ï¼Œå¦‚æœæ²¡æœ‰å†™å…¥ï¼Œåˆ™æœ€å¤šé˜»å¡300æ¯«ç§’&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; XREAD COUNT 100 BLOCK 300 STREAMS temperatures:us-ny:10007 $
(nil)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;XADD&lt;/strong&gt; å‘æµæ·»åŠ æ–°æ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XREAD&lt;/strong&gt; ä»ç»™å®šçš„ä½ç½®å¼€å§‹å¹¶å‘å‰ç§»åŠ¨è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XRANGE&lt;/strong&gt; è¿”å›ä¸¤ä¸ª ID èŒƒå›´ä¹‹é—´çš„æ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;XLEN&lt;/strong&gt; è¿”å›æµçš„é•¿åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å‘æµä¸­æ·»åŠ æ¡ç›®æ˜¯ O(1)ã€‚è®¿é—®ä»»ä½•æ¡ç›®éƒ½æ˜¯ O(n)ï¼Œå…¶ä¸­ n æ˜¯ ID çš„é•¿åº¦ã€‚ç”±äºæµ ID é€šå¸¸å¾ˆçŸ­ä¸”é•¿åº¦å›ºå®šï¼Œå› æ­¤è¿™æœ‰æ•ˆåœ°å‡å°‘ä¸ºå¸¸é‡æŸ¥æ‰¾æ—¶é—´ï¼Œå› ä¸ºæµåŸºäºåŸºæ•°æ ‘ï¼ˆRadix Treeï¼‰å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•åœ°è¯´ï¼ŒRedis æµæä¾›äº†é«˜æ•ˆçš„æ’å…¥å’Œè¯»å–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;geospatial-åœ°ç†ä½ç½®&#34;&gt;Geospatial åœ°ç†ä½ç½®&lt;/h2&gt;
&lt;p&gt;Redis åœ°ç†ç©ºé—´ç´¢å¼•å­˜å‚¨åæ ‡å¹¶æœç´¢å®ƒä»¬ã€‚è¿™ç§æ•°æ®ç»“æ„å¯¹äºåœ¨ç»™å®šçš„åŠå¾„æˆ–è¾¹ç•Œå†…å¯»æ‰¾é™„è¿‘çš„ç‚¹å¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-2&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ªç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œæ‰¾åˆ°ç¦»ä½ å½“å‰ä½ç½®æœ€è¿‘çš„æ‰€æœ‰ç”µåŠ¨æ±½è½¦å……ç”µç«™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ å‡ ä¸ªåœ°ç‚¹åˆ°åœ°ç†ç©ºé—´ç´¢å¼•ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; GEOADD locations:ca -122.27652 37.805186 station:1
(integer) 1
&amp;gt; GEOADD locations:ca -122.2674626 37.8062344 station:2
(integer) 1
&amp;gt; GEOADD locations:ca -122.2469854 37.8104049 station:3
(integer) 1
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¾åˆ°ç»™å®šåœ°ç‚¹5å…¬é‡ŒåŠå¾„å†…çš„æ‰€æœ‰ç«™ç‚¹ï¼Œå¹¶è¿”å›åˆ°æ¯ä¸ªç«™ç‚¹çš„è·ç¦»ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; GEOSEARCH locations:ca FROMLONLAT -122.2612767 37.7936847 BYRADIUS 5 km WITHDIST
1) 1) &amp;quot;station:1&amp;quot;
   2) &amp;quot;1.8523&amp;quot;
2) 1) &amp;quot;station:2&amp;quot;
   2) &amp;quot;1.4979&amp;quot;
3) 1) &amp;quot;station:3&amp;quot;
   2) &amp;quot;2.2441&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-2&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;GEOADD&lt;/strong&gt; å‘åœ°ç†ç©ºé—´ç´¢å¼•ä¸­æ·»åŠ åœ°ç†ä½ç½®ï¼ˆæ³¨æ„ç»åº¦åœ¨å‰ï¼Œçº¬åº¦åœ¨åï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GEOSEARCH&lt;/strong&gt; è¿”å›å…·æœ‰ç»™å®šåŠå¾„æˆ–è¾¹ç•Œçš„æ‰€æœ‰åœ°ç†ä½ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;hyperloglog&#34;&gt;HyperLogLog&lt;/h2&gt;
&lt;p&gt;HyperLogLogæ˜¯ä¼°è®¡é›†åˆçš„åŸºæ•°çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚é›†åˆçš„åŸºæ•°æ˜¯é›†åˆä¸­ä¸é‡å¤å…ƒç´ å…ƒç´ çš„æ•°ç›®ï¼Œæ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8},ï¼ŒåŸºæ•°ä¸º5ã€‚åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚ä½œä¸ºä¸€ç§æ¦‚ç‡æ•°æ®ç»“æ„ï¼ŒHyperLogLog ä»¥å®Œç¾çš„å‡†ç¡®æ€§æ¢å–æœ‰æ•ˆçš„ç©ºé—´åˆ©ç”¨ã€‚&lt;br&gt;
Redis HyperLogLog å®ç°æœ€å¤šä½¿ç”¨12 KBï¼Œæ ‡å‡†è¯¯å·®ä¸º0.81%ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-3&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å‘ HyperLogLog ä¸­æ·»åŠ å…ƒç´ &lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; PFADD members 123
(integer) 1
&amp;gt; PFADD members 500
(integer) 1
&amp;gt; PFADD members 12
(integer) 1
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¼°è®¡é›†åˆæˆå‘˜æ•°é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; PFCOUNT members
(integer) 3
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-3&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PFADD&lt;/strong&gt; å‘ HyperLogLog æ·»åŠ å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PFCOUNT&lt;/strong&gt; è¿”å›é›†åˆä¸­æˆå‘˜æ•°é‡çš„ä¼°è®¡å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PFMERGE&lt;/strong&gt; å°†ä¸¤ä¸ªæˆ–å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-2&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å‘ HyperLogLog å†™ (PFADD) å’Œè¯» (PFCOUNT) æ˜¯åœ¨å¸¸é‡æ—¶é—´å’Œç©ºé—´å†…å®Œæˆçš„ã€‚åˆå¹¶æ˜¯ O(n)ï¼Œå…¶ä¸­ n ä¸ºåˆå¹¶çš„ HyperLogLog æ•°é‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é™åˆ¶&#34;&gt;é™åˆ¶&lt;/h3&gt;
&lt;p&gt;HyperLogLog å¯ä»¥ä¼°è®¡æœ€å¤š2^64(18,446,744,073,709,551,616)ä¸ªæˆå‘˜çš„é›†åˆçš„åŸºæ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bitmap-ä½å›¾&#34;&gt;Bitmap ä½å›¾&lt;/h2&gt;
&lt;p&gt;Redis ä½å›¾æ˜¯å­—ç¬¦ä¸²æ•°æ®ç±»å‹çš„æ‰©å±•ï¼Œå®ƒå¯ä»¥å°†å­—ç¬¦ä¸²å½“ä½œä½å‘é‡ï¼ˆç”±ä¸€äº›äºŒè¿›åˆ¶ä½ç»„æˆçš„å‘é‡ï¼‰ã€‚è¿˜å¯ä»¥å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²æ‰§è¡Œä½æ“ä½œã€‚ä½å›¾çš„ä¸€äº›ä½¿ç”¨åœºæ™¯:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ•ˆçš„é›†åˆè¡¨ç¤ºï¼Œç”¨äºé›†åˆçš„æˆå‘˜å¯¹åº”äºæ•´æ•°0-Nçš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;å¯¹è±¡æƒé™ï¼Œå…¶ä¸­æ¯ä¸ªä½ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„æƒé™ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æƒé™çš„æ–¹å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-4&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;p&gt;å‡è®¾æœ‰ 1000 ä¸ªéƒ¨ç½²åœ¨ç°åœºçš„ä¼ æ„Ÿå™¨ï¼Œæ ‡è®°ä¸º 0-999ã€‚å¸Œæœ›å¿«é€Ÿç¡®å®šæŸä¸ªä¼ æ„Ÿå™¨æ˜¯å¦åœ¨æŸä¸ªæ—¶é—´ ping äº†æœåŠ¡å™¨ã€‚å¯ä»¥ç”¨ä½å›¾å¤„ç†è¿™ç§åœºæ™¯ï¼Œè¿™ä¸ªä½å›¾çš„é”®æ˜¯æ—¶é—´ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ æ„Ÿå™¨ 123 åœ¨2024-01-01-00:00 ping äº†æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SETBIT pings:2024-01-01-00:00 123 1
(integer) 0
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ æ„Ÿå™¨123æ˜¯å¦åœ¨2024-01-01-00:00 ping äº†æœåŠ¡å™¨&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; GETBIT pings:2024-01-01-00:00 123
1
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ æ„Ÿå™¨ 456 å‘¢ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; GETBIT pings:2024-01-01-00:00 456
0
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-4&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SETBIT&lt;/strong&gt; å°†æŒ‡å®šåç§»é‡çš„ä½çš„å€¼è®¾ç½®ä¸º 0 æˆ– 1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GETBIT&lt;/strong&gt; è¿”å›æŒ‡å®šåç§»é‡çš„ä½çš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BITOP&lt;/strong&gt; å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²è¿›è¡Œä½æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-3&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;SETBIT&lt;/strong&gt; å’Œ &lt;strong&gt;GETBIT&lt;/strong&gt; ä¸º0(1)ã€‚BITOP æ˜¯ O(n)ï¼Œå…¶ä¸­ n æ˜¯æœ€é•¿å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚&lt;/p&gt;
">Redis (3) æ•°æ®ç±»å‹ï¼ˆStream/Geospatial/HyperLogLog/Bitmapï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/f3KuchnPs/"" data-c="
          &lt;p&gt;æœ¬æ–‡å­¦ä¹ åŸºæœ¬çš„ Redis æ•°æ®ç±»å‹ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œå‡ä½¿ç”¨ &lt;code&gt;redis-cli&lt;/code&gt; å®Œæˆã€‚æ¥æº &lt;a href=&#34;https://redis.io/docs/data-types/&#34;&gt;Redis æ•°æ®ç±»å‹&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;é”®&#34;&gt;é”®&lt;/h2&gt;
&lt;p&gt;Redis é”®æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨ä»»ä½•äºŒè¿›åˆ¶åºåˆ—ä½œä¸ºé”®ï¼Œä»å½¢å¦‚ &amp;quot;foo&amp;quot; çš„å­—ç¬¦ä¸²åˆ° JPEG æ–‡ä»¶çš„å†…å®¹ï¼Œç”šè‡³ç©ºå­—ç¬¦ä¸²ä¹Ÿæ˜¯æœ‰æ•ˆé”®ã€‚&lt;br&gt;
å‡ æ¡å…³äºé”®çš„è§„åˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸æ¨èéå¸¸å¤§çš„é”®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª1024å­—èŠ‚çš„é”®ï¼Œä¸ä»…åœ¨å†…å­˜æ–¹é¢ï¼Œè€Œä¸”è¿˜å› ä¸ºåœ¨æ•°æ®åº“æŸ¥æ‰¾è¯¥é”®å¯èƒ½éœ€è¦å‡ æ¬¡æ˜‚è´µçš„æ¯”è¾ƒã€‚å¯¹è¯¥é”®è¿›è¡Œæ•£åˆ—ï¼ˆä¾‹å¦‚ SHA1ï¼‰æ˜¯ä¸€ä¸ªæ›´å¥½çš„ä¸»æ„ï¼Œç‰¹åˆ«æ˜¯ä»å†…å­˜å’Œå¸¦å®½çš„è§’åº¦æ¥çœ‹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸æ¨èéå¸¸çŸ­çš„é”®ã€‚æŠŠ &amp;quot;u1000flw&amp;quot; ä½œé”®å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå¦‚æœå†™æˆ &amp;quot;user:1000:followers&amp;quot; æ›´å…·å¯è¯»æ€§ï¼Œè€Œä¸”ä¸é”®å¯¹è±¡æœ¬èº«å’Œå€¼å¯¹è±¡ä½¿ç”¨çš„ç©ºé—´ç›¸æ¯”ï¼Œå¢åŠ çš„ç©ºé—´å¾ˆå°ã€‚&lt;/li&gt;
&lt;li&gt;åšæŒä½¿ç”¨æŸç§æ¨¡å¼ã€‚ä¾‹å¦‚&amp;quot;ç±»å‹:id&amp;quot;ï¼Œå¦‚ &amp;quot;user:1000&amp;quot;ã€‚ç‚¹æˆ–ç ´æŠ˜å·é€šå¸¸ç”¨äºå¤šå­—æ®µï¼Œå¦‚ &amp;quot;comment:4321:reply.to&amp;quot; æˆ– &amp;quot;comment:4321:reply-to&amp;quot;ã€‚&lt;/li&gt;
&lt;li&gt;é”®æœ€å¤§å…è®¸ 512MB&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;string-å­—ç¬¦ä¸²&#34;&gt;String å­—ç¬¦ä¸²&lt;/h2&gt;
&lt;p&gt;Redis å­—ç¬¦ä¸²å­˜å‚¨å­—èŠ‚åºåˆ—ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€åºåˆ—åŒ–å¯¹è±¡å’ŒäºŒè¿›åˆ¶æ•°ç»„ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸²æ˜¯æœ€åŸºæœ¬çš„Redisæ•°æ®ç±»å‹ã€‚å®ƒä»¬ç»å¸¸è¢«ç”¨äºç¼“å­˜ï¼Œä½†å®ƒä»¬ä¹Ÿæ”¯æŒé¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å®ç°è®¡æ•°å™¨å’Œæ‰§è¡Œä½æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨å¹¶æ£€ç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SET user:1 salvatore
OK
&amp;gt; GET user:1
&amp;quot;salvatore&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨ JSON å­—ç¬¦ä¸²å¹¶è®¾ç½® 10 ç§’åè¿‡æœŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SET ticket:27 &amp;quot;\&amp;quot;{&#39;username&#39;: &#39;priya&#39;, &#39;ticket_id&#39;: 321}\&amp;quot;&amp;quot; EX 100
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;è®¡æ•°å™¨é€’å¢&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; INCR views:page:2
(integer) 1
&amp;gt; INCRBY views:page:2 10
(integer) 11
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é™åˆ¶&#34;&gt;é™åˆ¶&lt;/h3&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis å­—ç¬¦ä¸²çš„æœ€å¤§å®¹é‡ä¸º512MBã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;h4 id=&#34;å­˜å‚¨å’Œæ£€ç´¢&#34;&gt;å­˜å‚¨å’Œæ£€ç´¢&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SET&lt;/strong&gt;: å­˜å‚¨å­—ç¬¦ä¸²å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SETNX&lt;/strong&gt;: åªåœ¨é”®ä¸å­˜åœ¨çš„æƒ…å†µä¸‹å­˜å‚¨å­—ç¬¦ä¸²å€¼ã€‚å¯¹äºå®ç°é”å¾ˆæœ‰ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GET&lt;/strong&gt;: æ£€ç´¢å­—ç¬¦ä¸²å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;MGET&lt;/strong&gt;: åœ¨ä¸€ä¸ªæ“ä½œä¸­æ£€ç´¢å¤šä¸ªå­—ç¬¦ä¸²å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;è®¡æ•°å™¨&#34;&gt;è®¡æ•°å™¨&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;INCRBY&lt;/strong&gt; æ˜¯ä»¥åŸå­æ–¹å¼é€’å¢ï¼ˆå½“ä¼ é€’è´Ÿæ•°æ—¶åˆ™é€’å‡ï¼‰è®¡æ•°å™¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;INCRBYFLOAT&lt;/strong&gt; é€‚ç”¨äºæµ®ç‚¹å‹è®¡æ•°å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ä½è¿ç®—&#34;&gt;ä½è¿ç®—&lt;/h4&gt;
&lt;p&gt;å‚è§åæ–‡ bitmap æ•°æ®ç±»å‹&lt;/p&gt;
&lt;h3 id=&#34;æ€§èƒ½&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°å­—ç¬¦ä¸²æ“ä½œéƒ½æ˜¯ O(1)ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„æ•ˆç‡å¾ˆé«˜ã€‚ç„¶è€Œï¼Œè¦æ³¨æ„ &lt;strong&gt;SUBSTR&lt;/strong&gt;ã€&lt;strong&gt;GETRANGE&lt;/strong&gt; å’Œ &lt;strong&gt;SETRANGE&lt;/strong&gt; å‘½ä»¤ï¼Œå®ƒä»¬å¯èƒ½æ˜¯O(n)ã€‚è¿™äº›éšæœºè®¿é—®çš„å­—ç¬¦ä¸²å‘½ä»¤åœ¨å¤„ç†å¤§å­—ç¬¦ä¸²æ—¶å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;list-åˆ—è¡¨&#34;&gt;List åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;Redis åˆ—è¡¨æ˜¯å­—ç¬¦ä¸²å€¼çš„é“¾è¡¨ã€‚Redis åˆ—è¡¨ç»å¸¸ç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°å †æ ˆå’Œé˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºåå°å·¥ä½œç³»ç»Ÿæ„å»ºé˜Ÿåˆ—ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-2&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å°†åˆ—è¡¨ç”¨ä½œé˜Ÿåˆ—ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; LPUSH work:queue:ids 101
(integer) 1
&amp;gt; LPUSH work:queue:ids 237
(integer) 2
&amp;gt; RPOP work:queue:ids
&amp;quot;101&amp;quot;
&amp;gt; RPOP work:queue:ids
&amp;quot;237&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å°†åˆ—è¡¨ç”¨ä½œæ ˆï¼ˆå…ˆè¿›åå‡ºï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; LPUSH work:queue:ids 101
(integer) 1
&amp;gt; LPUSH work:queue:ids 237
(integer) 2
&amp;gt; LPOP work:queue:ids
&amp;quot;237&amp;quot;
&amp;gt; LPOP work:queue:ids
&amp;quot;101&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;åˆ—è¡¨é•¿åº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; LLEN work:queue:ids
(integer) 0
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;åŸå­åœ°ä»ä¸€ä¸ªåˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ å¹¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; LPUSH board:todo:ids 101
(integer) 1
&amp;gt; LPUSH board:todo:ids 273
(integer) 2
&amp;gt; LMOVE board:todo:ids board:in-progress:ids LEFT LEFT
&amp;quot;273&amp;quot;
&amp;gt; LRANGE board:todo:ids 0 -1
1) &amp;quot;101&amp;quot;
&amp;gt; LRANGE board:in-progress:ids 0 -1
1) &amp;quot;273&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæƒ³è¦åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šè¶…è¿‡ 100 ä¸ªå…ƒç´ çš„ä¸Šé™åˆ—è¡¨ï¼Œä½ å¯ä»¥åœ¨æ¯æ¬¡è°ƒç”¨ &lt;strong&gt;LPUSH&lt;/strong&gt; åè°ƒç”¨ &lt;strong&gt;LTRIM&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; LPUSH notifications:user:1 &amp;quot;You&#39;ve got mail!&amp;quot;
(integer) 1
&amp;gt; LTRIM notifications:user:1 0 99
OK
&amp;gt; LPUSH notifications:user:1 &amp;quot;Your package will be delivered at 12:01 today.&amp;quot;
(integer) 2
&amp;gt; LTRIM notifications:user:1 0 99
OK
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é™åˆ¶-2&#34;&gt;é™åˆ¶&lt;/h3&gt;
&lt;p&gt;Redisåˆ—è¡¨çš„æœ€å¤§é•¿åº¦æ˜¯ 2^32-1ï¼ˆ4,294,967,295ï¼‰ä¸ªå…ƒç´ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-2&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;LPUSH&lt;/strong&gt; åœ¨åˆ—è¡¨çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼›&lt;strong&gt;RPUSH&lt;/strong&gt; åœ¨å°¾éƒ¨æ·»åŠ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LPOP&lt;/strong&gt; ä»ä¸€ä¸ªåˆ—è¡¨çš„å¤´éƒ¨åˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´ ï¼›&lt;strong&gt;RPOP&lt;/strong&gt; ä»åˆ—è¡¨çš„å°¾éƒ¨åˆ é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LLEN&lt;/strong&gt; è¿”å›ä¸€ä¸ªåˆ—è¡¨çš„é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LMOVE&lt;/strong&gt; å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨ä¸­åŸå­åœ°ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LTRIM&lt;/strong&gt; å°†ä¸€ä¸ªåˆ—è¡¨å‡å°‘åˆ°åŒ…å«æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é˜»å¡å‘½ä»¤&#34;&gt;é˜»å¡å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;åˆ—è¡¨æ”¯æŒå‡ ä¸ªå°é”å‘½ä»¤ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;BLPOP&lt;/strong&gt; ä»ä¸€ä¸ªåˆ—è¡¨çš„å¤´éƒ¨ç§»é™¤å¹¶è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œè¯¥å‘½ä»¤ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰å…ƒç´ æˆ–è€…è¾¾åˆ°æŒ‡å®šè¶…æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BLMOVE&lt;/strong&gt; åŸå­åœ°å°†å…ƒç´ ä»æºåˆ—è¡¨ä¸­ç§»åŠ¨åˆ°ç›®æ ‡åˆ—è¡¨ä¸­ã€‚å¦‚æœæºåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œè¯¥å‘½ä»¤ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰å…ƒç´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-2&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;è®¿é—®åˆ—è¡¨å¤´éƒ¨æˆ–å°¾éƒ¨çš„æ“ä½œæ˜¯ O(1)ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„æ•ˆç‡å¾ˆé«˜ã€‚ç„¶è€Œï¼Œæ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ çš„å‘½ä»¤é€šå¸¸æ˜¯&lt;br&gt;
O(n)ï¼Œå¯¹å¤§åˆ—è¡¨è¿è¡Œ &lt;strong&gt;LINDEX&lt;/strong&gt;, &lt;strong&gt;LINSERT&lt;/strong&gt;, å’Œ &lt;strong&gt;LSET&lt;/strong&gt; å‘½ä»¤æ—¶è¦å°å¿ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;set-é›†åˆ&#34;&gt;Set é›†åˆ&lt;/h2&gt;
&lt;p&gt;Redis çš„ Set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ã€‚å¯ä»¥ä½¿ç”¨ Redis é›†åˆæ¥æœ‰æ•ˆåœ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿½æº¯å”¯ä¸€é¡¹ï¼ˆä¾‹å¦‚ï¼Œè¿½æº¯è®¿é—®ç»™å®šåšå®¢æ–‡ç« çš„æ‰€æœ‰å”¯ä¸€IPåœ°å€ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è¡¨ç¤ºå…³ç³»ï¼ˆä¾‹å¦‚ï¼Œå…·æœ‰ç‰¹å®šè§’è‰²çš„æ‰€æœ‰ç”¨æˆ·çš„é›†åˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå¸¸è§çš„é›†åˆæ“ä½œï¼Œå¦‚äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-3&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨ç”¨æˆ·123å’Œ456çš„æœ€å–œæ¬¢çš„å›¾ä¹¦IDé›†ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SADD user:123:favorites 347
(integer) 1
&amp;gt; SADD user:123:favorites 561
(integer) 1
&amp;gt; SADD user:123:favorites 742
(integer) 1
&amp;gt; SADD user:456:favorites 561
(integer) 1
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥ç”¨æˆ·123æ˜¯å¦å–œæ¬¢ä¹¦742å’Œ299&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SISMEMBER user:123:favorites 742
(integer) 1
&amp;gt; SISMEMBER user:123:favorites 299
(integer) 0
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·123å’Œ456å‡å–œæ¬¢çš„ä¹¦&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SINTER user:123:favorites user:456:favorites
1) &amp;quot;561&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·123æ”¶è—äº†å¤šå°‘æœ¬ä¹¦ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SCARD user:123:favorites
(integer) 3
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;é™åˆ¶-3&#34;&gt;é™åˆ¶&lt;/h3&gt;
&lt;p&gt;Redis é›†åˆæœ€å¤šå®¹çº³2^32 - 1 (4,294,967,295)ä¸ªæˆå‘˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-3&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;SADD&lt;/strong&gt; å‘é›†åˆæ·»åŠ æ–°æˆå‘˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SREM&lt;/strong&gt; ä»é›†åˆä¸­åˆ é™¤æŒ‡å®šæˆå‘˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SISMEMBER&lt;/strong&gt; æµ‹è¯•å­—ç¬¦ä¸²æ˜¯å¦æ˜¯é›†åˆæˆå‘˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SINTER&lt;/strong&gt; è¿”å›ä¸¤ä¸ªæˆ–å¤šä¸ªé›†åˆçš„äº¤é›†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SCARD&lt;/strong&gt; è¿”å›é›†åˆçš„å¤§å°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-3&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°é›†åˆæ“ä½œï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤å’Œæ£€æŸ¥æ˜¯å¦æ˜¯é›†åˆæˆå‘˜ï¼Œéƒ½æ˜¯ O(1)ã€‚è¿™æ„å‘³ç€å®ƒä»¬æ˜¯éå¸¸é«˜æ•ˆçš„ã€‚ç„¶è€Œï¼Œ&lt;strong&gt;SMEMBERS&lt;/strong&gt; æ˜¯ O(n)ï¼Œå®ƒè¿”å›æ•´ä¸ªé›†åˆã€‚å¯¹äºæœ‰å‡ åä¸‡ä¸ªæˆå‘˜æˆ–æ›´å¤§çš„å¤§å‹é›†åˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨&lt;strong&gt;SSCAN&lt;/strong&gt;ï¼Œå®ƒå¯ä»¥è¿­ä»£åœ°æ£€ç´¢ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰æˆå‘˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;hash-å“ˆå¸Œ&#34;&gt;Hash å“ˆå¸Œ&lt;/h2&gt;
&lt;p&gt;å“ˆå¸Œæ˜¯é”®å€¼å¯¹çš„é›†åˆæ„é€ çš„è®°å½•ç±»å‹ã€‚å¯ä»¥ä½¿ç”¨å“ˆå¸Œæ¥è¡¨ç¤ºå¯¹è±¡å’Œåˆ†ç»„è®¡ç®—å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-4&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨å“ˆå¸Œè¡¨ç¤ºç”¨æˆ·èµ„æ–™&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; HSET user:123 username martina firstName Martina lastName Elisa country GB
(integer) 4
&amp;gt; HGET user:123 username
&amp;quot;martina&amp;quot;
&amp;gt; HGETALL user:123
1) &amp;quot;username&amp;quot;
2) &amp;quot;martina&amp;quot;
3) &amp;quot;firstName&amp;quot;
4) &amp;quot;Martina&amp;quot;
5) &amp;quot;lastName&amp;quot;
6) &amp;quot;Elisa&amp;quot;
7) &amp;quot;country&amp;quot;
8) &amp;quot;GB&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å­˜å‚¨è®¾å¤‡ 777 ping æœåŠ¡å™¨ã€å‘å‡ºè¯·æ±‚æˆ–å‘é€é”™è¯¯çš„æ¬¡æ•°çš„è®¡æ•°å™¨ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; HINCRBY device:777:stats pings 1
(integer) 1
&amp;gt; HINCRBY device:777:stats pings 1
(integer) 2
&amp;gt; HINCRBY device:777:stats pings 1
(integer) 3
&amp;gt; HINCRBY device:777:stats errors 1
(integer) 1
&amp;gt; HINCRBY device:777:stats requests 1
(integer) 1
&amp;gt; HGET device:777:stats pings
&amp;quot;3&amp;quot;
&amp;gt; HMGET device:777:stats requests errors
1) &amp;quot;1&amp;quot;
2) &amp;quot;1&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-4&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;HSET&lt;/strong&gt; è®¾ç½®å“ˆå¸Œä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µçš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HGET&lt;/strong&gt; è¿”å›ä¸€ä¸ªç»™å®šå­—æ®µçš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HMGET&lt;/strong&gt; è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªç»™å®šå­—æ®µçš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HINCRBY&lt;/strong&gt; å¢åŠ ç»™å®šå­—æ®µçš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-4&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°Rediså“ˆå¸Œå‘½ä»¤æ˜¯O(1)ã€‚å°‘æ•°å‘½ä»¤ï¼Œå¦‚ &lt;strong&gt;HKEYS&lt;/strong&gt;ã€&lt;strong&gt;HVALS&lt;/strong&gt; å’Œ &lt;strong&gt;HGETALL&lt;/strong&gt; æ˜¯O(n)ï¼Œå…¶ä¸­ n æ˜¯ä¸€ä¸ªå“ˆå¸Œä¸­é”®å€¼å¯¹çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é™åˆ¶-4&#34;&gt;é™åˆ¶&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªå“ˆå¸Œæœ€å¤šå¯ä»¥å­˜å‚¨4,294,967,295ï¼ˆ2^32 - 1ï¼‰ä¸ªé”®å€¼å¯¹ã€‚å®è·µä¸­ï¼Œåªå—éƒ¨ç½² Redis æœºå™¨çš„å†…å­˜é™åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;sorted-set-æœ‰åºé›†åˆ&#34;&gt;Sorted Set æœ‰åºé›†åˆ&lt;/h2&gt;
&lt;p&gt;Redis æœ‰åºé›†åˆæ˜¯æŒ‰åˆ†æ•°æ’åºçš„å”¯ä¸€å­—ç¬¦ä¸²ï¼ˆæˆå‘˜ï¼‰çš„é›†åˆã€‚å½“ä¸€ä¸ªä»¥ä¸Šçš„å­—ç¬¦ä¸²å…·æœ‰ç›¸åŒçš„åˆ†æ•°æ—¶ï¼Œè¿™äº›å­—ç¬¦ä¸²å°†æŒ‰è¯å…¸æ’åºã€‚ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ’è¡Œæ¦œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æœ‰åºé›†åˆç»´æŠ¤å¤§å‹ç½‘ç»œæ¸¸æˆä¸­æœ€é«˜åˆ†çš„æœ‰åºåˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;é™æµå™¨ã€‚ä½¿ç”¨æ’åºé›†å»ºç«‹ä¸€ä¸ªæ»‘åŠ¨çª—å£é™æµå™¨ï¼Œä»¥é˜²æ­¢è¿‡å¤šçš„ API è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ç¤ºä¾‹-5&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å®æ—¶æ›´æ–°ç©å®¶çš„åˆ†æ•°æ’è¡Œæ¦œï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; ZADD leaderboard:455 100 user:1
(integer) 1
&amp;gt; ZADD leaderboard:455 75 user:2
(integer) 1
&amp;gt; ZADD leaderboard:455 101 user:3
(integer) 1
&amp;gt; ZADD leaderboard:455 15 user:4
(integer) 1
&amp;gt; ZADD leaderboard:455 275 user:2
(integer) 0
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;è·å–å‰3åç©å®¶çš„åˆ†æ•°ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; ZRANGE leaderboard:455 0 2 REV WITHSCORES
1) &amp;quot;user:2&amp;quot;
2) &amp;quot;275&amp;quot;
3) &amp;quot;user:3&amp;quot;
4) &amp;quot;101&amp;quot;
5) &amp;quot;user:1&amp;quot;
6) &amp;quot;100&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·2çš„æ’å&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; ZREVRANK leaderboard:455 user:2
(integer) 0
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åŸºç¡€å‘½ä»¤-5&#34;&gt;åŸºç¡€å‘½ä»¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ZADD&lt;/strong&gt; å°†æ–°æˆå‘˜å’Œåˆ†æ•°æ·»åŠ åˆ°é›†åˆã€‚å¦‚æœè¯¥æˆå‘˜å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆæ›´æ–°åˆ†æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZRANGE&lt;/strong&gt; è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZRANK&lt;/strong&gt; è¿”å›æˆå‘˜çš„æ’åï¼Œï¼ˆå‡åºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZREVRANK&lt;/strong&gt; è¿”å›æˆå‘˜çš„æ’åï¼ˆé™åºï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€§èƒ½-5&#34;&gt;æ€§èƒ½&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°æœ‰åºé›†åˆçš„æ“ä½œæ˜¯ O(log(n))ï¼Œå…¶ä¸­ n æ˜¯æˆå‘˜çš„æ•°é‡ã€‚åœ¨è¿è¡Œ &lt;strong&gt;ZRANGE&lt;/strong&gt; å‘½ä»¤æ—¶ï¼Œè¿”å›é›†åˆéå¸¸å¤§ï¼ˆä¾‹å¦‚ï¼Œæ•°ä»¥ä¸‡è®¡æˆ–æ›´å¤šï¼‰çš„æƒ…å†µä¸‹è¦è°¨æ…ä¸€äº›ï¼Œè¿™ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(log(n) + m)ï¼Œå…¶ä¸­ m æ˜¯è¿”å›çš„ç»“æœæ•°é‡ã€‚&lt;/p&gt;
">Redis (2) æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²/åˆ—è¡¨/é›†åˆ/å“ˆå¸Œ/æœ‰åºé›†åˆï¼‰</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/kEYDRAsfA/"" data-c="
          &lt;p&gt;ä»æºç ç¼–è¯‘å¹¶å®‰è£… Redisï¼Œç¯å¢ƒä¸º WSL2ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸‹è½½æºç &#34;&gt;ä¸‹è½½æºç &lt;/h2&gt;
&lt;p&gt;è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¸‹è½½ Redis æœ€æ–°ç¨³å®šç‰ˆæºç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;wget https://download.redis.io/redis-stable.tar.gz
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆåˆ‡æ¢åˆ°ä¸‹è½½ Redis æºç å‹ç¼©æ–‡ä»¶ç›®å½•è§£å‹æºç ï¼Œç„¶åè¿›å…¥æºç ç›®å½•å¹¶æ‰§è¡Œ &lt;code&gt;make&lt;/code&gt; å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;tar -xzvf redis-stable.tar.gz
cd redis-stable
make
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœç¼–è¯‘æˆåŠŸï¼Œåœ¨ src ç›®å½•ä¸‹ä¼šç”ŸæˆåŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶åœ¨å†…çš„ Redis äºŒè¿›åˆ¶æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;redis-serverï¼šRedis æœåŠ¡ç«¯&lt;/li&gt;
&lt;li&gt;redis-cli ä¸ redis æœåŠ¡ç«¯äº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœéœ€è¦å®‰è£…åˆ° &lt;code&gt;/usr/local/bin&lt;/code&gt; ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;make install
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å‰å°å¯åŠ¨å¹¶åœæ­¢-redis&#34;&gt;å‰å°å¯åŠ¨å¹¶åœæ­¢ Redis&lt;/h2&gt;
&lt;p&gt;å®‰è£… Reids åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¯åŠ¨ Redisï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-server
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœå¯åŠ¨æˆåŠŸï¼Œå°†ä¼šçœ‹åˆ°å¯åŠ¨æ—¥å¿—ï¼Œå¹¶ä¸” Redis åœ¨å‰å°è¿è¡Œï¼Œè¾“å…¥ Ctrl-C å³å¯åœæ­¢è¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;redis-cli-ä¸-redis-server-äº¤äº’&#34;&gt;redis-cli ä¸ redis server äº¤äº’&lt;/h2&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ä¸ redis æœåŠ¡å™¨è¿æ¥&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;redis-cli -h ip -p port
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;å­˜å‚¨å¹¶æ£€ç´¢&#34;&gt;å­˜å‚¨å¹¶æ£€ç´¢&lt;/h2&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å‘ redis æœåŠ¡å™¨å­˜å‚¨æ•°æ®å¹¶ä» redis æœåŠ¡å™¨æ£€ç´¢æ•°æ®ï¼ˆ&amp;gt; æ˜¯å‘½ä»¤è¡Œæç¤ºç¬¦ï¼‰&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; SET user:1 salvatore
OK
&amp;gt; GET user:1
&amp;quot;salvatore&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
">Redisï¼ˆ1ï¼‰ç¼–è¯‘å®‰è£…</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/1a-hQkc8c/"" data-c="
          &lt;p&gt;åœ¨ä»¥ä¸‹åœºæ™¯ &lt;code&gt;@Transaction&lt;/code&gt; äº‹åŠ¡ä¼šå¤±æ•ˆï¼š&lt;/p&gt;
&lt;h3 id=&#34;æŠŠæ³¨è§£æ ‡æ³¨åœ¨é-public-æ–¹æ³•&#34;&gt;æŠŠæ³¨è§£æ ‡æ³¨åœ¨é public æ–¹æ³•&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;private TransactionAttribute computeTransactionAttribute(Method method, Class&amp;lt;?&amp;gt; targetClass) {
    // Don&#39;t allow no-public methods as required.
    if (allowPublicMethodsOnly() &amp;amp;&amp;amp; !Modifier.isPublic(method.getModifiers())){
        return null;
    }
        ...
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;propagation-ä¼ æ’­è¡Œä¸ºé…ç½®ä¸åˆç†&#34;&gt;propagation ä¼ æ’­è¡Œä¸ºé…ç½®ä¸åˆç†&lt;/h3&gt;
&lt;p&gt;å¦‚æœé…ç½®ä»¥ä¸‹ 3 ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œäº‹åŠ¡å°†ä¸ä¼šå‘ç”Ÿå›æ»šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;TransactionDefinition.PROPAGATION_SUPPORTS&lt;/code&gt;: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TransactionDefinition.PROPAGATION_NOT_SUPPORTED&lt;/code&gt;: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TransactionDefinition.PROPAGATION_NEVER&lt;/code&gt;: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;rollback-å±æ€§è®¾ç½®é”™è¯¯&#34;&gt;rollback å±æ€§è®¾ç½®é”™è¯¯&lt;/h3&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ï¼ˆRuntimeException çš„å­ç±»ï¼‰æ—¶æ‰ä¼šå›æ»šï¼ŒError ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯ï¼Œåœ¨é‡åˆ°å—æŸ¥å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šã€‚&lt;/p&gt;
&lt;h3 id=&#34;åœ¨åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆ&#34;&gt;åœ¨åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´äº‹åŠ¡å¤±æ•ˆ&lt;/h3&gt;
&lt;p&gt;è‹¥åŒä¸€ç±»ä¸­æ–¹æ³•å†…éƒ¨è°ƒç”¨äº‹åŠ¡ä¼šå¤±æ•ˆã€‚è¿™æ˜¯ç”±äº Spring AOP ä»£ç†çš„åŸå› é€ æˆçš„ï¼Œå†…éƒ¨å†…éƒ¨è°ƒç”¨åªæ˜¯æ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œåªæœ‰å½“ &lt;code&gt;@Transactional&lt;/code&gt; æ³¨è§£çš„æ–¹æ³•åœ¨ç±»ä»¥å¤–è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šç”±Spring ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ç®¡ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»åŠ¨-catch-å¼‚å¸¸&#34;&gt;ä¸»åŠ¨ catch å¼‚å¸¸&lt;/h3&gt;
&lt;p&gt;ä¸»åŠ¨ catch å¼‚å¸¸ï¼Œä»£è¡¨æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡&#34;&gt;æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡&lt;/h3&gt;
&lt;p&gt;æ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¾‹å¦‚ MyISAMï¼Œå½“ç„¶ä¸ä¼šç”Ÿæ•ˆã€‚&lt;/p&gt;
">@Transaction æ³¨è§£å¤±æ•ˆåœºæ™¯</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/5PnOhK37O/"" data-c="
          &lt;p&gt;è‡ªåŠ¨é…ç½®æ˜¯ç”± Spring è‡ªåŠ¨å‘ç° &lt;code&gt;@Configuration&lt;/code&gt; ç±»ï¼Œå¹¶æ·»åŠ åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ã€‚è‡ªåŠ¨é…ç½®å¯èƒ½æ˜¯æœ‰æ¡ä»¶çš„ï¼Œå…¶æ¿€æ´»å–å†³äºå¤–éƒ¨å› ç´ ï¼Œä¾‹å¦‚å…·æœ‰ç‰¹å®šå€¼çš„æŸä¸ªé…ç½®å‚æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;springboot-å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…&#34;&gt;SpringBoot å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…&lt;/h2&gt;
&lt;p&gt;Spring Boot åº”ç”¨å¯åŠ¨å…¥å£é€šå¸¸å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@SpringBootApplication
public class DemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;@SpringBootApplication&lt;/code&gt; æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(
    excludeFilters = {@Filter(
    type = FilterType.CUSTOM,
    classes = {TypeExcludeFilter.class}
), @Filter(
    type = FilterType.CUSTOM,
    classes = {AutoConfigurationExcludeFilter.class}
)}
)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥æŠŠ &lt;code&gt;@SpringBootApplication&lt;/code&gt;  çœ‹ä½œ &lt;code&gt;@Configuration&lt;/code&gt;ã€&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;ã€&lt;code&gt;@ComponentScan&lt;/code&gt; æ³¨è§£çš„é›†åˆï¼Œä½œç”¨åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@Configuration&lt;/code&gt;ï¼šå…è®¸åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;ï¼šå¯ç”¨ Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ComponentScan&lt;/code&gt;ï¼šæ‰«æè¢« &lt;code&gt;@Component&lt;/code&gt; ( &lt;code&gt;@Service&lt;/code&gt;, &lt;code&gt;@Controller&lt;/code&gt;)æ³¨è§£çš„ beanã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;enableautoconfiguration-å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£&#34;&gt;&lt;code&gt;@EnableAutoConfiguration&lt;/code&gt;: å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£&lt;/h3&gt;
&lt;p&gt;&lt;code&gt; @EnableAutoConfiguration&lt;/code&gt; æ³¨è§£çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import({AutoConfigurationImportSelector.class})
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è‡ªåŠ¨è£…é…æ ¸å¿ƒåŠŸèƒ½çš„å®ç°å®é™…æ˜¯é€šè¿‡ &lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt; ç±»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;autoconfigurationimportselectoråŠ è½½è‡ªåŠ¨è£…é…ç±»&#34;&gt;AutoConfigurationImportSelector:åŠ è½½è‡ªåŠ¨è£…é…ç±»&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered {
}
public interface DeferredImportSelector extends ImportSelector {
}
public interface ImportSelector {
    String[] selectImports(AnnotationMetadata var1);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;AutoConfigurationImportSelector&lt;/code&gt; ç±»å®ç°äº† &lt;code&gt;ImportSelector&lt;/code&gt; æ¥å£ï¼Œ&lt;code&gt;selectImports&lt;/code&gt; æ–¹æ³•ä¸»è¦ç”¨äºè·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚&lt;code&gt;selectImports&lt;/code&gt; æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public String[] selectImports(AnnotationMetadata annotationMetadata) {
    // è‡ªåŠ¨è£…é…æ˜¯å¦æ‰“å¼€
    if (!this.isEnabled(annotationMetadata)) {
            return NO_IMPORTS;
    } else {
        // è·å–æ‰€æœ‰éœ€è¦è£…é…çš„ bean
        AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(annotationMetadata);
            return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;getAutoConfigurationEntry()&lt;/code&gt; æ–¹æ³•ä¸»è¦è´Ÿè´£åŠ è½½è‡ªåŠ¨é…ç½®ç±»ï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
    // è‡ªåŠ¨è£…é…æ˜¯å¦æ‰“å¼€
     if (!this.isEnabled(annotationMetadata)) {
         return EMPTY_ENTRY;
    } else {
        // ç”¨äºè·å–EnableAutoConfigurationæ³¨è§£ä¸­çš„ exclude å’Œ excludeName
        AnnotationAttributes attributes = this.getAttributes(annotationMetadata);
        // è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»
         List&amp;lt;String&amp;gt; configurations = this.getCandidateConfigurations(annotationMetadata, attributes);
         // ç§»é™¤ä¸æ»¡è¶³æ¡ä»¶çš„ç±»
        configurations = this.removeDuplicates(configurations);
        Set&amp;lt;String&amp;gt; exclusions = this.getExclusions(annotationMetadata, attributes);
        this.checkExcludedClasses(configurations, exclusions);
        configurations.removeAll(exclusions);
        configurations = this.getConfigurationClassFilter().filter(configurations);
        this.fireAutoConfigurationImportEvents(configurations, exclusions);
            return new AutoConfigurationEntry(configurations, exclusions);
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;åˆ¤æ–­è‡ªåŠ¨è£…é…æ˜¯å¦æ‰“å¼€ã€‚é»˜è®¤ &lt;code&gt;spring.boot.enableautoconfiguration=true&lt;/code&gt;ï¼Œå¯åœ¨ &lt;code&gt;application.properties&lt;/code&gt; æˆ– &lt;code&gt;application.yml&lt;/code&gt; ä¸­é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨äºè·å– &lt;code&gt;EnableAutoConfiguration&lt;/code&gt; æ³¨è§£ä¸­çš„ &lt;code&gt;exclude&lt;/code&gt; å’Œ &lt;code&gt;excludeName&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å– &lt;code&gt;META-INF/spring.factories&lt;/code&gt;ï¼Œè·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ç§»é™¤ä¸æ»¡è¶³æ¡ä»¶çš„ç±»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œ spring-boot-autoconfigure é¡¹ç›®ä¸­çš„  æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\
org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\
org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ ¹æ®æ­¤æ–‡ä»¶ï¼ŒSpring Boot å°†å°è¯•è¿è¡Œ RabbitMQã€Cassandraã€MongoDB å’Œ Hibernate çš„æ‰€æœ‰é…ç½®ç±»ã€‚è¿™äº›ç±»æ˜¯å¦è£…é…å°†å–å†³äºç±»è·¯å¾„æ˜¯å¦å­˜åœ¨ç±»ï¼Œä¾‹å¦‚ &lt;code&gt;MongoAutoConfiguration&lt;/code&gt;ï¼šã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Configuration
@ConditionalOnClass(MongoClient.class)
@EnableConfigurationProperties(MongoProperties.class)
@ConditionalOnMissingBean(type = &amp;quot;org.springframework.data.mongodb.MongoDbFactory&amp;quot;)
public class MongoAutoConfiguration {
    // configuration code
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Spring Boot æä¾›äº†ä¸€äº›æ¡ä»¶æ³¨è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnBean&lt;/code&gt;ï¼šå½“å®¹å™¨é‡Œæœ‰æŒ‡å®š Bean çš„æ¡ä»¶ä¸‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnMissingBean&lt;/code&gt;ï¼šå½“å®¹å™¨é‡Œæ²¡æœ‰æŒ‡å®š Bean çš„æƒ…å†µä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnSingleCandidate&lt;/code&gt;ï¼šå½“æŒ‡å®š Bean åœ¨å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªï¼Œæˆ–è€…è™½ç„¶æœ‰å¤šä¸ªä½†æ˜¯æŒ‡å®šé¦–é€‰ Beanã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnClass&lt;/code&gt;ï¼šå½“ç±»è·¯å¾„ä¸‹æœ‰æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnMissingClass&lt;/code&gt;ï¼šå½“ç±»è·¯å¾„ä¸‹æ²¡æœ‰æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnProperty&lt;/code&gt;ï¼šæŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnResource&lt;/code&gt;ï¼šç±»è·¯å¾„æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnExpression&lt;/code&gt;ï¼šåŸºäº SpEL è¡¨è¾¾å¼ä½œä¸ºåˆ¤æ–­æ¡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnJava&lt;/code&gt;ï¼šåŸºäº Java ç‰ˆæœ¬ä½œä¸ºåˆ¤æ–­æ¡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnJndi&lt;/code&gt;ï¼šåœ¨ JNDI å­˜åœ¨çš„æ¡ä»¶ä¸‹å·®åœ¨æŒ‡å®šçš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnNotWebApplication&lt;/code&gt;ï¼šå½“å‰é¡¹ç›®ä¸æ˜¯ Web é¡¹ç›®çš„æ¡ä»¶ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@ConditionalOnWebApplication&lt;/code&gt;ï¼šå½“å‰é¡¹ç›®æ˜¯ Web é¡¹ ç›®çš„æ¡ä»¶ä¸‹&lt;/li&gt;
&lt;/ul&gt;
">Spring Boot è‡ªåŠ¨é…ç½®</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/iDQygBprt/"" data-c="
          &lt;p&gt;å¾ˆå¤šå¼€æºæ¡†æ¶ä¹Ÿä½¿ç”¨äº†æ’ä»¶æ‰©å±•æ–¹å¼ï¼Œä¾‹å¦‚ï¼ŒDubbo é€šè¿‡ SPI æ–¹å¼å®ç°äº†æ’ä»¶åŒ–çš„æ•ˆæœã€‚MyBatis ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ’ä»¶æ‰©å±•æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;MyBatis å…è®¸è‡ªå®šä¹‰ Interceptor æ‹¦æˆª SQL è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸäº›å…³é”®é€»è¾‘ï¼Œå…è®¸æ‹¦æˆªçš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Executor ç±»ä¸­çš„ update()ã€query()ã€flushStatements()ã€commit()ã€rollback()ã€getTransaction()ã€close()ã€isClosed()æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ParameterHandler ä¸­çš„ setParameters()ã€getParameterObject() æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ResultSetHandlerä¸­çš„ handleOutputParameters()ã€handleResultSets()æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;StatementHandler ä¸­çš„parameterize()ã€prepare()ã€batch()ã€update()ã€query()æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–å†™æ’ä»¶çš„æ­¥éª¤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ç° &lt;code&gt;Interceptor&lt;/code&gt; æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;@Intercepts&lt;/code&gt; æ³¨è§£å®Œæˆæ’ä»¶ç­¾åã€‚&lt;/li&gt;
&lt;li&gt;åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œæ’ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;@Intercepts&lt;/code&gt; æ³¨è§£ä¸­å¯ä»¥é…ç½®å¤šä¸ª &lt;code&gt;@Signature&lt;/code&gt; æ³¨è§£ï¼Œ&lt;code&gt;@Signature&lt;/code&gt; æ³¨è§£ç”¨æ¥æŒ‡å®šæ’ä»¶å®ç°ç±»è¦æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•ä¿¡æ¯ï¼Œå…¶ä¸­çš„ &lt;code&gt;type&lt;/code&gt; å±æ€§æŒ‡å®šäº†è¦æ‹¦æˆªçš„ç±»ï¼Œ&lt;code&gt;method&lt;/code&gt; å±æ€§æŒ‡å®šäº†è¦æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•åç§°ï¼Œ&lt;code&gt;args&lt;/code&gt; å±æ€§æŒ‡å®šäº†è¦æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ã€‚é€šè¿‡ &lt;code&gt;@Signature&lt;/code&gt; æ³¨è§£ä¸­çš„è¿™ä¸‰ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¡®å®šè¦æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•çš„æ–¹æ³•ç­¾åã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»¥å®ç°å®¡è®¡åŠŸèƒ½æ’ä»¶ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;å®šä¹‰å‡ ä¸ªæ³¨è§£ï¼Œæ¥è¡¨æ˜ä¸€ä¸ªå­—æ®µæ˜¯éœ€è¦å®¡è®¡çš„ï¼Œå®ƒä»¬æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@CreateTime&lt;/code&gt;ï¼šåˆ›å»ºæ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@UpdateTime&lt;/code&gt;ï¼šæœ€åæ›´æ–°æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@CreateBy&lt;/code&gt;ï¼šåˆ›å»ºäººä¿¡æ¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@UpdateBy&lt;/code&gt;ï¼šæœ€åæ›´æ–°äººä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Slf4j
@Intercepts({
        @Signature(type = Executor.class, method = &amp;quot;update&amp;quot;, args = {MappedStatement.class, Object.class}),
        @Signature(type = StatementHandler.class, method = &amp;quot;prepare&amp;quot;, args = {Connection.class, Integer.class})
})
public class AuditingInterceptor implements Interceptor {
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        Object target = invocation.getTarget();
        if (target instanceof Executor) {
            Object[] args = invocation.getArgs();
            MappedStatement mappedStatement = (MappedStatement) args[0];
            Object parameter = args[1];
            setAuditValue(parameter, mappedStatement.getSqlCommandType());
        }
        if (target instanceof StatementHandler) {
            StatementHandler statementHandler = (StatementHandler) invocation.getTarget();
            replaceSQL(statementHandler);
        }

        Object result = invocation.proceed();
        AuditFiledContext.clear();
        return result;
    }

    @Override
    public Object plugin(Object target) {
        return Plugin.wrap(target, this);
    }

    private void setAuditValue(Object parameter, SqlCommandType sqlCommandType) throws IllegalAccessException {
        Class&amp;lt;?&amp;gt; aClass = parameter.getClass();
        List&amp;lt;Field&amp;gt; declaredFields = new ArrayList&amp;lt;&amp;gt;();
        declaredFields.addAll(List.of(aClass.getDeclaredFields()));
        declaredFields.addAll(List.of(aClass.getSuperclass().getDeclaredFields()));

        for (Field field : declaredFields) {
            if (SqlCommandType.INSERT.equals(sqlCommandType)) { // insert è¯­å¥æ’å…¥ createBy
                if (field.getAnnotation(CreateBy.class) != null) {
                    field.setAccessible(true);
                    field.set(parameter, AuditFiledContext.getUserName());
                    String column = field.getAnnotation(CreateBy.class).column();
                    AuditFiledContext.set(AuditFiledContext.CREATE_BY_COLUMN, column);
                    AuditFiledContext.set(AuditFiledContext.CREATE_BY_PROPERTY, field.getName());
                }

                if (field.getAnnotation(CreateTime.class) != null) { // insert è¯­å¥æ’å…¥ createTime
                    field.setAccessible(true);
                    field.set(parameter, new Date());
                    String column = field.getAnnotation(CreateTime.class).column();
                    AuditFiledContext.set(AuditFiledContext.CREATE_TIME_COLUMN, column);
                    AuditFiledContext.set(AuditFiledContext.CREATE_TIME_PROPERTY, field.getName());
                }
            } else if (SqlCommandType.UPDATE.equals(sqlCommandType)) {
                if (field.getAnnotation(UpdateBy.class) != null) { // update è¯­å¥æ’å…¥ updateBy
                    field.setAccessible(true);
                    field.set(parameter, AuditFiledContext.getUserName());
                    String column = field.getAnnotation(UpdateBy.class).column();
                    AuditFiledContext.set(AuditFiledContext.UPDATE_BY_COLUMN, column);
                    AuditFiledContext.set(AuditFiledContext.UPDATE_BY_PROPERTY, field.getName());
                }
                if (field.getAnnotation(UpdateTime.class) != null) { // update è¯­å¥æ’å…¥ updateTime
                    field.setAccessible(true);
                    field.set(parameter, new Date());
                    String column = field.getAnnotation(UpdateTime.class).column();
                    AuditFiledContext.set(AuditFiledContext.UPDATE_TIME_COLUMN, column);
                    AuditFiledContext.set(AuditFiledContext.UPDATE_TIME_PROPERTY, field.getName());
                }
            }
        }
    }

    private void replaceSQL(StatementHandler statementHandler) throws NoSuchFieldException, IllegalAccessException {
        MetaObject metaObject = MetaObject.forObject(
                statementHandler,
                SystemMetaObject.DEFAULT_OBJECT_FACTORY,
                SystemMetaObject.DEFAULT_OBJECT_WRAPPER_FACTORY,
                new DefaultReflectorFactory()
        );
        // è·å–æˆå‘˜å˜é‡ mappedStatement
        MappedStatement mappedStatement = (MappedStatement) metaObject.getValue(&amp;quot;delegate.mappedStatement&amp;quot;);
        BoundSql boundSql = statementHandler.getBoundSql();
        String originSQL = boundSql.getSql();
        Field field = boundSql.getClass().getDeclaredField(&amp;quot;sql&amp;quot;);
        String newSql = generateNewSql(mappedStatement.getSqlCommandType(), originSQL);
        field.setAccessible(true);
        field.set(boundSql, newSql);
        addParameterMapping(mappedStatement, boundSql);
    }

    private String generateNewSql(SqlCommandType sqlCommandType, String originalSQL) {
        String newSql = &amp;quot;&amp;quot;;
        if (SqlCommandType.UPDATE.equals(sqlCommandType)) {
            int i = originalSQL.indexOf(&amp;quot; set &amp;quot;);
            newSql = originalSQL.substring(0, i + 4) + &amp;quot; &amp;quot; + AuditFiledContext.get(AuditFiledContext.UPDATE_BY_COLUMN) + &amp;quot;=?, &amp;quot;
                    + AuditFiledContext.get(AuditFiledContext.UPDATE_TIME_COLUMN) + &amp;quot;=?, &amp;quot; + originalSQL.substring(i + 5);
        } else if (SqlCommandType.INSERT.equals(sqlCommandType)) {
            int i = originalSQL.indexOf(&amp;quot;(&amp;quot;);
            String addInsertFiled = originalSQL.substring(0, i + 1) + AuditFiledContext.get(AuditFiledContext.CREATE_BY_COLUMN) + &amp;quot;, &amp;quot;
                    + AuditFiledContext.get(AuditFiledContext.CREATE_TIME_COLUMN) + &amp;quot;, &amp;quot; + originalSQL.substring(i + 1);
            int i1 = addInsertFiled.indexOf(&amp;quot;values(&amp;quot;);
            newSql = addInsertFiled.substring(0, i1 + 7) + &amp;quot;?, ?, &amp;quot; + addInsertFiled.substring(i1 + 7);
        }
        return newSql;
    }

    private void addParameterMapping(MappedStatement mappedStatement, BoundSql boundSql) {
        List&amp;lt;ParameterMapping&amp;gt; parameterMappings = boundSql.getParameterMappings();
        if (mappedStatement.getSqlCommandType().equals(SqlCommandType.UPDATE)) {
            parameterMappings.add(0, new ParameterMapping.Builder(mappedStatement.getConfiguration(), AuditFiledContext.get(AuditFiledContext.UPDATE_TIME_PROPERTY), Date.class).build());
            parameterMappings.add(0, new ParameterMapping.Builder(mappedStatement.getConfiguration(), AuditFiledContext.get(AuditFiledContext.UPDATE_BY_PROPERTY), String.class).build());
        } else if (mappedStatement.getSqlCommandType().equals(SqlCommandType.INSERT)) {
            parameterMappings.add(0, new ParameterMapping.Builder(mappedStatement.getConfiguration(), AuditFiledContext.get(AuditFiledContext.CREATE_TIME_PROPERTY), Date.class).build());
            parameterMappings.add(0, new ParameterMapping.Builder(mappedStatement.getConfiguration(), AuditFiledContext.get(AuditFiledContext.CREATE_BY_PROPERTY), String.class).build());
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»£ç åŠæµ‹è¯•è¯·æŸ¥çœ‹&lt;a href=&#34;https://github.com/flipped94/mybatis-interceptor-audit&#34;&gt;ä»“åº“&lt;/a&gt;&lt;/p&gt;
">MyBatis æ’ä»¶</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/H34OOTkit/"" data-c="
          &lt;p&gt;åœ¨æ™®é€šçš„ä¸»ä»å¤åˆ¶æ–¹æ¡ˆä¸‹ï¼ˆå¦‚åœ¨ Spring Boot é›†æˆ Reids ä¸»ä»ä¸­æ‰€æè¿°çš„é‚£æ ·ï¼‰ï¼Œä¸€æ—¦ ä¸»èŠ‚ç‚¹å®•æœºï¼Œéœ€è¦æ‰‹åŠ¨æ¢å¤ä¸»èŠ‚ç‚¹æˆ–é€‰æ‹©ä»èŠ‚ç‚¹æˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼ˆéœ€è¦ä¿®æ”¹åº”ç”¨çš„ä¸»èŠ‚ç‚¹åœ°å€ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦äººå·¥å¹²é¢„ã€‚å¯ä»¥å€ŸåŠ© Redis Sentinelï¼ˆå“¨å…µï¼‰å®ç°è‡ªåŠ¨æ•…éšœåˆ‡æ¢ï¼Œè§£å†³è¿™ä¸ªç—›ç‚¹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä»€ä¹ˆæ˜¯-redis-sentinel&#34;&gt;ä»€ä¹ˆæ˜¯ Redis Sentinel&lt;/h1&gt;
&lt;p&gt;Sentinel æ˜¯ Redis çš„ä¸€ç§è¿è¡Œæ¨¡å¼ï¼Œä¾èµ–äº Redis å·¥ä½œï¼Œæœ¬èº«ä¸æä¾›è¯»å†™æœåŠ¡ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥è®© Redis ä»¥ Sentinel æ–¹å¼è¿è¡Œï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;redis-sentinel /path/to/sentinel.conf
æˆ–è€…
redis-server /path/to/sentinel.conf --sentinel
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;éƒ¨ç½²å•æœºæ¨¡æ‹Ÿ&#34;&gt;éƒ¨ç½²ã€å•æœºæ¨¡æ‹Ÿã€‘&lt;/h1&gt;
&lt;p&gt;ä¸‹é¢ä»¥ 3 ä¸ª Sentinel èŠ‚ç‚¹ï¼Œ1 ä¸ªä¸»èŠ‚ç‚¹ï¼Œ2 ä¸ªä»èŠ‚ç‚¹ç»„æˆä¸€ä¸ª Redis Sentinel ä¸ºä¾‹è¿›è¡Œéƒ¨ç½²&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;èŠ‚ç‚¹&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;ip&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;port&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;M&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6379&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;R1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6380&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;R2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;6381&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;S1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26379&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;S2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26380&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;S2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;127.0.0.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26381&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;pre&gt;&lt;code class=&#34;language-txt&#34;&gt;     +----+
       | M1 |
       | S1 |
       +----+
          |
+----+    |    +----+
| R2 |----+----| R3 |
| S2 |         | S3 |
+----+         +----+
Configuration: quorum = 2
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;M1 è¡¨ç¤ºä¸»èŠ‚ç‚¹ï¼ŒR1 å’Œ R2 è¡¨ç¤ºä»èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;S1ï¼ŒS2ï¼ŒS3 è¡¨ç¤ºå“¨å…µèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;quorum è¡¨ç¤ºåˆ¤å®šä¸»èŠ‚ç‚¹å¤±æ•ˆæœ€å°‘éœ€è¦çš„ä»²è£èŠ‚ç‚¹æ•°ã€‚è¿™é‡Œçš„å€¼ä¸º 2 ï¼Œå³å½“æœ‰ 2 ä¸ª sentinel è®¤ä¸ºä¸»èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œæ‰ç®—çœŸæ­£å¤±æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;è¿è¡ŒèŠ‚ç‚¹&#34;&gt;è¿è¡ŒèŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;èŠ‚ç‚¹é…ç½®åŠä»£ç å¯åœ¨ &lt;a href=&#34;https://github.com/flipped94/redis-sentinel-demo&#34;&gt;ä»“åº“&lt;/a&gt; æ‰¾åˆ°ã€‚ä¸»èŠ‚ç‚¹é…ç½®æ˜¯ Redis é»˜è®¤é…ç½®ï¼Œä»èŠ‚ç‚¹é…ç½®ä¸»è¦ä¿®æ”¹ replicaofï¼Œport, pidfile ç›¸å…³é…ç½®ã€‚å“¨å…µèŠ‚ç‚¹ä¸»è¦ä¿®æ”¹é»˜è®¤é…ç½®çš„ port å’Œ pidfile é…ç½®ã€‚&lt;br&gt;
è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;# å¯åŠ¨ä¸»èŠ‚ç‚¹åŠå“¨å…µ
redis-server redis-m.conf
redis-sentinel sentinel-m-s1.conf

# å¯åŠ¨ä»èŠ‚ç‚¹ R1 åŠå“¨å…µ
redis-server redis-r1.conf
redis-sentinel sentinel-r1-s2.conf

# å¯åŠ¨ä»èŠ‚ç‚¹ R2 åŠå“¨å…µ
redis-server redis-r2.conf
redis-sentinel sentinel-r2-s3.conf
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;spring-boot-ä½¿ç”¨-redis-ä¸»ä»&#34;&gt;Spring Boot ä½¿ç”¨ Redis ä¸»ä»&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º Spring Boot åº”ç”¨ä½¿ç”¨ Redis ä¸»ä»ï¼Œæ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼Œç¬¬äºŒä¸ªä¾èµ–æ˜¯ä¸ºäº†ä»æµè§ˆå™¨æˆ–Postman éªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
     &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
	&amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
	&amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®èŠ‚ç‚¹ application.yml&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;spring:
  redis:
    database: 0
    sentinel:
      master: mymaster
      nodes:
        - 127.0.0.1:26379
        - 127.0.0.1:26380
        - 127.0.0.1:26381
    lettuce:
      shutdown-timeout: 200ms
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½® Bean&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Configuration
public class RedisConfig {

    @Resource
    private RedisProperties redisProperties;

    @Bean
    public LettuceConnectionFactory lettuceConnectionFactory() {
        final RedisSentinelConfiguration sentinelConfiguration = new RedisSentinelConfiguration()
                .master(redisProperties.getSentinel().getMaster());
        final LettuceClientConfiguration lettuceClientConfiguration = LettuceClientConfiguration.builder()
                .readFrom(ReadFrom.ANY_REPLICA)
                .build();

        redisProperties.getSentinel().getNodes().forEach(node -&amp;gt; {
            final String[] sentinelNodes = node.split(&amp;quot;:&amp;quot;);
            final String host = sentinelNodes[0];
            final int port = Integer.parseInt(sentinelNodes[1]);
            sentinelConfiguration.sentinel(host, port);
        });

        LettuceConnectionFactory connectionFactory = new LettuceConnectionFactory(sentinelConfiguration, lettuceClientConfiguration);
        connectionFactory.setDatabase(redisProperties.getDatabase());
        return connectionFactory;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Controller&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RestController
public class RedisController {

    private static final String KEY = &amp;quot;REDIS_SENTINEL&amp;quot;;

    @Autowired
    private StringRedisTemplate template;

    @GetMapping(&amp;quot;/{value}&amp;quot;)
    public void addToSet(@PathVariable String value) {
        this.template.opsForSet().add(KEY, value);
    }

    @GetMapping(&amp;quot;/get&amp;quot;)
    public Set&amp;lt;String&amp;gt; getKeyValues() {
        return this.template.opsForSet().members(KEY);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä»æµè§ˆå™¨å‘é€å¦‚ä¸‹ä¸‰ä¸ªå†™è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;http://localhost:8080/write4
http://localhost:8080/write5
http://localhost:8080/write6
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä»æµè§ˆå™¨å‘é€è¯»è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;http://localhost:8080/get

è¯»è¯·æ±‚å“åº”
[
    &amp;quot;write4&amp;quot;,
    &amp;quot;write5&amp;quot;,
    &amp;quot;write6&amp;quot;
]
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;åœæ­¢ä¸»èŠ‚ç‚¹&lt;br&gt;
åœæ­¢ä¸»èŠ‚ç‚¹åï¼Œå°†ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»èŠ‚ç‚¹ï¼ŒæœŸé—´ä¸èƒ½å†™ï¼Œä½†æ˜¯å¯ä»¥è¯»ï¼Œåˆ‡æ¢åå°†ç»§ç»­å¯å†™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# åˆ‡æ¢ä¸»èŠ‚ç‚¹
MASTER MODE enabled (user request from &#39;id=6 addr=127.0.0.1:59774 laddr=127.0.0.1:6380 fd=11 name=sentinel-942a512e-cmd age=762 idle=0 flags=x db=0 sub=0 psub=0 ssub=0 multi=4 qbuf=188 qbuf-free=20286 argv-mem=4 multi-mem=169 rbs=2048 rbp=1024 obl=45 oll=0 omem=0 tot-mem=23717 events=r cmd=exec user=default redir=-1 resp=2 lib-name= lib-ver=&#39;)
&lt;/code&gt;&lt;/pre&gt;
">Spring Boot é›†æˆ Redis Sentinel</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/WaSvElZr4/"" data-c="
          &lt;p&gt;å•æœº Redis å­˜åœ¨å•ç‚¹é£é™©é—®é¢˜ï¼Œæœ€ç®€å•çš„å¤„ç†æ–¹æ³•å°±æ˜¯ä¸»ä»å¤åˆ¶ï¼Œæœ¬æ–‡ä½¿ç”¨ Spring Boot æ¼”ç¤º Redis ä¸»ä»å¤åˆ¶ï¼ˆä¸€ä¸»ä¸¤ä»ï¼‰ï¼Œç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;br&gt;
&lt;img src=&#34;https://github.com/flipped94/redis-master-slave-demo/blob/main/image/redis-master-slave.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;è¿è¡Œ-redis-ä¸»ä»&#34;&gt;è¿è¡Œ Redis ä¸»ä»&lt;/h1&gt;
&lt;p&gt;è¿è¡Œ Redis ä¸»ä»èŠ‚ç‚¹çš„é…ç½®åŠä»£ç å¯åœ¨ &lt;a href=&#34;https://github.com/flipped94/redis-master-slave-demo&#34;&gt;ä»“åº“&lt;/a&gt; æ‰¾åˆ°ã€‚ä¸»è¦ä¿®æ”¹ä»èŠ‚ç‚¹ replicaofï¼Œport, pidfile ç›¸å…³é…ç½®ï¼Œmaster èŠ‚ç‚¹é…ç½®æ˜¯ Redis é»˜è®¤é…ç½®ã€‚&lt;/p&gt;
&lt;h1 id=&#34;spring-boot-ä½¿ç”¨-redis-ä¸»ä»&#34;&gt;Spring Boot ä½¿ç”¨ Redis ä¸»ä»&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»º Spring Boot åº”ç”¨ä½¿ç”¨ Redis ä¸»ä»ï¼Œæ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼Œç¬¬äºŒä¸ªä¾èµ–æ˜¯ä¸ºäº†ä»æµè§ˆå™¨æˆ–Postman éªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
     &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
	&amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
	&amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½®èŠ‚ç‚¹ application.yml&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;redis:
  master:
    host: 127.0.0.1
    port: 6379
  slaves:
    - host: 127.0.0.1
      port: 6380
    - host: 127.0.0.1
      port: 6381
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;é…ç½® Bean&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Data
public class RedisInstance {

    private String host;

    private int port;
}

@Configuration
@ConfigurationProperties(prefix = &amp;quot;redis&amp;quot;)
@Data
public class RedisConfiguration {

    private RedisInstance master;

    private List&amp;lt;RedisInstance&amp;gt; slaves;

    @Bean
    public LettuceConnectionFactory redisConnectionFactory() {
        LettuceClientConfiguration clientConfig = LettuceClientConfiguration.builder()
                .readFrom(ReadFrom.REPLICA_PREFERRED)
                .build();
        RedisStaticMasterReplicaConfiguration staticMasterReplicaConfiguration =
                new RedisStaticMasterReplicaConfiguration(this.getMaster().getHost(), this.getMaster().getPort());
        this.getSlaves().forEach(slave -&amp;gt; staticMasterReplicaConfiguration.addNode(slave.getHost(), slave.getPort()));
        return new LettuceConnectionFactory(staticMasterReplicaConfiguration, clientConfig);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Controller&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@RestController
public class RedisController {

    private static final String KEY = &amp;quot;REDIS_SENTINEL&amp;quot;;

    @Autowired
    private StringRedisTemplate template;

    @GetMapping(&amp;quot;/{value}&amp;quot;)
    public void addToSet(@PathVariable String value) {
        this.template.opsForSet().add(KEY, value);
    }

    @GetMapping(&amp;quot;/get&amp;quot;)
    public Set&amp;lt;String&amp;gt; getKeyValues() {
        return this.template.opsForSet().members(KEY);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä»æµè§ˆå™¨å‘é€å¦‚ä¸‹ä¸‰ä¸ªå†™è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;http://localhost:8080/write1
http://localhost:8080/write2
http://localhost:8080/write3
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ä»æµè§ˆå™¨å‘é€è¯»è¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;http://localhost:8080/get

è¯»è¯·æ±‚å“åº”
[
    &amp;quot;write1&amp;quot;,
    &amp;quot;write2&amp;quot;,
    &amp;quot;write3&amp;quot;
]
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;åœæ­¢ä¸»èŠ‚ç‚¹&lt;br&gt;
åœæ­¢ä¸»èŠ‚ç‚¹åï¼Œåº”ç”¨å°†æ— æ³•è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œå°è¯•æ·»åŠ æ–°é¡¹ï¼Œè¯·æ±‚ä¼šè¢« hang ä½ï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸è¯»å–ã€‚é‡æ–°å¯åŠ¨ä¸»èŠ‚ç‚¹åï¼Œå†™å°†æ¢å¤ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;[xecutorLoop-1-3] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was /127.0.0.1:6379
[oEventLoop-6-10] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [127.0.0.1:6379]: Connection closed prematurely
&lt;/code&gt;&lt;/pre&gt;
">Spring Boot é›†æˆ Redis ä¸»ä»å¤åˆ¶</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/UqOG-r8J9/"" data-c="
          &lt;p&gt;æœ¬æ–‡ä¸»è¦å…³äº Kafka Producer è®¾è®¡å’Œ Producer APIã€‚&lt;/p&gt;
&lt;h2 id=&#34;producer-è®¾è®¡&#34;&gt;Producer è®¾è®¡&lt;/h2&gt;
&lt;h3 id=&#34;è´Ÿè½½å‡è¡¡&#34;&gt;è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;Producer ç›´æ¥å°†æ•°æ®å‘é€ç»™ä½œä¸ºåˆ†åŒºé¢†å¯¼è€…çš„ä»£ç†ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä»‹å…¥çš„è·¯ç”±å±‚ã€‚ä¸ºäº†å¸®åŠ© Producer åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€æœ‰çš„ Kafka èŠ‚ç‚¹å¯ä»¥åœ¨ä»»ä½•æ—¶é—´ï¼Œå“åº”å…³äºå“ªäº›æœåŠ¡å™¨å¤„äºæ´»åŠ¨çŠ¶æ€ä»¥åŠä¸»é¢˜çš„åˆ†åŒºçš„é¢†å¯¼è€…åœ¨å“ªé‡Œçš„å…ƒæ•°æ®è¯·æ±‚ï¼Œä»¥ä¾¿ Producer é€‚å½“åœ°å‘é€è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·ç«¯æ§åˆ¶å°†æ¶ˆæ¯å‘å¸ƒåˆ°å“ªä¸ªåˆ†åŒºï¼Œè¿™å¯ä»¥æ˜¯éšæœºå®Œæˆçš„ï¼ˆéšæœºè´Ÿè½½å‡è¡¡ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸäº›è¯­ä¹‰åˆ†åŒºå‡½æ•°å®Œæˆã€‚Kafka æä¾›è¯­ä¹‰åˆ†åŒºçš„æ¥å£ï¼Œå…è®¸ç”¨æˆ·æŒ‡å®šè¦åˆ†åŒºçš„é”®ï¼Œå¹¶ä½¿ç”¨è¯¥é”®å¯¹åˆ†åŒºè¿›è¡Œæ•£åˆ—(å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥è¦†ç›–åˆ†åŒºå‡½æ•°)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¼‚æ­¥å‘é€&#34;&gt;å¼‚æ­¥å‘é€&lt;/h3&gt;
&lt;p&gt;æ‰¹å¤„ç†æ˜¯æ•ˆç‡çš„ä¸»è¦é©±åŠ¨ä¹‹ä¸€ï¼Œä¸ºäº†å®ç°æ‰¹å¤„ç†ï¼ŒProducer åœ¨å†…å­˜ä¸­ç§¯ç´¯æ•°æ®ï¼Œå¹¶åœ¨å•ä¸ªè¯·æ±‚æ‰¹é‡ä¸­å‘é€ã€‚å¯ä»¥å°†æ‰¹å¤„ç†é…ç½®ä¸ºç´¯ç§¯ä¸è¶…è¿‡å›ºå®šæ•°é‡çš„æ¶ˆæ¯ï¼Œç­‰å¾…æ—¶é—´ä¸è¶…è¿‡æŸä¸ªå›ºå®šå»¶è¿ŸèŒƒå›´(æ¯”å¦‚64kæˆ–10æ¯«ç§’)ã€‚è¿™æ ·å°±å¯ä»¥ç´¯ç§¯æ›´å¤šçš„å­—èŠ‚æ¥å‘é€ï¼Œå¹¶å‡å°‘æœåŠ¡å™¨çš„ I/O æ“ä½œã€‚è¿™ä¸ªç¼“å†²åŒºæ˜¯å¯é…ç½®çš„ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç”¨å°‘é‡é¢å¤–çš„å»¶è¿Ÿæ¥æ¢å–æ›´å¥½çš„ååé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;producer-api&#34;&gt;Producer API&lt;/h2&gt;
&lt;p&gt;Producer API å…è®¸åº”ç”¨ç¨‹åºå‘Kafkaé›†ç¾¤ä¸­çš„ä¸»é¢˜å‘é€æ•°æ®æµã€‚éœ€è¦ä»¥ä¸‹ Maven ä¾èµ–ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.kafka&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;kafka-clients&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.7.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Kafka å®¢æˆ·ç«¯ï¼Œå°†è®°å½•å‘å¸ƒåˆ° Kafka é›†ç¾¤ã€‚ Producer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”è·¨çº¿ç¨‹å…±äº«å•ä¸ª Producer å®ä¾‹é€šå¸¸æ¯”æ‹¥æœ‰å¤šä¸ªå®ä¾‹è¦å¿«ã€‚&lt;br&gt;
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå‘é€è¿ç»­æ•°å­—çš„å­—ç¬¦ä¸²ä½œä¸ºé”®/å€¼å¯¹çš„è®°å½•ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void producerSend() {
        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &amp;quot;localhost:9092&amp;quot;);
        props.put(ProducerConfig.ACKS_CONFIG, &amp;quot;all&amp;quot;);
        props.put(ProducerConfig.RETRIES_CONFIG, &amp;quot;0&amp;quot;);
        props.put(ProducerConfig.BATCH_SIZE_CONFIG, &amp;quot;16384&amp;quot;);
        props.put(ProducerConfig.LINGER_MS_CONFIG, &amp;quot;1&amp;quot;);
        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, &amp;quot;33554432&amp;quot;);
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        // Producerçš„ä¸»å¯¹è±¡
        Producer&amp;lt;String, String&amp;gt; producer = new KafkaProducer&amp;lt;&amp;gt;(props);

        for (int i = 0; i &amp;lt; 100; i++) {
            // ProducerRecordï¼šæ¶ˆæ¯å¯¹è±¡
            producer.send(new ProducerRecord&amp;lt;String, String&amp;gt;(&amp;quot;test-topic&amp;quot;, &amp;quot;key-&amp;quot; + i, &amp;quot;value-&amp;quot; + i));
        }
        // æ‰€æœ‰çš„é€šé“æ‰“å¼€éƒ½éœ€è¦å…³é—­
        producer.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Producer ç”±ä¸€ä¸ªç¼“å†²åŒºå’Œä¸€ä¸ªåå° I/O çº¿ç¨‹ç»„æˆï¼Œå‰è€…ä¿å­˜å°šæœªä¼ è¾“åˆ°æœåŠ¡å™¨çš„è®°å½•ï¼Œåè€…è´Ÿè´£å°†è¿™äº›è®°å½•è½¬æ¢ä¸ºè¯·æ±‚å¹¶ä¼ è¾“åˆ°é›†ç¾¤ã€‚å¦‚æœåœ¨ä½¿ç”¨ä¹‹åæ²¡æœ‰å…³é—­ Producerï¼Œè¿™äº›èµ„æºå°±ä¼šæ³„æ¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;send()&lt;/code&gt; æ–¹æ³•æ˜¯å¼‚æ­¥çš„ã€‚è°ƒç”¨æ—¶ï¼Œå®ƒå°†è®°å½•æ·»åŠ åˆ°ç­‰å¾…è®°å½•å‘é€çš„ç¼“å†²åŒºä¸­å¹¶ç«‹å³è¿”å›ã€‚è¿™å…è®¸ Producer æ‰¹é‡å¤„ç†è®°å½•ä»¥æé«˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;acks&lt;/code&gt; é…ç½®æ§åˆ¶è¯·æ±‚å®Œæˆçš„æ¡ä»¶ã€‚è®¾ç½®ä¸º &lt;code&gt;all&lt;/code&gt; æ—¶å°†å¯¼è‡´é˜»å¡åœ¨æäº¤è®°å½•ï¼Œè¿™æ˜¯æœ€æ…¢ä½†æœ€æŒä¹…çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¯·æ±‚å¤±è´¥ï¼ŒProducer å¯ä»¥è‡ªåŠ¨é‡è¯•ï¼Œä½†ç”±äºå°† &lt;code&gt;retries&lt;/code&gt; æŒ‡å®šä¸º0ï¼Œæ‰€ä»¥å®ƒä¸ä¼šé‡è¯•ã€‚å¯ç”¨é‡è¯•è¿˜å¢åŠ äº†é‡å¤çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;Producer ä¸ºæ¯ä¸ªåˆ†åŒºç»´æŠ¤æœªå‘é€è®°å½•çš„ç¼“å†²åŒºã€‚è¿™äº›ç¼“å†²åŒºçš„å¤§å°ç”± &lt;code&gt;batch.size&lt;/code&gt; é…ç½®æŒ‡å®šã€‚å¢å¤§è¿™ä¸ªå€¼å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„æ‰¹å¤„ç†ï¼Œä½†éœ€è¦æ›´å¤šçš„å†…å­˜(å› ä¸ºé€šå¸¸ä¸ºæ¯ä¸ªæ´»åŠ¨åˆ†åŒºè®¾ç½®ä¸€ä¸ªè¿™æ ·çš„ç¼“å†²åŒº)ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿ç¼“å†²åŒºä¸­æœ‰é¢å¤–çš„æœªä½¿ç”¨ç©ºé—´ï¼Œä¹Ÿå¯ä»¥ç«‹å³å‘é€ç¼“å†²åŒºã€‚å¦‚æœæƒ³å‡å°‘è¯·æ±‚çš„æ•°é‡ï¼Œå¯ä»¥è®¾ç½® &lt;code&gt;linger.ms&lt;/code&gt; çš„å€¼å¤§äº0ï¼Œè¡¨ç¤º Producer åœ¨å‘é€è¯·æ±‚ä¹‹å‰ç­‰å¾…çš„æ¯«ç§’æ•°ï¼Œå¸Œæœ›æœ‰æ›´å¤šçš„è®°å½•å¡«å……ç¼“å†²åŒºã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œå› ä¸ºå°† &lt;code&gt;linger.ms&lt;/code&gt; è®¾ç½®ä¸º1æ¯«ç§’ï¼Œæ‰€ä»¥å¯èƒ½æ‰€æœ‰100æ¡è®°å½•éƒ½å°†åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å‘é€ï¼Œã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰å¡«æ»¡ç¼“å†²åŒºï¼Œè¿™ä¸ªè®¾ç½®ä¼šç»™è¯·æ±‚å¢åŠ 1æ¯«ç§’çš„å»¶è¿Ÿã€‚åˆ°è¾¾ç¼“å†²åŒºæ—¶é—´æ¥è¿‘çš„è®°å½•é€šå¸¸ä¼šåœ¨ä¸€ä¸ªæ‰¹å¤„ç†ï¼Œå³ä½¿ &lt;code&gt;linger.ms&lt;/code&gt; çš„å€¼ä¸º0ï¼Œå› æ­¤ï¼Œåœ¨å¤§è´Ÿè½½ä¸‹ï¼Œä¼šå¿½è§† &lt;code&gt;linger.ms&lt;/code&gt; é…ç½®ï¼›å°†æ­¤é…ç½®è®¾ç½®ä¸ºå¤§äº0çš„å€¼å¯ä»¥åœ¨ä¸å¤„äºæœ€å¤§è´Ÿè½½ä¸‹æ—¶å¯¼è‡´æ›´å°‘ã€æ›´æœ‰æ•ˆçš„è¯·æ±‚ï¼Œä»£ä»·æ˜¯å°‘é‡çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;buffer.memory&lt;/code&gt; æ§åˆ¶ Producer å¯ç”¨æ¥ç¼“å†²çš„å†…å­˜æ€»é‡ã€‚å¦‚æœè®°å½•çš„å‘é€é€Ÿåº¦æ¯”å®ƒä»¬ä¼ è¾“åˆ°æœåŠ¡å™¨çš„é€Ÿåº¦å¿«ï¼Œé‚£ä¹ˆè¿™ä¸ªç¼“å†²åŒºç©ºé—´å°†è¢«è€—å°½ã€‚å½“ç¼“å†²åŒºç©ºé—´è€—å°½æ—¶ï¼Œå°†é˜»å¡å…¶ä»–çš„ &lt;code&gt;send&lt;/code&gt; è°ƒç”¨ã€‚é˜»å¡æ—¶é—´çš„é˜ˆå€¼ç”± &lt;code&gt;max.block.ms&lt;/code&gt; å†³å®šï¼Œå¦‚æœè¶…å¸‚ä¼šæŠ›å‡º &lt;code&gt;TimeoutException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;key.serializer&lt;/code&gt; å’Œ &lt;code&gt;value.serializer&lt;/code&gt; è¡¨ç¤ºå¦‚ä½•å°† &lt;code&gt;ProducerRecord&lt;/code&gt; æä¾›çš„é”®å’Œå€¼å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚ã€‚å¯¹äºç®€å•çš„å­—ç¬¦ä¸²æˆ–å­—èŠ‚ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ &lt;code&gt;ByteArraySerializer&lt;/code&gt; æˆ– &lt;code&gt;StringSerializer&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»Kafka 0.11å¼€å§‹ï¼ŒKafkaProducer æ”¯æŒå¦å¤–ä¸¤ç§æ¨¡å¼ï¼šå¹‚ç­‰ Producer å’Œ äº‹åŠ¡ Producerã€‚å¹‚ç­‰ Producer å¢å¼ºäº† Kafka çš„äº¤ä»˜è¯­ä¹‰ï¼Œä»è‡³å°‘ä¸€æ¬¡äº¤ä»˜ï¼ˆat least onceï¼‰åˆ°ç²¾ç¡®ä¸€æ¬¡äº¤ä»˜ï¼ˆexactly onceï¼‰ã€‚ç‰¹åˆ«æ˜¯ Producer é‡è¯•å°†ä¸å†å¼•å…¥é‡å¤ã€‚äº‹åŠ¡ Producer å…è®¸åº”ç”¨ç¨‹åºè‡ªåŠ¨åœ°å°†æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªåˆ†åŒº(å’Œä¸»é¢˜!)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;enable.idempotence&lt;/code&gt; è®¾ç½®ä¸º &lt;code&gt;true&lt;/code&gt; å¼€å¯ç­‰å¹‚ã€‚å¼€å¯åï¼Œ&lt;code&gt;retries &lt;/code&gt; é…ç½®å°†é»˜è®¤ä¸º&lt;code&gt;Integer.MAX_VALUE&lt;/code&gt; ï¼Œ&lt;code&gt;acks&lt;/code&gt; é…ç½®å°†é»˜è®¤ä¸º &lt;code&gt;all&lt;/code&gt;ã€‚å¹‚ç­‰ Producer ä¸éœ€è¦ä¿®æ”¹APIï¼Œå› æ­¤ä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„åº”ç”¨ç¨‹åºæ¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åˆ©ç”¨å¹‚ç­‰ Producerï¼Œå¿…é¡»é¿å…åº”ç”¨ç¨‹åºçº§çš„é‡å‘ï¼Œå› ä¸ºè¿™äº›ä¸èƒ½é‡å¤ã€‚å› æ­¤ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå¯ç”¨å¹‚ç­‰æ€§ï¼Œå»ºè®®ä¸è®¾ç½®é‡è¯•é…ç½®ï¼Œå› ä¸ºå®ƒå°†é»˜è®¤ä¸º &lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;ã€‚æ­¤å¤–ï¼Œå¦‚æœ &lt;code&gt;send(ProducerRecord)&lt;/code&gt; åœ¨æ— é™é‡è¯•çš„æƒ…å†µä¸‹è¿”å›ä¸€ä¸ªé”™è¯¯(ä¾‹å¦‚ï¼Œæ¶ˆæ¯åœ¨å‘é€ä¹‹å‰åœ¨ç¼“å†²åŒºä¸­è¿‡æœŸ)ï¼Œé‚£ä¹ˆå»ºè®®å…³é—­ Producer å¹¶æ£€æŸ¥æœ€åç”Ÿæˆçš„æ¶ˆæ¯çš„å†…å®¹ï¼Œç¡®ä¿å®ƒæ²¡æœ‰é‡å¤ã€‚æœ€åï¼ŒProducer åªèƒ½ä¿è¯åœ¨å•ä¸ªä¼šè¯ä¸­å‘é€çš„æ¶ˆæ¯çš„å¹‚ç­‰æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¦ä½¿ç”¨äº‹åŠ¡ Producerï¼Œå¿…é¡»è®¾ç½® &lt;code&gt;transactional.id&lt;/code&gt;ã€‚è®¾ç½®åï¼Œå¹‚ç­‰æ€§å°±ä¼šè‡ªåŠ¨ä¸å¹‚ç­‰æ€§æ‰€ä¾èµ–çš„ Producer é…ç½®ä¸€èµ·å¯ç”¨ã€‚æ­¤å¤–ï¼Œäº‹åŠ¡ä¸­åŒ…å«çš„ä¸»é¢˜åº”è¯¥é…ç½®æŒä¹…æ€§ã€‚ç‰¹åˆ«æ˜¯ &lt;code&gt;replication.factor&lt;/code&gt; åº”è¯¥è‡³å°‘ä¸º3ï¼Œè¿™äº›ä¸»é¢˜çš„ &lt;code&gt;min.insync.replicas&lt;/code&gt; åº”è¯¥è®¾ç½®ä¸º2ã€‚æœ€åï¼Œä¸ºäº†ä»ç«¯åˆ°ç«¯å®ç°äº‹åŠ¡ä¿è¯ï¼ŒConsumer ä¹Ÿå¿…é¡»è¢«é…ç½®ä¸ºåªè¯»å–å·²æäº¤çš„æ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;transactional.id&lt;/code&gt; çš„ç›®çš„æ˜¯åœ¨å•ä¸ª Producer å®ä¾‹çš„å¤šä¸ªä¼šè¯ä¹‹é—´å¯ç”¨äº‹åŠ¡æ¢å¤ã€‚å®ƒé€šå¸¸æ˜¯ä»åˆ†åŒºçš„ã€æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºä¸­çš„shardæ ‡è¯†ç¬¦æ´¾ç”Ÿçš„ã€‚å› æ­¤ï¼Œå¯¹äºåœ¨åˆ†åŒºåº”ç”¨ç¨‹åºä¸­è¿è¡Œçš„æ¯ä¸ªç”Ÿäº§è€…å®ä¾‹ï¼Œå®ƒåº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æ–°çš„äº‹åŠ¡ api éƒ½æ˜¯é˜»å¡çš„ï¼Œå¹¶åœ¨å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ä¸‹é¢çš„ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨æ–°apiã€‚å®ƒä¸ä¸Šé¢çš„ç¤ºä¾‹ç±»ä¼¼ï¼Œåªæ˜¯æ‰€æœ‰100æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Properties props = new Properties();
 props.put(&amp;quot;bootstrap.servers&amp;quot;, &amp;quot;localhost:9092&amp;quot;);
 props.put(&amp;quot;transactional.id&amp;quot;, &amp;quot;my-transactional-id&amp;quot;);
 Producer&amp;lt;String, String&amp;gt; producer = new KafkaProducer&amp;lt;&amp;gt;(props, new StringSerializer(), new StringSerializer());

 producer.initTransactions();

 try {
     producer.beginTransaction();
     for (int i = 0; i &amp;lt; 100; i++)
         producer.send(new ProducerRecord&amp;lt;&amp;gt;(&amp;quot;my-topic&amp;quot;, Integer.toString(i), Integer.toString(i)));
     producer.commitTransaction();
 } catch (ProducerFencedException | OutOfOrderSequenceException | AuthorizationException e) {
     // We can&#39;t recover from these exceptions, so our only option is to close the producer and exit.
     producer.close();
 } catch (KafkaException e) {
     // For all other exceptions, just abort the transaction and try again.
     producer.abortTransaction();
 }
 producer.close();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ­£å¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œæ¯ä¸ª Producer åªèƒ½æœ‰ä¸€ä¸ªæ‰“å¼€çš„äº‹åŠ¡ã€‚åœ¨ &lt;code&gt;beginTransaction()&lt;/code&gt; å’Œ &lt;code&gt; commitTransaction()&lt;/code&gt; è°ƒç”¨ä¹‹é—´å‘é€çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å°†æ˜¯å•ä¸ªäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚è®¾ç½®äº† &lt;code&gt;transactional.id&lt;/code&gt; æ—¶ï¼ŒProducer å‘é€çš„æ‰€æœ‰æ¶ˆæ¯å¿…é¡»æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡ Producer ä½¿ç”¨å¼‚å¸¸ä¼ è¾¾é”™è¯¯çŠ¶æ€ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¸éœ€è¦ä¸º &lt;code&gt;producer.send()&lt;/code&gt; è®¾ç½®å›è°ƒæˆ– åœ¨è¿”å›çš„ &lt;code&gt;Future&lt;/code&gt; ä¸Šè°ƒç”¨ &lt;code&gt;.get()&lt;/code&gt;ï¼šå¦‚æœä»»ä½• &lt;code&gt;producer.send()&lt;/code&gt; æˆ–äº‹åŠ¡è°ƒç”¨åœ¨äº‹åŠ¡æœŸé—´å‡ºç°ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œå°†å¼•å‘ KafkaExceptionã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨æ”¶åˆ° KafkaException æ—¶è°ƒç”¨ &lt;code&gt;producer.send()&lt;/code&gt;ï¼Œå¯ä»¥ç¡®ä¿ä»»ä½•æˆåŠŸçš„å†™å…¥éƒ½æ ‡è®°ä¸ºå·²ä¸­æ­¢ï¼Œä»è€Œä¿ç•™äº‹åŠ¡æ€§ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å®¢æˆ·ç«¯å¯ä»¥ä¸ç‰ˆæœ¬ 0.10.0 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ä»£ç†è¿›è¡Œé€šä¿¡ã€‚è¾ƒæ—§æˆ–è¾ƒæ–°çš„ä»£ç†å¯èƒ½ä¸æ”¯æŒæŸäº›å®¢æˆ·ç«¯åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œäº‹åŠ¡ API éœ€è¦ä»£ç†ç‰ˆæœ¬ 0.11.0 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚è°ƒç”¨æ­£åœ¨è¿è¡Œçš„ä»£ç†ç‰ˆæœ¬ä¸­ä¸å¯ç”¨çš„ API æ—¶ï¼Œå°†æ”¶åˆ°ä¸å—æ”¯æŒçš„è¿”å›å¼‚å¸¸ã€‚&lt;br&gt;
é™¤äº†ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çš„å¼‚æ­¥å‘é€æ¨¡å¼å¤–ï¼Œè¿˜æœ‰åŒæ­¥å‘é€ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰å’Œå¼‚æ­¥å›è°ƒä¸¤ç§æ¨¡å¼ã€‚&lt;br&gt;
&lt;strong&gt;åŒæ­¥å‘é€ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰&lt;/strong&gt;&lt;br&gt;
åŒæ­¥å‘é€ä¸å¼‚æ­¥å‘é€çš„åŒºåˆ«åœ¨äºå‘é€åçš„æ“ä½œï¼Œç”±äºæ¯æ¬¡å‘é€åéƒ½è°ƒç”¨äº† &lt;code&gt;Future#get&lt;/code&gt;ï¼Œç›¸å½“äºé˜»å¡åœ¨è¯¥å¤„ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
     * åŒæ­¥å‘é€ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰
     * 
     * @throws ExecutionException
     * @throws InterruptedException
*/
public static void producerSyncSend() throws InterruptedException, ExecutionException {
        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &amp;quot;localhost:9092&amp;quot;);
        props.put(ProducerConfig.ACKS_CONFIG, &amp;quot;all&amp;quot;);
        props.put(ProducerConfig.RETRIES_CONFIG, &amp;quot;0&amp;quot;);
        props.put(ProducerConfig.BATCH_SIZE_CONFIG, &amp;quot;16384&amp;quot;);
        props.put(ProducerConfig.LINGER_MS_CONFIG, &amp;quot;1&amp;quot;);
        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, &amp;quot;33554432&amp;quot;);
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
                &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        // Producerçš„ä¸»å¯¹è±¡
        Producer&amp;lt;String, String&amp;gt; producer = new KafkaProducer&amp;lt;&amp;gt;(props);

        for (int i = 0; i &amp;lt; 100; i++) {
            // ProducerRecordï¼šæ¶ˆæ¯å¯¹è±¡
            Future&amp;lt;RecordMetadata&amp;gt; future = producer
                    .send(new ProducerRecord&amp;lt;String, String&amp;gt;(&amp;quot;test-topic&amp;quot;, &amp;quot;key-&amp;quot; + i, &amp;quot;value-&amp;quot; + i));
            RecordMetadata recordMetadata = future.get();
            System.out.println(&amp;quot;partition : &amp;quot; + recordMetadata.partition() + &amp;quot;, offset : &amp;quot; + recordMetadata.offset());
        }
        // æ‰€æœ‰çš„é€šé“æ‰“å¼€éƒ½éœ€è¦å…³é—­
        producer.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥å›è°ƒå‘é€&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt; /**
     * å¼‚æ­¥å‘é€å¸¦å›è°ƒ
     */
    public static void producerSendWithCallback() {
        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &amp;quot;localhost:9092&amp;quot;);
        props.put(ProducerConfig.ACKS_CONFIG, &amp;quot;all&amp;quot;);
        props.put(ProducerConfig.RETRIES_CONFIG, &amp;quot;0&amp;quot;);
        props.put(ProducerConfig.BATCH_SIZE_CONFIG, &amp;quot;16384&amp;quot;);
        props.put(ProducerConfig.LINGER_MS_CONFIG, &amp;quot;1&amp;quot;);
        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, &amp;quot;33554432&amp;quot;);
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
                &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        // Producerçš„ä¸»å¯¹è±¡
        Producer&amp;lt;String, String&amp;gt; producer = new KafkaProducer&amp;lt;&amp;gt;(props);

        for (int i = 0; i &amp;lt; 100; i++) {
            // ProducerRecordï¼šæ¶ˆæ¯å¯¹è±¡
            producer.send(new ProducerRecord&amp;lt;String, String&amp;gt;(&amp;quot;test-topic&amp;quot;, &amp;quot;key-&amp;quot; + i, &amp;quot;value-&amp;quot; + i), new Callback() {
                @Override
                public void onCompletion(RecordMetadata recordMetadata, Exception e) {
                    System.out.println(
                            &amp;quot;partition : &amp;quot; + recordMetadata.partition() + &amp;quot;, offset : &amp;quot; + recordMetadata.offset());
                };
            });
        }
        // æ‰€æœ‰çš„é€šé“æ‰“å¼€éƒ½éœ€è¦å…³é—­
        producer.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ª Partition çš„è®°å½•æ˜¯ä¸ç¡®å®šã€‚è½½å‡è¡¡çš„ç›®çš„æ˜¯å°†æ¶ˆæ¯å°½å¯èƒ½å¹³å‡åˆ†é…ï¼Œå°½å¯èƒ½å°†æ¶ˆæ¯å¹³å‡åˆ†é…ç»™æ‰€æœ‰åˆ†åŒº&lt;br&gt;
&lt;strong&gt;è‡ªå®šä¹‰ Partition è´Ÿè½½å‡è¡¡&lt;/strong&gt;&lt;br&gt;
è‡ªå®šä¹‰ Partitionï¼Œ å®ç° &lt;code&gt;Partitioner&lt;/code&gt; æ¥å£ï¼Œè‡ªå·±å®ç°åˆ†åŒºæ–¹æ³•ã€‚&lt;br&gt;
åœ¨åˆ›å»º &lt;code&gt;test-topic&lt;/code&gt; æ—¶ï¼ŒæŒ‡å®šäº†3ä¸ªåˆ†åŒºï¼Œè¿™é‡Œç®€å•çš„å¯¹ key åšå¤„ç†ä¹‹åï¼Œå–ä½™ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;// è‡ªå®šä¹‰ Partition
public class SamplePartition implements Partitioner {

    @Override
    public void configure(Map&amp;lt;String, ?&amp;gt; arg0) {
        // TODO Auto-generated method stub

    }

    @Override
    public void close() {
        // TODO Auto-generated method stub

    }

    @Override
    public int partition(String topic, Object key, byte[] keyBytes, Object Value, byte[] valueBytes, Cluster cluster) {
        String keyStr = key + &amp;quot;&amp;quot;;
        String keyInt = keyStr.substring(4);
        System.out.println(&amp;quot;======== keyInt ==========&amp;quot; + keyInt);
        int i = Integer.parseInt(keyInt);
        System.out.println(&amp;quot;======== i ==========&amp;quot; + i);

        return i % 3;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;/**
     * ä½¿ç”¨è‡ªå®šä¹‰ Partition
     * å¼‚æ­¥å‘é€å¸¦å›è°ƒå’ŒPartition
*/
public static void producerSendWithCallbackAndPartition() {
        Properties props = new Properties();
        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &amp;quot;localhost:9092&amp;quot;);
        props.put(ProducerConfig.ACKS_CONFIG, &amp;quot;all&amp;quot;);
        props.put(ProducerConfig.RETRIES_CONFIG, &amp;quot;0&amp;quot;);
        props.put(ProducerConfig.BATCH_SIZE_CONFIG, &amp;quot;16384&amp;quot;);
        props.put(ProducerConfig.LINGER_MS_CONFIG, &amp;quot;1&amp;quot;);
        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, &amp;quot;33554432&amp;quot;);
        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,
                &amp;quot;org.apache.kafka.common.serialization.StringSerializer&amp;quot;);
        props.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, &amp;quot;work.flipped.kafka.producer.SamplePartition&amp;quot;);
        // Producerçš„ä¸»å¯¹è±¡
        Producer&amp;lt;String, String&amp;gt; producer = new KafkaProducer&amp;lt;&amp;gt;(props);

        for (int i = 0; i &amp;lt; 100; i++) {
            // ProducerRecordï¼šæ¶ˆæ¯å¯¹è±¡
            producer.send(new ProducerRecord&amp;lt;String, String&amp;gt;(&amp;quot;test-topic&amp;quot;, &amp;quot;key-&amp;quot; + i, &amp;quot;value-&amp;quot; + i), new Callback() {
                @Override
                public void onCompletion(RecordMetadata recordMetadata, Exception e) {
                    System.out.println(
                            &amp;quot;partition : &amp;quot; + recordMetadata.partition() + &amp;quot;, offset : &amp;quot; + recordMetadata.offset());
                };
            });
        }
        // æ‰€æœ‰çš„é€šé“æ‰“å¼€éƒ½éœ€è¦å…³é—­
        producer.close();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‰ä¸ª Partition çš„è®°å½•å‡ ä¹ä¸€æ ·å¤šï¼Œåˆ†åˆ«ä¸º33ï¼Œ33ï¼Œ34ï¼Œè¿è¡Œç»“æœå¦‚å›¾æ‰€ç¤ºã€‚&lt;img src=&#34;https://img.flipped.work/img/20210124212456.png&#34;/&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ¶ˆæ¯ä¼ é€’ä¿éšœ&#34;&gt;æ¶ˆæ¯ä¼ é€’ä¿éšœ&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹ä¸€ç« ä»‹ç» Kafka Consumeråï¼Œä»‹ç»æ­¤å†…å®¹ã€‚&lt;/p&gt;
">Kafkaï¼ˆä¸‰ï¼‰Producer</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/qqGWSVvBP/"" data-c="
          &lt;p&gt;Kafka åŒ…æ‹¬äº”ä¸ªæ ¸å¿ƒ APIï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Admin API å…è®¸ç®¡ç†å’Œæ£€æŸ¥ä¸»é¢˜ã€ä»£ç†å’Œå…¶ä»–Kafkaå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;Producer  API å…è®¸åº”ç”¨ç¨‹åºå‘ Kafka é›†ç¾¤ä¸­çš„ä¸»é¢˜å‘é€æ•°æ®æµã€‚&lt;/li&gt;
&lt;li&gt;Consumer API å…è®¸åº”ç”¨ç¨‹åºä» Kafka é›†ç¾¤ä¸­çš„ä¸»é¢˜ä¸­è¯»å–æ•°æ®æµã€‚&lt;/li&gt;
&lt;li&gt;Streams API å…è®¸å°†æ•°æ®æµä»è¾“å…¥ä¸»é¢˜è½¬æ¢ä¸ºè¾“å‡ºä¸»é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;Connect API å…è®¸å®ç°è¿ç»­åœ°ä»ä¸€äº›æºç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºæ‹‰å…¥Kafka æˆ–ä» Kafka æ¨å…¥ä¸€äº›æ¥æ”¶å™¨ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºçš„è¿æ¥å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kafka åœ¨ä¸€ä¸ªç‹¬ç«‹äºè¯­è¨€çš„åè®®ä¸Šå…¬å¼€äº†å®ƒæ‰€æœ‰çš„åŠŸèƒ½ï¼Œè¯¥åè®®æœ‰è®¸å¤šç¼–ç¨‹è¯­è¨€çš„å®¢æˆ·ç«¯å¯ç”¨ã€‚ç„¶è€Œï¼Œåªæœ‰Java å®¢æˆ·ç«¯ä½œä¸º Kafka ä¸»è¦é¡¹ç›®çš„ä¸€éƒ¨åˆ†è¿›è¡Œç»´æŠ¤ï¼Œå…¶ä»–çš„éƒ½å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„å¼€æºé¡¹ç›®ä½¿ç”¨ã€‚&lt;br&gt;
æœ¬æ–‡åªä»‹ç» Admin APIï¼Œå…¶ä»– API åœ¨åç»­ç« èŠ‚ç»™å‡ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;admin-api&#34;&gt;Admin API&lt;/h2&gt;
&lt;p&gt;Admin APIæ”¯æŒç®¡ç†å’Œæ£€æŸ¥ Topicã€Bokerã€ACL å’Œå…¶ä»– Kafka å¯¹è±¡ã€‚è¦ä½¿ç”¨ Admin APIï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹Mavenä¾èµ–é¡¹:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.apache.kafka&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;kafka-clients&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.7.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ‰å…³ Admin API çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://kafka.apache.org/27/javadoc/index.html?org/apache/kafka/clients/admin/Admin.html&#34;&gt;javadoc&lt;/a&gt;ã€‚&lt;br&gt;
ç›¸å¯¹æ¯”è¾ƒé‡è¦çš„å‡ ä¸ª APIï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;API&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AdminClient&lt;/td&gt;
&lt;td&gt;AdminClient å¯¹è±¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NewTopic&lt;/td&gt;
&lt;td&gt;åˆ›å»º Topic&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CreateTopicsResult&lt;/td&gt;
&lt;td&gt;åˆ›å»º Topic çš„è¿”å›ç»“æœ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ListTopicsResult&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢ Topic åˆ—è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ListTopicsOptions&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢ Topic åˆ—è¡¨åŠé€‰é¡¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DescribeTopicsResult&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢ Topics&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DescribeConfigsResult&lt;/td&gt;
&lt;td&gt;æŸ¥è¯¢ Topics é…ç½®é¡¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;åˆ›å»º-adminclient&#34;&gt;åˆ›å»º AdminClient&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static final String TOPIC_NAME = &amp;quot;test-topic&amp;quot;;

    public static AdminClient getAdminClient() {
        Properties properties = new Properties();
        properties.setProperty(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, &amp;quot;localhost:9092&amp;quot;);
        return AdminClient.create(properties);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆ›å»º-topic&#34;&gt;åˆ›å»º Topic&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void createTopic() {
        AdminClient adminClient = getAdminClient();
        short rs = 1; // å‰¯æœ¬å› å­
        NewTopic newTopic = new NewTopic(TOPIC_NAME, 3, rs);
        CreateTopicsResult topics = adminClient.createTopics(Arrays.asList(newTopic));
        System.out.println(&amp;quot;topics: &amp;quot; + topics);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æŸ¥çœ‹-topic-åˆ—è¡¨&#34;&gt;æŸ¥çœ‹ Topic åˆ—è¡¨&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void topicList() {
        AdminClient adminClient = getAdminClient();
        try {
            ListTopicsResult listTopicsResult = adminClient.listTopics();
            Set&amp;lt;String&amp;gt; names = listTopicsResult.names().get();
            System.out.println(&amp;quot;================&amp;quot;);
            names.forEach(System.out::println);
            System.out.println(&amp;quot;================&amp;quot;);
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;åˆ é™¤-topic&#34;&gt;åˆ é™¤ Topic&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void deleteTopic() {
        AdminClient adminClient = getAdminClient();
        DeleteTopicsResult deleteTopicsResult = adminClient.deleteTopics(Collections.singletonList(TOPIC_NAME));
        try {
            deleteTopicsResult.all().get();
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æè¿°-topic&#34;&gt;æè¿° Topic&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void describeTopic() {
        AdminClient adminClient = getAdminClient();
        DescribeTopicsResult describeTopicsResult = adminClient
                .describeTopics(Arrays.asList(&amp;quot;test-topic&amp;quot;, &amp;quot;second-topic&amp;quot;));
        try {
            Map&amp;lt;String, TopicDescription&amp;gt; stringTopicDescriptionMap = describeTopicsResult.all().get();
            Set&amp;lt;Map.Entry&amp;lt;String, TopicDescription&amp;gt;&amp;gt; entries = stringTopicDescriptionMap.entrySet();
            System.out.println(&amp;quot;===========&amp;quot;);
            entries.forEach(entry -&amp;gt; {
                System.out.println(entry.getKey() + &amp;quot;:&amp;quot; + entry.getValue());
                System.out.println(&amp;quot;===========&amp;quot;);
            });
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;topic-é…ç½®ä¿¡æ¯&#34;&gt;Topic é…ç½®ä¿¡æ¯&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void describeConfig() {
        AdminClient adminClient = getAdminClient();
        ConfigResource configResource = new ConfigResource(ConfigResource.Type.TOPIC, TOPIC_NAME);
        DescribeConfigsResult describeConfigsResult = adminClient
                .describeConfigs(Collections.singletonList(configResource));
        Map&amp;lt;ConfigResource, Config&amp;gt; configResourceConfigMap = null;
        try {
            configResourceConfigMap = describeConfigsResult.all().get();
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        }
        assert configResourceConfigMap != null;
        Set&amp;lt;Map.Entry&amp;lt;ConfigResource, Config&amp;gt;&amp;gt; entries = configResourceConfigMap.entrySet();
        entries.forEach(entry -&amp;gt; System.out.println(entry.getKey() + &amp;quot;:&amp;quot; + entry.getValue()));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;ä¿®æ”¹-topic-é…ç½®&#34;&gt;ä¿®æ”¹ Topic é…ç½®&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void alterConfigResult() {
        AdminClient adminClient = getAdminClient();
        Map&amp;lt;ConfigResource, Config&amp;gt; configMap = new HashMap&amp;lt;&amp;gt;();
        
        // ä¸¤ä¸ªå‚æ•°
        ConfigResource configResource = new ConfigResource(ConfigResource.Type.TOPIC, TOPIC_NAME);
        Config config = new Config(Collections.singletonList(new ConfigEntry(&amp;quot;preallocate&amp;quot;, &amp;quot;true&amp;quot;)));
        configMap.put(configResource, config);
        
        AlterConfigsResult alterConfigsResult = adminClient.alterConfigs(configMap);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;å¢åŠ -partition-æ•°é‡&#34;&gt;å¢åŠ  Partition æ•°é‡&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public static void incrPartitions(int numPartitions) {
        AdminClient adminClient = getAdminClient();
        Map&amp;lt;String, NewPartitions&amp;gt; partitionsMap = new HashMap&amp;lt;&amp;gt;();
        NewPartitions newPartitions = NewPartitions.increaseTo(numPartitions);
        partitionsMap.put(TOPIC_NAME, newPartitions);
        CreatePartitionsResult partitions = adminClient.createPartitions(partitionsMap);
}
&lt;/code&gt;&lt;/pre&gt;
">Kafkaï¼ˆäºŒï¼‰Admin API</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/zawpATTcu/"" data-c="
          &lt;h2 id=&#34;11-å¼•è¨€&#34;&gt;1.1 å¼•è¨€&lt;/h2&gt;
&lt;h3 id=&#34;ä»€ä¹ˆæ˜¯äº‹ä»¶æµ&#34;&gt;ä»€ä¹ˆæ˜¯äº‹ä»¶æµï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä»æŠ€æœ¯ä¸Šè®²ï¼Œäº‹ä»¶æµæ˜¯æŒ‡ä»¥æµçš„å½¢å¼å®æ—¶æ•è·äº‹ä»¶æº(å¦‚æ•°æ®åº“ã€ä¼ æ„Ÿå™¨ã€ç§»åŠ¨è®¾å¤‡ã€äº‘æœåŠ¡å’Œè½¯ä»¶åº”ç”¨ç¨‹åº)ä¸­çš„æ•°æ®ï¼›æŒä¹…åœ°å­˜å‚¨è¿™äº›äº‹ä»¶æµä»¥ä¾›ä»¥åæ£€ç´¢;å®æ—¶å’Œå›é¡¾æ€§åœ°æ“ä½œã€å¤„ç†å’Œå“åº”äº‹ä»¶æµï¼›å¹¶æ ¹æ®éœ€è¦å°†äº‹ä»¶æµè·¯ç”±åˆ°ä¸åŒçš„ç›®æ ‡çš„æŠ€æœ¯ã€‚å› æ­¤ï¼Œäº‹ä»¶æµç¡®ä¿äº†æ•°æ®çš„è¿ç»­æµå’Œè§£é‡Šï¼Œä»¥ä¾¿æ­£ç¡®çš„ä¿¡æ¯åœ¨æ­£ç¡®çš„æ—¶é—´å‡ºç°åœ¨æ­£ç¡®çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨äº‹ä»¶æµå¯ä»¥åšä»€ä¹ˆ&#34;&gt;ä½¿ç”¨äº‹ä»¶æµå¯ä»¥åšä»€ä¹ˆ?&lt;/h3&gt;
&lt;p&gt;äº‹ä»¶æµåº”ç”¨äºè·¨è¶Šä¼—å¤šè¡Œä¸šå’Œç»„ç»‡ï¼ŒåŒ…æ‹¬:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®æ—¶å¤„ç†æ”¯ä»˜å’Œé‡‘èäº¤æ˜“ï¼Œå¦‚åœ¨è¯åˆ¸äº¤æ˜“æ‰€ã€é“¶è¡Œå’Œä¿é™©å…¬å¸ã€‚&lt;/li&gt;
&lt;li&gt;å®æ—¶è·Ÿè¸ªå’Œç›‘æ§æ±½è½¦ã€å¡è½¦ã€è½¦é˜Ÿå’Œå‘è´§ï¼Œå¦‚ç‰©æµå’Œæ±½è½¦è¡Œä¸šã€‚&lt;/li&gt;
&lt;li&gt;æŒç»­ä»ç‰©è”ç½‘è®¾å¤‡æˆ–å…¶ä»–è®¾å¤‡(å¦‚å·¥å‚å’Œé£ç”µåœº)è·å–å’Œåˆ†æä¼ æ„Ÿå™¨æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æ”¶é›†å¹¶ç«‹å³å“åº”å®¢æˆ·çš„äº’åŠ¨å’Œè®¢å•ï¼Œä¾‹å¦‚åœ¨é›¶å”®ï¼Œé…’åº—å’Œæ—…æ¸¸è¡Œä¸šä»¥åŠç§»åŠ¨åº”ç”¨ç¨‹åºä¸­ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æµ‹ä½é™¢ç—…äººçš„æƒ…å†µï¼Œé¢„æµ‹ç—…æƒ…å˜åŒ–ï¼Œç¡®ä¿åœ¨ç´§æ€¥æƒ…å†µä¸‹åŠæ—¶æ²»ç–—ã€‚&lt;/li&gt;
&lt;li&gt;è¿æ¥ã€å­˜å‚¨å’Œæä¾›ç”±å…¬å¸ä¸åŒéƒ¨é—¨äº§ç”Ÿçš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ä½œä¸ºæ•°æ®å¹³å°ã€äº‹ä»¶é©±åŠ¨æ¶æ„å’Œå¾®æœåŠ¡çš„åŸºç¡€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;apache-kafka-æ˜¯äº‹ä»¶æµå¹³å°æ„å‘³ç€ä»€ä¹ˆ&#34;&gt;Apache Kafka æ˜¯äº‹ä»¶æµå¹³å°æ„å‘³ç€ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Kafkaç»“åˆäº†ä¸‰ä¸ªå…³é”®åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªç»è¿‡å®æˆ˜æµ‹è¯•çš„è§£å†³æ–¹æ¡ˆæ¥å®ç°ä½ çš„ç«¯åˆ°ç«¯äº‹ä»¶æµç”¨ä¾‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘å¸ƒï¼ˆå†™å…¥ï¼‰å’Œè®¢é˜…ï¼ˆè¯»å–ï¼‰äº‹ä»¶æµï¼ŒåŒ…æ‹¬ä»å…¶ä»–ç³»ç»Ÿè¿ç»­å¯¼å…¥/å¯¼å‡ºæ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®éœ€è¦æŒä¹…è€Œå¯é åœ°å­˜å‚¨äº‹ä»¶æµã€‚&lt;/li&gt;
&lt;li&gt;å¤„ç†äº‹ä»¶æµçš„å‘ç”Ÿæˆ–è¿½æº¯ã€‚&lt;br&gt;
æ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½ä»¥åˆ†å¸ƒå¼ï¼Œé«˜åº¦å¯æ‰©å±•ï¼Œå¼¹æ€§ï¼Œå®¹é”™å’Œå®‰å…¨çš„æ–¹å¼æä¾›ã€‚å¯ä»¥é€‰æ‹©å°† Kafka éƒ¨ç½²åœ¨è£¸æœºç¡¬ä»¶ï¼Œè™šæ‹Ÿæœºå’Œå®¹å™¨ï¼Œæœ¬åœ°ä»¥åŠäº‘ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;kafka-æ¦‚è¿°&#34;&gt;Kafka æ¦‚è¿°&lt;/h3&gt;
&lt;p&gt;Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”±æœåŠ¡å™¨ï¼ˆServerï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆClientï¼‰ç»„æˆï¼Œé€šè¿‡é«˜æ€§èƒ½çš„TCPç½‘ç»œåè®®è¿›è¡Œé€šä¿¡ã€‚å®ƒå¯ä»¥éƒ¨ç½²åœ¨è£¸æœºã€è™šæ‹Ÿæœºã€å†…éƒ¨ç¯å¢ƒå’Œäº‘ç¯å¢ƒä¸­çš„å®¹å™¨ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœåŠ¡å™¨&lt;/strong&gt;ï¼šKafka æ˜¯ä½œä¸ºä¸€ä¸ªé›†ç¾¤è¿è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–äº‘åŒºåŸŸã€‚è¿™äº›æœåŠ¡å™¨ä¸­çš„ä¸€äº›å½¢æˆäº†å­˜å‚¨å±‚ï¼Œç§°ä¸ºä»£ç†ï¼ˆBrokerï¼‰ã€‚å…¶ä»–æœåŠ¡å™¨è¿è¡Œ Kafka è¿æ¥ ï¼ˆ Kafka Connectï¼‰ä»¥äº‹ä»¶æµçš„å½¢å¼ä¸æ–­å¯¼å…¥å’Œå¯¼å‡ºæ•°æ®ï¼Œå°† Kafka ä¸ç°æœ‰ç³»ç»Ÿé›†æˆï¼Œå¦‚å…³ç³»æ•°æ®åº“å’Œå…¶ä»–Kafkaé›†ç¾¤ã€‚Kafka é›†ç¾¤æ˜¯é«˜åº¦å¯æ‰©å±•å’Œå®¹é”™çš„ï¼Œå¦‚æœå®ƒçš„ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨æ•…éšœï¼Œå…¶ä»–æœåŠ¡å™¨å°†æ¥ç®¡å®ƒçš„å·¥ä½œï¼Œä»¥ç¡®ä¿ä¸ä¸¢å¤±ä»»ä½•æ•°æ®çš„è¿ç»­æ“ä½œã€‚&lt;br&gt;
&lt;strong&gt;å®¢æˆ·ç«¯&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯å®ç°ç¼–å†™åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ï¼Œå³ä½¿åœ¨ç½‘ç»œé—®é¢˜æˆ–æœºå™¨æ•…éšœçš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥å¹¶è¡Œåœ°ã€å¤§è§„æ¨¡åœ°ã€ä»¥å®¹é”™çš„æ–¹å¼è¯»å–ã€å†™å…¥å’Œå¤„ç†äº‹ä»¶æµã€‚Kafka ç¤¾åŒºæä¾›äº†æ•°åä¸ªå®¢æˆ·ç«¯ï¼šJava å’Œ Scala å®¢æˆ·ç«¯ï¼Œæ›´é«˜çº§åˆ«çš„ Kafka Streams åº“ï¼ŒGoã€Pythonã€C/C++ å’Œè®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€ä»¥åŠREST APIã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»è¦æ¦‚å¿µåŠæœ¯è¯­&#34;&gt;ä¸»è¦æ¦‚å¿µåŠæœ¯è¯­&lt;/h3&gt;
&lt;p&gt;äº‹ä»¶è®°å½•äº†åœ¨è¿™ä¸ªä¸–ç•Œæˆ–ä½ çš„ä¸šåŠ¡ä¸­â€œå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…â€çš„äº‹å®ã€‚å®ƒåœ¨æ–‡æ¡£ä¸­ä¹Ÿç§°ä¸ºè®°å½•æˆ–æ¶ˆæ¯ã€‚å½“ä½ å‘Kafkaè¯»å†™æ•°æ®æ—¶ï¼Œä½ æ˜¯ä»¥äº‹ä»¶çš„å½¢å¼æ¥å®Œæˆçš„ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œäº‹ä»¶å…·æœ‰é”®ã€å€¼ã€æ—¶é—´æˆ³å’Œå¯é€‰çš„å…ƒæ•°æ®å¤´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:&lt;/p&gt;
&lt;p&gt;æ´»åŠ¨é‡ç‚¹:â€œçˆ±ä¸½ä¸â€&lt;br&gt;
äº‹ä»¶å€¼:â€œå‘Bobæ”¯ä»˜äº†200ç¾å…ƒâ€&lt;br&gt;
äº‹ä»¶æ—¶é—´æˆ³:â€œ2020å¹´6æœˆ25æ—¥ä¸‹åˆ2:06â€&lt;br&gt;
ç”Ÿäº§è€…æ˜¯é‚£äº›å‘Kafkaå‘å¸ƒ(å†™)äº‹ä»¶çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œæ¶ˆè´¹è€…æ˜¯é‚£äº›è®¢é˜…(è¯»å’Œå¤„ç†)è¿™äº›äº‹ä»¶çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨Kafkaä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œå¹¶ä¸”å½¼æ­¤æ˜¯ä¸å¯çŸ¥çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®çš„è®¾è®¡å…ƒç´ ï¼Œä»¥å®ç°Kafkaä¼—æ‰€å‘¨çŸ¥çš„é«˜å¯ä¼¸ç¼©æ€§ã€‚ä¾‹å¦‚ï¼Œç”Ÿäº§è€…æ°¸è¿œä¸éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…ã€‚Kafkaæä¾›äº†å„ç§å„æ ·çš„ä¿è¯ï¼Œæ¯”å¦‚ç²¾ç¡®åœ°å¤„ç†ä¸€æ¬¡äº‹ä»¶çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;äº‹ä»¶è¢«ç»„ç»‡å¹¶æŒä¹…åœ°å­˜å‚¨åœ¨ä¸»é¢˜ä¸­ã€‚éå¸¸ç®€å•ï¼Œä¸»é¢˜ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹ï¼Œäº‹ä»¶æ˜¯è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚ä¸€ä¸ªç¤ºä¾‹ä¸»é¢˜åç§°å¯ä»¥æ˜¯â€œpaymentsâ€ã€‚Kafkaä¸­çš„ä¸»é¢˜æ€»æ˜¯å¤šç”Ÿäº§è€…å’Œå¤šè®¢é˜…è€…:ä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…å‘å®ƒå†™å…¥äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…è¿™äº›äº‹ä»¶ã€‚ä¸»é¢˜ä¸­çš„äº‹ä»¶å¯ä»¥æ ¹æ®éœ€è¦ç»å¸¸è¯»å–â€”ä¸ä¼ ç»Ÿæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿä¸åŒï¼Œäº‹ä»¶åœ¨ä½¿ç”¨åä¸ä¼šè¢«åˆ é™¤ã€‚ç›¸åï¼Œä½ å¯ä»¥é€šè¿‡æ¯ä¸ªä¸»é¢˜çš„é…ç½®è®¾ç½®æ¥å®šä¹‰Kafkaåº”è¯¥ä¿ç•™ä½ çš„äº‹ä»¶å¤šé•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æ—§çš„äº‹ä»¶å°±ä¼šè¢«ä¸¢å¼ƒã€‚Kafkaçš„æ€§èƒ½ä¸æ•°æ®å¤§å°æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥é•¿æ—¶é—´å­˜å‚¨æ•°æ®æ˜¯éå¸¸å¥½çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»é¢˜æ˜¯åˆ†åŒºçš„ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªä¸»é¢˜è¢«åˆ†æ•£åœ¨ä½äºä¸åŒKafka brokerä¸Šçš„è®¸å¤šâ€œæ¡¶â€ä¸Šã€‚æ•°æ®çš„åˆ†å¸ƒå¼æ”¾ç½®å¯¹äºå¯ä¼¸ç¼©æ€§éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸å®¢æˆ·æœºåº”ç”¨ç¨‹åºåŒæ—¶ä»å¤šä¸ªä»£ç†è¯»å–å’Œå†™å…¥æ•°æ®ã€‚å½“ä¸€ä¸ªæ–°äº‹ä»¶è¢«å‘å¸ƒåˆ°ä¸€ä¸ªä¸»é¢˜æ—¶ï¼Œå®ƒå®é™…ä¸Šè¢«é™„åŠ åˆ°è¯¥ä¸»é¢˜çš„ä¸€ä¸ªåˆ†åŒºä¸­ã€‚å…·æœ‰ç›¸åŒäº‹ä»¶é”®çš„äº‹ä»¶(ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·æˆ–è½¦è¾†ID)è¢«å†™å…¥åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼ŒKafkaä¿è¯ä»»ä½•ç»™å®štopic-partitionçš„æ¶ˆè´¹è€…æ€»æ˜¯ä¼šæŒ‰ç…§å†™å…¥çš„é¡ºåºè¯»å–è¯¥åˆ†åŒºçš„äº‹ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸»è¦æ¦‚å¿µåŠæœ¯è¯­-2&#34;&gt;ä¸»è¦æ¦‚å¿µåŠæœ¯è¯­&lt;/h3&gt;
&lt;p&gt;äº‹ä»¶ï¼ˆEventï¼‰è®°å½•äº†åœ¨è¿™ä¸ªä¸–ç•Œæˆ–ä½ çš„ä¸šåŠ¡ä¸­â€œå‘ç”Ÿäº†ä¸€äº›äº‹æƒ…â€çš„äº‹å®ã€‚å®ƒåœ¨æ–‡æ¡£ä¸­ä¹Ÿç§°ä¸ºè®°å½•æˆ–æ¶ˆæ¯ã€‚å‘ Kafka è¯»å†™æ•°æ®æ—¶ï¼Œæ˜¯ä»¥äº‹ä»¶çš„å½¢å¼å®Œæˆçš„ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œäº‹ä»¶å…·æœ‰é”®ï¼ˆkeyï¼‰ã€å€¼ï¼ˆvalueï¼‰ã€æ—¶é—´æˆ³å’Œå¯é€‰çš„å…ƒæ•°æ®å¤´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;äº‹ä»¶ Key:â€œçˆ±ä¸½ä¸â€&lt;/li&gt;
&lt;li&gt;äº‹ä»¶ Value:â€œå‘Bobæ”¯ä»˜äº†200ç¾å…ƒâ€&lt;/li&gt;
&lt;li&gt;äº‹ä»¶æ—¶é—´æˆ³:â€œ2020å¹´6æœˆ25æ—¥ä¸‹åˆ2:06â€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”Ÿäº§è€…ï¼ˆProducerï¼‰æ˜¯é‚£äº›å‘Kafkaå‘å¸ƒ(å†™)äº‹ä»¶çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰æ˜¯é‚£äº›è®¢é˜…(è¯»å’Œå¤„ç†)è¿™äº›äº‹ä»¶çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚åœ¨Kafkaä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œå¹¶ä¸”å½¼æ­¤æ˜¯ä¸å¯çŸ¥çš„ï¼Œè¿™æ˜¯å®ç° Kafka ä¼—æ‰€å‘¨çŸ¥çš„é«˜å¯ä¼¸ç¼©æ€§çš„ä¸€ä¸ªå…³é”®è®¾è®¡ã€‚ä¾‹å¦‚ï¼Œç”Ÿäº§è€…æ°¸è¿œä¸éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…ã€‚Kafka æä¾›äº†å„ç§å„æ ·çš„ä¿è¯ï¼Œæ¯”å¦‚ç²¾ç¡®åœ°å¤„ç†ä¸€æ¬¡äº‹ä»¶çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;äº‹ä»¶è¢«ç»„ç»‡å¹¶æŒä¹…åœ°å­˜å‚¨åœ¨ä¸»é¢˜ï¼ˆTopicï¼‰ä¸­ã€‚ä¸»é¢˜ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹ï¼Œäº‹ä»¶æ˜¯è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚ç¤ºä¾‹çš„ä¸»é¢˜åç§°å¯ä»¥æ˜¯â€œpaymentsâ€ã€‚Kafkaä¸­çš„ä¸»é¢˜æ€»æ˜¯å¤šç”Ÿäº§è€…å’Œå¤šè®¢é˜…è€…ï¼šä¸€ä¸ªä¸»é¢˜å¯ä»¥æœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…å‘å®ƒå†™å…¥äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…è¿™äº›äº‹ä»¶ã€‚ä¸»é¢˜ä¸­çš„äº‹ä»¶å¯ä»¥æ ¹æ®éœ€è¦ç»å¸¸è¯»å–ï¼Œä¸ä¼ ç»Ÿæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿä¸åŒï¼Œäº‹ä»¶åœ¨ä½¿ç”¨åä¸ä¼šè¢«åˆ é™¤ã€‚ç›¸åï¼Œå¯ä»¥é€šè¿‡æ¯ä¸ªä¸»é¢˜çš„é…ç½®è®¾ç½®å®šä¹‰äº‹ä»¶ä¿ç•™å¤šé•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æ—§çš„äº‹ä»¶å°±ä¼šè¢«ä¸¢å¼ƒã€‚Kafkaçš„æ€§èƒ½ç›¸å¯¹äºæ•°æ®å¤§å°å®é™…ä¸Šæ˜¯æ’å®šçš„ï¼Œå› æ­¤é•¿æ—¶é—´å­˜å‚¨æ•°æ®æ˜¯å®Œå…¨å¯ä»¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»é¢˜æ˜¯åˆ†åŒºçš„ï¼ˆPartitionï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªä¸»é¢˜è¢«åˆ†æ•£åœ¨ä½äºä¸åŒ Kafka ä»£ç†ä¸Šçš„è®¸å¤šâ€œæ¡¶(Bucket)â€ä¸Šã€‚æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨å¯¹äºå¯ä¼¸ç¼©æ€§éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåŒæ—¶ä»å¤šä¸ªä»£ç†è¯»å–å’Œå†™å…¥æ•°æ®ã€‚å½“ä¸€ä¸ªæ–°äº‹ä»¶è¢«å‘å¸ƒåˆ°ä¸€ä¸ªä¸»é¢˜æ—¶ï¼Œå®ƒå®é™…ä¸Šè¢«é™„åŠ åˆ°è¯¥ä¸»é¢˜çš„ä¸€ä¸ªåˆ†åŒºä¸­ã€‚å…·æœ‰ç›¸åŒäº‹ä»¶ key çš„äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·æˆ–è½¦è¾†IDï¼‰å°†è¢«å†™å…¥åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼Œå¹¶ä¸”Kafkaä¿è¯ï¼Œä½•ç»™å®štopic-partitionçš„æ¶ˆè´¹è€…æ€»æ˜¯ä¼šæŒ‰ç…§å†™å…¥çš„é¡ºåºè¯»å–è¯¥åˆ†åŒºçš„äº‹ä»¶ã€‚&lt;br&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210124001127.png&#34;/&gt;&lt;br&gt;
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¤ºä¾‹ä¸»é¢˜æœ‰å››ä¸ªåˆ†åŒºP1-P4ã€‚ä¸¤ä¸ªä¸åŒçš„ç”Ÿäº§è€…å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œå°†äº‹ä»¶å†™å…¥ä¸»é¢˜çš„åˆ†åŒºï¼Œå½¼æ­¤ç‹¬ç«‹åœ°å‘ä¸»é¢˜å‘å¸ƒæ–°äº‹ä»¶ã€‚å…·æœ‰ç›¸åŒé”®çš„äº‹ä»¶ï¼ˆåœ¨å›¾ä¸­ç”¨å®ƒä»¬çš„é¢œè‰²è¡¨ç¤ºï¼‰è¢«å†™å…¥åˆ°ç›¸åŒçš„åˆ†åŒºã€‚æ³¨æ„ï¼Œå¦‚æœåˆé€‚çš„è¯ï¼Œä¸¤ä¸ªç”Ÿäº§è€…éƒ½å¯ä»¥å†™åŒä¸€ä¸ªåˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿æ•°æ®å…·æœ‰å®¹é”™æ€§å’Œé«˜å¯ç”¨æ€§ï¼Œå¯ä»¥åœ¨æ¯ä¸ªåœ°ç†åŒºåŸŸæˆ–æ•°æ®ä¸­å¿ƒä¹‹é—´å¤åˆ¶æ¯ä¸ªä¸»é¢˜ï¼Œä»¥ä¾¿å§‹ç»ˆæœ‰å¤šä¸ªä»£ç†å…·æœ‰æ•°æ®å‰¯æœ¬ï¼Œä»¥é˜²ä¸‡ä¸€å‡ºé”™ã€‚å¸¸è§çš„ç”Ÿäº§è®¾ç½®å¤åˆ¶å› å­ä¸º3ï¼Œå³æ•°æ®å°†å§‹ç»ˆæœ‰ä¸‰ä¸ªå‰¯æœ¬ã€‚ æ­¤å¤åˆ¶åœ¨ä¸»é¢˜åˆ†åŒºçº§åˆ«æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å…¥é—¨æ‰‹å†Œåº”è¯¥è¶³å¤Ÿä»‹ç»ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œæ–‡æ¡£çš„â€œè®¾è®¡â€éƒ¨åˆ†å°†è¯¦ç»†ä»‹ç»Kafkaçš„å„ç§æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;è®©ä½ çš„æ•°æ®å®¹é”™å’Œå¯ç”¨æ€§,æ¯ä¸€ä¸ªä¸»é¢˜å¯ä»¥è¢«å¤åˆ¶,ç”šè‡³è·¨geo-regionsæˆ–æ•°æ®ä¸­å¿ƒ,è¿™æ ·æ€»æœ‰å¤šä¸ªç»çºªäººæœ‰ä¸€ä»½æ•°æ®ä»¥é˜²å‡ºé”™,ä½ æƒ³åšä»£ç†ç»´æŠ¤,ç­‰ç­‰ã€‚ä¸€ä¸ªå¸¸è§çš„ç”Ÿäº§è®¾ç½®æ˜¯3çš„å¤åˆ¶å› å­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨çš„æ•°æ®æ€»æ˜¯æœ‰ä¸‰ä¸ªå‰¯æœ¬ã€‚è¯¥å¤åˆ¶åœ¨ä¸»é¢˜åˆ†åŒºçº§åˆ«ä¸Šæ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;kafka-api&#34;&gt;Kafka API&lt;/h3&gt;
&lt;p&gt;é™¤äº†ç”¨äºç®¡ç†å’Œç®¡ç†ä»»åŠ¡çš„å‘½ä»¤è¡Œå·¥å…·å¤–ï¼ŒKafka è¿˜æœ‰ç”¨äº Javaå’ŒScalaçš„äº”ä¸ªæ ¸å¿ƒAPIï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://kafka.apache.org/documentation.html#adminapi&#34;&gt;Admin API&lt;/a&gt;ï¼Œç”¨äºç®¡ç†å’Œæ£€æŸ¥ä¸»é¢˜ï¼Œä»£ç†å’Œå…¶ä»–Kafkaå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kafka.apache.org/documentation.html#producerapi&#34;&gt;Producer API&lt;/a&gt;ï¼Œç”¨äºå°†äº‹ä»¶æµå‘å¸ƒï¼ˆå†™ï¼‰åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªKafkaä¸»é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kafka.apache.org/documentation.html#consumerapi&#34;&gt;Consumer API&lt;/a&gt;ï¼Œè®¢é˜…ï¼ˆè¯»ï¼‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜å¹¶å¤„ç†ä¸ºå…¶äº§ç”Ÿçš„äº‹ä»¶æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kafka.apache.org/documentation/streams&#34;&gt;Streams API&lt;/a&gt;ï¼Œå®ç°æµå¤„ç†åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ã€‚å®ƒæä¾›äº†å¤„ç†äº‹ä»¶æµçš„é«˜çº§å‡½æ•°ï¼ŒåŒ…æ‹¬è½¬æ¢ã€æœ‰çŠ¶æ€æ“ä½œï¼ˆå¦‚èšåˆå’Œè¿æ¥ã€å¼€çª—ã€åŸºäºäº‹ä»¶æ—¶é—´çš„å¤„ç†ç­‰ç­‰ï¼‰ã€‚ä»ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜è¯»å–è¾“å…¥ï¼Œä»¥ä¾¿ç”Ÿæˆåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜çš„è¾“å‡ºï¼Œä»è€Œæœ‰æ•ˆåœ°å°†è¾“å…¥æµè½¬æ¢ä¸ºè¾“å‡ºæµã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://kafka.apache.org/documentation.html#connect&#34;&gt;Connect API&lt;/a&gt;ï¼Œç”¨äºæ„å»ºå’Œè¿è¡Œå¯é‡ç”¨çš„æ•°æ®å¯¼å…¥/å¯¼å‡ºè¿æ¥å™¨ï¼Œç”¨äºæ¶ˆè´¹ï¼ˆè¯»ï¼‰æˆ–äº§ç”Ÿï¼ˆå†™ï¼‰æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„äº‹ä»¶æµï¼Œä»¥ä¾¿ä¸ Kafka é›†æˆã€‚ä¾‹å¦‚ï¼Œè¿æ¥åˆ°å…³ç³»æ•°æ®åº“ï¼ˆå¦‚PostgreSQLï¼‰çš„è¿æ¥å™¨å¯èƒ½ä¼šæ•è·å¯¹ä¸€ç»„è¡¨çš„æ¯ä¸ªæ›´æ”¹ã€‚é€šå¸¸ä¸éœ€è¦å®ç°è‡ªå·±çš„è¿æ¥å™¨ï¼Œå› ä¸º Kafka ç¤¾åŒºå·²ç»æä¾›äº†æ•°ç™¾ä¸ªç°æˆçš„è¿æ¥å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;12-ç”¨ä¾‹&#34;&gt;1.2 ç”¨ä¾‹&lt;/h2&gt;
&lt;h3 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/h3&gt;
&lt;p&gt;Kafkaå¯ä»¥å¾ˆå¥½åœ°æ›¿ä»£ä¼ æ¶ˆæ¯ä»£ç†ã€‚æ¶ˆæ¯ä»£ç†çš„ä½¿ç”¨æœ‰å¤šç§åŸå› ï¼ˆå°†å¤„ç†ä¸æ•°æ®ç”Ÿäº§è€…åˆ†ç¦»ï¼Œç¼“å†²æœªå¤„ç†çš„æ¶ˆæ¯ç­‰ï¼‰ã€‚ä¸å¤§å¤šæ•°æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼ŒKafka å…·æœ‰æ›´å¥½çš„ååé‡ã€å†…ç½®åˆ†åŒºã€å¤åˆ¶å’Œå®¹é”™ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºå¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†åº”ç”¨ç¨‹åºçš„è‰¯å¥½è§£å†³æ–¹æ¡ˆã€‚&lt;br&gt;
åœ¨è¿™ä¸ªé¢†åŸŸï¼ŒKafka å¯ä»¥ä¸ ActiveMQ æˆ– RabbitMQ ç­‰ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿç›¸åª²ç¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç½‘ç«™æ´»è·ƒè¿½è¸ª&#34;&gt;ç½‘ç«™æ´»è·ƒè¿½è¸ª&lt;/h3&gt;
&lt;p&gt;Kafka æœ€åˆçš„ç”¨ä¾‹æ˜¯èƒ½å¤Ÿé‡å»ºä¸€ä¸ªç”¨æˆ·æ´»è·ƒè·Ÿè¸ªç®¡é“ä½œä¸ºä¸€ç»„å®æ—¶å‘å¸ƒ-è®¢é˜…ç®¡é“ã€‚è¿™æ„å‘³ç€ç«™ç‚¹æ´»è·ƒï¼ˆé¡µé¢æµè§ˆã€æœç´¢æˆ–å…¶ä»–ç”¨æˆ·å¯èƒ½é‡‡å–çš„è¡ŒåŠ¨ï¼‰è¢«å‘å¸ƒåˆ°æ¯ä¸ªæ´»åŠ¨ç±»å‹æœ‰ä¸€ä¸ªä¸»é¢˜çš„ä¸­å¿ƒä¸»é¢˜ã€‚è¿™äº›ç®¡é“å¯ç”¨äºè®¢é˜…ä¸€ç³»åˆ—ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å®æ—¶å¤„ç†ã€å®æ—¶ç›‘æ§ï¼Œå¹¶åŠ è½½åˆ°Hadoopæˆ–ç¦»çº¿æ•°æ®ä»“åº“ç³»ç»Ÿä¸­ä»¥è¿›è¡Œç¦»çº¿å¤„ç†å’ŒæŠ¥å‘Šã€‚&lt;br&gt;
æ´»è·ƒè·Ÿè¸ªçš„å·¥ä½œé‡é€šå¸¸éå¸¸å¤§ï¼Œå› ä¸ºä¼šä¸ºæ¯ä¸ªç”¨æˆ·é¡µé¢è§†å›¾ç”Ÿæˆè®¸å¤šæ´»è·ƒæ¶ˆæ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº¦é‡&#34;&gt;åº¦é‡&lt;/h3&gt;
&lt;p&gt;Kafka ç»å¸¸ç”¨äºè¿è¡Œç›‘æ§æ•°æ®ã€‚è¿™æ¶‰åŠåˆ°ä»åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºèšåˆç»Ÿè®¡ä¿¡æ¯æ¥ç”Ÿæˆé›†ä¸­çš„æ“ä½œæ•°æ®æè¦ã€‚&lt;br&gt;
###æ—¥å¿—èšåˆ&lt;br&gt;
è®¸å¤šäººä½¿ç”¨ Kafka ä½œä¸ºæ—¥å¿—èšåˆè§£å†³æ–¹æ¡ˆçš„æ›¿ä»£å“ã€‚æ—¥å¿—èšåˆé€šå¸¸ä»æœåŠ¡å™¨æ”¶é›†ç‰©ç†æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼ˆå¯èƒ½æ˜¯æ–‡ä»¶æœåŠ¡å™¨æˆ–HDFSï¼‰è¿›è¡Œå¤„ç†ã€‚KafkaæŠ½è±¡äº†æ–‡ä»¶çš„ç»†èŠ‚ï¼Œå¹¶å°†æ—¥å¿—æˆ–äº‹ä»¶æ•°æ®ä½œä¸ºæ¶ˆæ¯æµè¿›è¡Œäº†æ›´æ¸…æ™°çš„æŠ½è±¡ã€‚è¿™å…è®¸æ›´ä½çš„å»¶è¿Ÿå¤„ç†ï¼Œæ›´å®¹æ˜“æ”¯æŒå¤šä¸ªæ•°æ®æºå’Œåˆ†å¸ƒå¼æ•°æ®æ¶ˆè´¹ã€‚ä¸ä»¥æ—¥å¿—ä¸ºä¸­å¿ƒçš„ç³»ç»Ÿï¼ˆå¦‚Scribeæˆ–Flumeï¼‰ç›¸æ¯”ï¼ŒKafkaæä¾›äº†åŒæ ·å¥½çš„æ€§èƒ½ï¼Œç”±äºå¤åˆ¶è€Œæä¾›äº†æ›´å¼ºçš„æŒä¹…æ€§ä¿è¯ï¼Œè€Œä¸”ç«¯åˆ°ç«¯å»¶è¿Ÿè¦ä½å¾—å¤šã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµå¤„ç†&#34;&gt;æµå¤„ç†&lt;/h3&gt;
&lt;p&gt;è®¸å¤š Kafka ç”¨æˆ·åœ¨å¤„ç†ç®¡é“ä¸­å¤„ç†æ•°æ®ï¼Œè¯¥ç®¡é“ç”±å¤šä¸ªé˜¶æ®µç»„æˆï¼ŒåŸå§‹è¾“å…¥æ•°æ®ä» Kafka ä¸»é¢˜æ¶ˆè´¹ï¼Œç„¶åèšåˆï¼Œä¸°å¯Œï¼Œæˆ–è½¬æ¢æˆæ–°çš„ä¸»é¢˜ï¼Œä»¥è¿›ä¸€æ­¥æ¶ˆè´¹æˆ–åç»­å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæ¨èæ–°é—»æ–‡ç« çš„å¤„ç†ç®¡é“å¯èƒ½ä¼šä» RSS è®¢é˜…ä¸­æŠ“å–æ–‡ç« å†…å®¹ï¼Œå¹¶å°†å…¶å‘å¸ƒåˆ°â€œarticlesâ€ä¸»é¢˜ï¼›è¿›ä¸€æ­¥çš„å¤„ç†å¯èƒ½ä¼šå¯¹è¿™äº›å†…å®¹è¿›è¡Œè§„èŒƒåŒ–æˆ–é‡å¤æ•°æ®åˆ é™¤ï¼Œå¹¶å°†æ¸…æ´—åçš„æ–‡ç« å†…å®¹å‘å¸ƒåˆ°æ–°ä¸»é¢˜ä¸­ï¼›æœ€åä¸€ä¸ªå¤„ç†é˜¶æ®µå¯èƒ½ä¼šå°è¯•å‘ç”¨æˆ·æ¨èè¿™äº›å†…å®¹ã€‚è¿™ç§å¤„ç†ç®¡é“æ ¹æ®å„ä¸ªä¸»é¢˜åˆ›å»ºå®æ—¶æ•°æ®æµå›¾ã€‚ä»0.10.0.0å¼€å§‹ï¼Œä¸€ä¸ªè½»é‡çº§ä½†å¼ºå¤§çš„æµå¤„ç†åº“ Kafka Streams åœ¨ Apache Kafka ä¸­å¯ç”¨æ¥æ‰§è¡Œå¦‚ä¸Šæ‰€è¿°çš„æ•°æ®å¤„ç†ã€‚é™¤äº† Kafkaï¼Œå…¶ä»–å¼€æºæµå¤„ç†å·¥å…·åŒ…æ‹¬ Apache Storm å’Œ Apache Samzaã€‚&lt;/p&gt;
&lt;h2 id=&#34;13-å¿«é€Ÿå¼€å§‹&#34;&gt;1.3 å¿«é€Ÿå¼€å§‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;è·å– Kafka&lt;br&gt;
&lt;a href=&#34;https://www.apache.org/dyn/closer.cgi?path=/kafka/2.7.0/kafka_2.13-2.7.0.tgz&#34;&gt;ä¸‹è½½&lt;/a&gt;æœ€æ–°çš„Kafkaç‰ˆæœ¬å¹¶è§£å‹ç¼©ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;$ tar -xzf kafka_2.13-2.7.0.tgz
$ cd kafka_2.13-2.7.0
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¯åŠ¨ KAFKA ç¯å¢ƒ&lt;br&gt;
&lt;strong&gt;æ³¨æ„ï¼šæœ¬åœ°ç¯å¢ƒå¿…é¡»å®‰è£…äº†Java 8+&lt;/strong&gt;ã€‚é¡ºåºè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;# Så¯åŠ¨ ZooKeeper æœåŠ¡
# æ³¨æ„ï¼šå¾ˆå¿« Apache Kafka å°±å°†ä¸å†éœ€è¦ Zookeeper.
$ bin/zookeeper-server-start.sh config/zookeeper.properties
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;# å¯åŠ¨ Kafka æœåŠ¡
$ bin/kafka-server-start.sh config/server.properties
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ï¼Œä¸€ä¸ªåŸºæœ¬çš„ Kafka ç¯å¢ƒè¿è¡ŒæˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨äº†ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;åˆ›å»ºä¸»é¢˜å­˜å‚¨äº‹ä»¶&lt;br&gt;
Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ï¼Œå…è®¸åœ¨å¤šå°æœºå™¨ä¸Šè¯»å–ã€å†™å…¥ã€å­˜å‚¨å’Œå¤„ç†äº‹ä»¶ï¼ˆåœ¨æ–‡æ¡£ä¸­ä¹Ÿç§°ä¸ºè®°å½•æˆ–æ¶ˆæ¯ï¼‰ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼Œæ”¯ä»˜äº¤æ˜“ã€æ¥è‡ªç§»åŠ¨ç”µè¯çš„åœ°ç†ä½ç½®æ›´æ–°ã€å‘è´§è®¢å•ã€æ¥è‡ªç‰©è”ç½‘è®¾å¤‡æˆ–åŒ»ç–—è®¾å¤‡çš„ä¼ æ„Ÿå™¨æµ‹é‡ç­‰ç­‰ã€‚è¿™äº›äº‹ä»¶è¢«ç»„ç»‡å¹¶å­˜å‚¨åœ¨ä¸»é¢˜ä¸­ã€‚ä¸»é¢˜ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹ï¼Œäº‹ä»¶æ˜¯è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚&lt;br&gt;
å› æ­¤ï¼Œç¼–å†™äº‹ä»¶ä¹‹å‰ï¼Œå¿…é¡»åˆ›å»ºä¸»é¢˜ã€‚æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯å¹¶è¿è¡Œ:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;$ bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰€æœ‰ Kafka å‘½ä»¤è¡Œå·¥å…·éƒ½æœ‰é¢å¤–çš„é€‰é¡¹ï¼šè¿è¡Œä¸å¸¦ä»»ä½•å‚æ•°çš„ Kafka-topics.sh å‘½ä»¤æ¥æ˜¾ç¤ºä½¿ç”¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºæ–°ä¸»é¢˜çš„åˆ†åŒºæ•°ç­‰ç»†èŠ‚:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ bin/kafka-topics.sh --describe --topic quickstart-events --bootstrap-server localhost:9092
&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210124093047.png&#34;/&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;å‘ä¸»é¢˜å†™å…¥äº‹ä»¶&lt;br&gt;
Kafka å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œä¸ Kafka ä»£ç†é€šä¿¡ï¼Œè¿›è¡Œå†™(æˆ–è¯»)äº‹ä»¶ã€‚ä¸€æ—¦æ”¶åˆ°ï¼Œä»£ç†å°†ä»¥æŒä¹…å’Œå®¹é”™çš„æ–¹å¼å­˜å‚¨äº‹ä»¶ã€‚&lt;br&gt;
è¿è¡Œæ§åˆ¶å°ç”Ÿäº§è€…å®¢æˆ·ç«¯ï¼Œåœ¨ä¸»é¢˜ä¸­å†™å…¥äº‹ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å…¥çš„æ¯ä¸€è¡Œå°†å¯¼è‡´ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶è¢«å†™å…¥ä¸»é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;$ bin/kafka-console-producer.sh --topic quickstart-events --broker-list localhost:9092
This is my first event
This is my second event
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥éšæ—¶ä½¿ç”¨ Ctrl-C åœæ­¢ç”Ÿäº§è€…å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;è¯»äº‹ä»¶&lt;br&gt;
æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯å¹¶è¿è¡Œæ§åˆ¶å°æ¶ˆè´¹è€…å®¢æˆ·ç«¯è¯»å–åˆšåˆšåˆ›å»ºçš„äº‹ä»¶:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;$ bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092
This is my first event
This is my second event
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŒæ ·ï¼Œå¯ä»¥éšæ—¶ä½¿ç”¨ Ctrl-C åœæ­¢æ¶ˆè´¹è€…å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ KAFKA CONNECT å¯¼å…¥/å¯¼å‡ºæ•°æ®ä½œä¸ºäº‹ä»¶æµ&lt;br&gt;
å¯èƒ½åœ¨å…³ç³»æ•°æ®åº“æˆ–ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿç­‰ç°æœ‰ç³»ç»Ÿä¸­æ‹¥æœ‰å¤§é‡æ•°æ®ï¼Œä»¥åŠè®¸å¤šå·²ç»ä½¿ç”¨è¿™äº›ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚Kafka Connect å…è®¸ä¸æ–­åœ°ä»å¤–éƒ¨ç³»ç»Ÿæ‘„å–æ•°æ®åˆ° Kafkaï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤ï¼Œå°†ç°æœ‰çš„ç³»ç»Ÿä¸Kafkaé›†æˆæ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä¸ºäº†ä½¿è¿™ä¸ªè¿‡ç¨‹æ›´å®¹æ˜“ï¼ŒKafka ç¤¾åŒºæä¾›äº†å¾ˆå¤šè¿æ¥å™¨ã€‚&lt;br&gt;
æŸ¥çœ‹ &lt;a href=&#34;https://kafka.apache.org/documentation/#connect&#34;&gt;Kafka Connect éƒ¨åˆ†&lt;/a&gt;ï¼Œäº†è§£æ›´å¤šå…³äºå¦‚ä½•å¯¼å…¥/å¯¼å‡ºæ•°æ®åˆ°/å‡º Kafkaã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨ KAFKA æµå¤„ç†äº‹ä»¶&lt;br&gt;
ä¸€æ—¦æ•°æ®ä½œä¸ºäº‹ä»¶å­˜å‚¨åœ¨ Kafka ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨ Kafka Streams å®¢æˆ·ç«¯åº“å¤„ç†æ•°æ®ã€‚å®ƒå…è®¸å®ç°å…³é”®ä»»åŠ¡å®æ—¶åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ï¼Œå…¶ä¸­è¾“å…¥å’Œ/æˆ–è¾“å‡ºæ•°æ®å­˜å‚¨åœ¨Kafkaä¸»é¢˜ä¸­ã€‚Kafka Streams ç»“åˆäº†åœ¨å®¢æˆ·ç«¯ç¼–å†™å’Œéƒ¨ç½²æ ‡å‡† Java å’Œ Scala åº”ç”¨ç¨‹åºçš„ç®€ä¾¿æ€§ä»¥åŠ Kafka æœåŠ¡å™¨ç«¯é›†ç¾¤æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œä½¿è¿™äº›åº”ç”¨ç¨‹åºå…·æœ‰é«˜åº¦å¯ä¼¸ç¼©æ€§ï¼Œå¼¹æ€§ï¼Œå®¹é”™æ€§å’Œåˆ†å¸ƒå¼æ€§ã€‚ è¯¥åº“æ”¯æŒä¸€æ¬¡ç²¾ç¡®å¤„ç†ï¼Œæœ‰çŠ¶æ€æ“ä½œå’Œèšåˆï¼Œå¼€çª—ï¼Œè”æ¥ï¼ŒåŸºäºäº‹ä»¶æ—¶é—´çš„å¤„ç†ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¦‚ä½•å®ç°æµè¡Œçš„WordCountç®—æ³•:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;KStream&amp;lt;String, String&amp;gt; textLines = builder.stream(&amp;quot;quickstart-events&amp;quot;);

KTable&amp;lt;String, Long&amp;gt; wordCounts = textLines
            .flatMapValues(line -&amp;gt; Arrays.asList(line.toLowerCase().split(&amp;quot; &amp;quot;)))
            .groupBy((keyIgnored, word) -&amp;gt; word)
            .count();

wordCounts.toStream().to(&amp;quot;output-topic&amp;quot;), Produced.with(Serdes.String(), Serdes.Long()));
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a href=&#34;https://kafka.apache.org/25/documentation/streams/quickstart&#34;&gt;Kafka Stream Demo&lt;/a&gt; å’Œ&lt;a href=&#34;https://kafka.apache.org/25/documentation/streams/tutorial&#34;&gt;åº”ç”¨ç¨‹åºå¼€å‘æ•™ç¨‹&lt;/a&gt;æ¼”ç¤ºäº†å¦‚ä½•ç¼–å†™å’Œè¿è¡Œè¿™æ ·çš„æµåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;ç»ˆæ­¢ KAFKA&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Ctrl-C åœæ­¢ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯ï¼ˆå¦‚æœè¿˜æ²¡æœ‰è¿™æ ·åšçš„è¯ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ Ctrl-C åœæ­¢ Kafka ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼ŒæŒ‰ Ctrl-C åœæ­¢ ZooKeeper æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¿˜æƒ³åˆ é™¤æœ¬åœ° Kafka ç¯å¢ƒçš„ä»»ä½•æ•°æ®ï¼ŒåŒ…æ‹¬å·²åˆ›å»ºäº‹ä»¶ï¼Œåªéœ€è¿è¡Œå‘½ä»¤:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;$ rm -rf /tmp/kafka-logs /tmp/zookeeper
&lt;/code&gt;&lt;/pre&gt;
">Kafkaï¼ˆä¸€ï¼‰ å…¥é—¨</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/MW6ZY5hk/"" data-c="
          &lt;p&gt;ä¸ WSL ä¸åŒï¼ŒWSL2 æ˜¯ä¸€ä¸ªå®Œæ•´çš„Linuxå†…æ ¸ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨win10ï¼ˆç‰ˆæœ¬å·&lt;strong&gt;19042.746ï¼Œä¸“ä¸šç‰ˆ&lt;/strong&gt;ï¼‰ä¸­å¯ç”¨ WSL2ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…wsl2&#34;&gt;å®‰è£…WSL2&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/windows/wsl/install-win10&#34;&gt;ç‚¹å‡»&lt;/a&gt;æŸ¥çœ‹å¾®è½¯çš„å®˜æ–¹è¯´æ˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤1-å¯ç”¨linuxå­ç³»ç»Ÿ&#34;&gt;æ­¥éª¤1 å¯ç”¨Linuxå­ç³»ç»Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨Windowsä¸Šå®‰è£…ä»»ä½•Linuxå‘è¡Œç‰ˆä¹‹å‰ï¼Œå¿…é¡»å¯ç”¨ Linux å­ç³»ç»ŸåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShellå¹¶è¿è¡Œï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ­¥éª¤2-å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½&#34;&gt;æ­¥éª¤2 å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½&lt;/h3&gt;
&lt;p&gt;å®‰è£…WSL 2ä¹‹å‰ï¼Œå¿…é¡»å¯ç”¨è™šæ‹Ÿæœºå¹³å°å¯é€‰åŠŸèƒ½ã€‚ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShellå¹¶è¿è¡Œï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é‡å¯ç”µè„‘ï¼Œå®ŒæˆWSLå®‰è£…å¹¶æ›´æ–°åˆ°WSL 2ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤3-ä¸‹è½½linuxå†…æ ¸æ›´æ–°ç¨‹åºåŒ…&#34;&gt;æ­¥éª¤3 ä¸‹è½½Linuxå†…æ ¸æ›´æ–°ç¨‹åºåŒ…&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi&#34;&gt;ç‚¹å‡»ä¸‹è½½&lt;/a&gt;ï¼ŒåŒå‡»å®‰è£…ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤4-å°†wsl-2è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬&#34;&gt;æ­¥éª¤4 å°†WSL 2è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬&lt;/h3&gt;
&lt;p&gt;åœ¨ PowerShell ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒWSL 2è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;wsl --set-default-version 2
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;æ­¥éª¤5-å®‰è£…å‘è¡Œç‰ˆ&#34;&gt;æ­¥éª¤5 å®‰è£…å‘è¡Œç‰ˆ&lt;/h3&gt;
&lt;p&gt;æ‰“å¼€&lt;a href=&#34;https://aka.ms/wslstore&#34;&gt;Microsoftå•†åº—&lt;/a&gt;ï¼Œç„¶åé€‰æ‹©å–œæ¬¢çš„Linuxå‘è¡Œç‰ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ­¥éª¤6-éªŒè¯&#34;&gt;æ­¥éª¤6 éªŒè¯&lt;/h3&gt;
&lt;p&gt;åœ¨ PowerShell ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;wsl -l -v
&lt;/code&gt;&lt;/pre&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210120214258.png&#34;/&gt;
">å®‰è£… WSL2 (win10ä¸“ä¸šç‰ˆï¼Œ19042)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/Kyv9tMmW/"" data-c="
          &lt;p&gt;nvm æ˜¯ä¸€ä¸ªç®¡ç† node ç‰ˆæœ¬çš„å·¥å…·ï¼Œå¯ä»¥å®‰è£…åˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„ node æé«˜å¼€å‘æ•ˆç‡ã€‚ä½†æ˜¯ nvm é»˜è®¤çš„ä¸‹è½½åœ°å€ http://nodejs.org/dist/ æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå›½å†…å¾ˆæ…¢ï¼Œå¯èƒ½ä¼šä¸‹è½½å¤±è´¥ã€‚&lt;br&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210105094833.png&#34;/&gt;&lt;br&gt;
å¯ä»¥ä½¿ç”¨æ·˜å®çš„é•œåƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;where nvm&lt;/code&gt; æ‰¾åˆ°nvmå®‰è£…è·¯å¾„&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210105095516.png&#34;/&gt;
&lt;ul&gt;
&lt;li&gt;æ‰¾åˆ°åœ¨è¯¥ç›®å½•ä¸‹çš„ settings.txt æ–‡ä»¶ï¼Œå°†ä¸‹é¢è¿™ä¸¤å¥è¯å¤åˆ¶åˆ° settings.txt å¹¶ä¿å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;node_mirror: https://npm.taobao.org/mirrors/node/
npm_mirror: https://npm.taobao.org/mirrors/npm/
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;æµ‹è¯•ç»“æœ&lt;br&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210105095916.png&#34;/&gt;&lt;/li&gt;
&lt;/ul&gt;
">è§£å†³nvmä¸‹è½½nodeæ…¢çš„é—®é¢˜</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/9m2MXIyWR/"" data-c="
          &lt;ul&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆ wait/notify/notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ&lt;/li&gt;
&lt;li&gt;wait/notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆ-wait-å¿…é¡»åœ¨-synchronized-ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨&#34;&gt;ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;wait æ–¹æ³•çš„æºç æ³¨é‡Šï¼šwait method should always be used in a loopã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;Â synchronizedÂ (obj)Â {
Â Â Â Â Â whileÂ (conditionÂ doesÂ notÂ hold)
Â Â Â Â Â Â Â Â Â obj.wait();
Â Â Â Â Â     ...Â //Â PerformÂ actionÂ appropriateÂ toÂ condition

}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This method should only be called by a thread that is the owner of this object&#39;s monitor.â€æ„æ€æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨ wait æ–¹æ³•æ—¶ï¼Œå¿…é¡»æŠŠ wait æ–¹æ³•å†™åœ¨ synchronized ä¿æŠ¤çš„ while ä»£ç å—ä¸­ï¼Œå¹¶å§‹ç»ˆåˆ¤æ–­æ‰§è¡Œæ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ»¡è¶³å°±å¾€ä¸‹ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœä¸æ»¡è¶³å°±æ‰§è¡Œ wait æ–¹æ³•ï¼Œè€Œåœ¨æ‰§è¡Œ wait æ–¹æ³•ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŒæœ‰å¯¹è±¡çš„ monitor é”ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ synchronized é”ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸è¦æ±‚ wait æ–¹æ³•æ”¾åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Œè€Œæ˜¯å¯ä»¥éšæ„è°ƒç”¨ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å†™å‡ºè¿™æ ·çš„ä»£ç ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;class BlockingQueue {
    Queue&amp;lt;String&amp;gt; buffer = new LinkedList&amp;lt;String&amp;gt;();
    public void give(String data) {
        buffer.add(data);
        notify();  // Since someone may be waiting in take
    }
    public String take() throws InterruptedException {
        while (buffer.isEmpty()) {
            wait();
        }
        return buffer.remove();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;give æ–¹æ³•è´Ÿè´£å¾€ buffer ä¸­æ·»åŠ æ•°æ®ï¼Œæ·»åŠ å®Œä¹‹åæ‰§è¡Œ notify æ–¹æ³•æ¥å”¤é†’ä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œtake æ–¹æ³•æ£€æŸ¥ buffer æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±è¿›å…¥ç­‰å¾…ï¼Œå¦‚æœä¸ä¸ºç©ºå°±å–å‡ºä¸€ä¸ªæ•°æ®ï¼Œè¿™æ˜¯å…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…çš„æ€æƒ³ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™æ®µä»£ç å¹¶æ²¡æœ‰å— synchronized ä¿æŠ¤ï¼Œäºæ˜¯ä¾¿æœ‰å¯èƒ½å‘ç”Ÿä»¥ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;é¦–å…ˆï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ take æ–¹æ³•å¹¶åˆ¤æ–­ buffer.isEmpty æ–¹æ³•æ˜¯å¦è¿”å› trueï¼Œè‹¥ä¸º true ä»£è¡¨bufferæ˜¯ç©ºçš„ï¼Œåˆ™çº¿ç¨‹å¸Œæœ›è¿›å…¥ç­‰å¾…ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹è°ƒç”¨ wait æ–¹æ³•ä¹‹å‰ï¼Œå°±è¢«è°ƒåº¦å™¨æš‚åœäº†ï¼Œæ‰€ä»¥æ­¤æ—¶è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œ wait æ–¹æ³•ã€‚&lt;br&gt;
æ­¤æ—¶ç”Ÿäº§è€…å¼€å§‹è¿è¡Œï¼Œæ‰§è¡Œäº†æ•´ä¸ª give æ–¹æ³•ï¼Œå®ƒå¾€ buffer ä¸­æ·»åŠ äº†æ•°æ®ï¼Œå¹¶æ‰§è¡Œäº† notify æ–¹æ³•ï¼Œä½† notify å¹¶æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºæ¶ˆè´¹è€…çº¿ç¨‹çš„ wait æ–¹æ³•æ²¡æ¥å¾—åŠæ‰§è¡Œï¼Œæ‰€ä»¥æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è¢«å”¤é†’ã€‚&lt;br&gt;
æ­¤æ—¶ï¼Œåˆšæ‰è¢«è°ƒåº¦å™¨æš‚åœçš„æ¶ˆè´¹è€…çº¿ç¨‹å›æ¥ç»§ç»­æ‰§è¡Œ wait æ–¹æ³•å¹¶è¿›å…¥äº†ç­‰å¾…ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶æ¶ˆè´¹è€…åˆ¤æ–­äº† buffer.isEmpty æ¡ä»¶ï¼Œä½†çœŸæ­£æ‰§è¡Œ wait æ–¹æ³•æ—¶ï¼Œä¹‹å‰çš„ buffer.isEmpty çš„ç»“æœå·²ç»è¿‡æœŸäº†ï¼Œä¸å†ç¬¦åˆæœ€æ–°çš„åœºæ™¯äº†ï¼Œå› ä¸ºè¿™é‡Œçš„â€œåˆ¤æ–­-æ‰§è¡Œâ€ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒåœ¨ä¸­é—´è¢«æ‰“æ–­äº†ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾è¿™æ—¶æ²¡æœ‰æ›´å¤šçš„ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§ï¼Œæ¶ˆè´¹è€…ä¾¿æœ‰å¯èƒ½é™·å…¥æ— ç©·æ— å°½çš„ç­‰å¾…ï¼Œå› ä¸ºå®ƒé”™è¿‡äº†åˆšæ‰ give æ–¹æ³•å†…çš„ notify çš„å”¤é†’ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸º wait æ–¹æ³•æ‰€åœ¨çš„ take æ–¹æ³•æ²¡æœ‰è¢« synchronized ä¿æŠ¤ï¼Œæ‰€ä»¥å®ƒçš„ while åˆ¤æ–­å’Œ wait æ–¹æ³•æ— æ³•æ„æˆåŸå­æ“ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶æ•´ä¸ªç¨‹åºå°±å¾ˆå®¹æ˜“å‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠä»£ç æ”¹å†™æˆæºç æ³¨é‡Šæ‰€è¦æ±‚çš„è¢« synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç å—çš„å½¢å¼ï¼Œä»£ç å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ voidÂ give(StringÂ data)Â {
Â Â Â synchronizedÂ (this)Â {
Â Â Â Â Â Â buffer.add(data);
Â Â Â Â Â Â notify();
Â Â }
}

publicÂ StringÂ take()Â throwsÂ InterruptedExceptionÂ {
Â Â Â synchronizedÂ (this)Â {
Â Â Â Â whileÂ (buffer.isEmpty())Â {
Â Â Â Â Â Â Â Â Â wait();
Â Â Â Â Â Â Â }
Â Â Â Â Â returnÂ buffer.remove();
Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·å°±å¯ä»¥ç¡®ä¿ notify æ–¹æ³•æ°¸è¿œä¸ä¼šåœ¨ buffer.isEmpty å’Œ wait æ–¹æ³•ä¹‹é—´è¢«è°ƒç”¨ï¼Œæå‡äº†ç¨‹åºçš„å®‰å…¨æ€§ã€‚&lt;br&gt;
å¦å¤–ï¼Œwait æ–¹æ³•ä¼šé‡Šæ”¾ monitor é”ï¼Œè¿™ä¹Ÿè¦æ±‚å¿…é¡»é¦–å…ˆè¿›å…¥åˆ° synchronized å†…æŒæœ‰è¿™æŠŠé”ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªâ€œè™šå‡å”¤é†’â€çš„é—®é¢˜ï¼Œçº¿ç¨‹å¯èƒ½åœ¨æ—¢æ²¡æœ‰è¢«notify/notifyAllï¼Œä¹Ÿæ²¡æœ‰è¢«ä¸­æ–­æˆ–è€…è¶…æ—¶çš„æƒ…å†µä¸‹è¢«å”¤é†’ï¼Œè™šå‡å”¤é†’å‘ç”Ÿçš„æ¦‚ç‡å¾ˆå°ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦ä¿è¯åœ¨å‘ç”Ÿè™šå‡å”¤é†’çš„æ—¶å€™çš„æ­£ç¡®æ€§ï¼Œæ‰€ä»¥å°±éœ€è¦é‡‡ç”¨whileå¾ªç¯çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;whileÂ (conditionÂ doesÂ notÂ hold)
Â Â Â Â obj.wait();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·å³ä¾¿è¢«è™šå‡å”¤é†’äº†ï¼Œä¹Ÿä¼šå†æ¬¡æ£€æŸ¥whileé‡Œé¢çš„æ¡ä»¶ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œå°±ä¼šç»§ç»­waitï¼Œä¹Ÿå°±æ¶ˆé™¤äº†è™šå‡å”¤é†’çš„é£é™©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆ-waitnotifynotifyall-è¢«å®šä¹‰åœ¨-object-ç±»ä¸­è€Œ-sleep-å®šä¹‰åœ¨-thread-ç±»ä¸­&#34;&gt;ä¸ºä»€ä¹ˆ wait/notify/notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å› ä¸º Java ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ç§°ä¸º monitor ç›‘è§†å™¨çš„é”ï¼Œç”±äºæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä¸Šé”ï¼Œè¿™å°±è¦æ±‚åœ¨å¯¹è±¡å¤´ä¸­æœ‰ä¸€ä¸ªç”¨æ¥ä¿å­˜é”ä¿¡æ¯çš„ä½ç½®ã€‚è¿™ä¸ªé”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œè€Œéçº¿ç¨‹çº§åˆ«çš„ï¼Œwait/notify/notifyAll ä¹Ÿéƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œå®ƒä»¬çš„é”å±äºå¯¹è±¡ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬å®šä¹‰åœ¨ Object ç±»ä¸­æ˜¯æœ€åˆé€‚ï¼Œå› ä¸º Object ç±»æ˜¯æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæŠŠ wait/notify/notifyAll æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œä¼šå¸¦æ¥å±€é™æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æŒæœ‰å¤šæŠŠé”ï¼Œä»¥ä¾¿å®ç°ç›¸äº’é…åˆçš„å¤æ‚é€»è¾‘ï¼Œå‡è®¾æ­¤æ—¶ wait æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œå¦‚ä½•å®ç°è®©ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¤šæŠŠé”å‘¢ï¼Ÿåˆå¦‚ä½•æ˜ç¡®çº¿ç¨‹ç­‰å¾…çš„æ˜¯å“ªæŠŠé”å‘¢ï¼Ÿæ—¢ç„¶æ˜¯è®©å½“å‰çº¿ç¨‹å»ç­‰å¾…æŸä¸ªå¯¹è±¡çš„é”ï¼Œè‡ªç„¶åº”è¯¥é€šè¿‡æ“ä½œå¯¹è±¡æ¥å®ç°ï¼Œè€Œä¸æ˜¯æ“ä½œçº¿ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;waitnotify-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒ&#34;&gt;wait/notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒ&lt;/h2&gt;
&lt;p&gt;ç›¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒä»¬éƒ½å¯ä»¥è®©çº¿ç¨‹é˜»å¡ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒä»¬éƒ½å¯ä»¥å“åº” interrupt ä¸­æ–­ï¼šåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¦‚æœæ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œéƒ½å¯ä»¥è¿›è¡Œå“åº”ï¼Œå¹¶æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰å¾ˆå¤šçš„ä¸åŒç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åŒæ­¥ä»£ç ä¸­æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”ï¼Œä½†æ‰§è¡Œ wait æ–¹æ³•æ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”ã€‚&lt;/li&gt;
&lt;li&gt;sleep æ–¹æ³•ä¸­ä¼šè¦æ±‚å¿…é¡»å®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œæ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤ï¼Œè€Œå¯¹äºæ²¡æœ‰å‚æ•°çš„ wait æ–¹æ³•è€Œè¨€ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œå®ƒå¹¶ä¸ä¼šä¸»åŠ¨æ¢å¤ã€‚&lt;/li&gt;
&lt;li&gt;wait/notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
">wait/notify/notifyAll æ–¹æ³•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/gohIUX3YT/"" data-c="
          &lt;h2 id=&#34;çº¿ç¨‹-6-ç§çŠ¶æ€&#34;&gt;çº¿ç¨‹ 6 ç§çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;çº¿ç¨‹æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ Java ä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸€å…±æœ‰ 6 ç§çŠ¶æ€ï¼Œè½¬æ¢å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œå›¾ç‰‡æ¥æºï¼šã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹&lt;br&gt;
&lt;img src=&#34;https://img.flipped.work/img/20210101161850.png&#34;/&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Newï¼ˆæ–°åˆ›å»ºï¼‰&lt;/li&gt;
&lt;li&gt;Runnableï¼ˆå¯è¿è¡Œï¼‰&lt;/li&gt;
&lt;li&gt;Blockedï¼ˆè¢«é˜»å¡ï¼‰&lt;/li&gt;
&lt;li&gt;Waitingï¼ˆç­‰å¾…ï¼‰&lt;/li&gt;
&lt;li&gt;Timed Waitingï¼ˆè®¡æ—¶ç­‰å¾…ï¼‰&lt;/li&gt;
&lt;li&gt;Terminatedï¼ˆè¢«ç»ˆæ­¢ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæƒ³è¦ç¡®å®šçº¿ç¨‹å½“å‰çš„çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ getState() æ–¹æ³•ï¼Œå¹¶ä¸”çº¿ç¨‹åœ¨ä»»ä½•æ—¶åˆ»åªå¯èƒ½å¤„äº 1 ç§çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;new-æ–°åˆ›å»º&#34;&gt;New æ–°åˆ›å»º&lt;/h3&gt;
&lt;p&gt;New è¡¨ç¤ºçº¿ç¨‹è¢«åˆ›å»ºä½†å°šæœªå¯åŠ¨çš„çŠ¶æ€ï¼šå½“ç”¨ new Thread() æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰å¼€å§‹è¿è¡Œ start() æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¼€å§‹æ‰§è¡Œ run() æ–¹æ³•é‡Œé¢çš„ä»£ç ï¼Œé‚£ä¹ˆæ­¤æ—¶å®ƒçš„çŠ¶æ€å°±æ˜¯ Newã€‚è€Œä¸€æ—¦çº¿ç¨‹è°ƒç”¨äº† start()ï¼Œå®ƒçš„çŠ¶æ€å°±ä¼šä» New å˜æˆ Runnableã€‚&lt;/p&gt;
&lt;h3 id=&#34;runnable-å¯è¿è¡Œ&#34;&gt;Runnable å¯è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;Java ä¸­çš„ Runable çŠ¶æ€å¯¹åº”æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ä¸¤ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ Running å’Œ Readyï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒJava ä¸­å¤„äº Runnable çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰æ­£åœ¨æ‰§è¡Œï¼Œæ­£åœ¨ç­‰å¾…è¢«åˆ†é… CPU èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ˜¯ Runnable çŠ¶æ€ï¼Œå½“å®ƒè¿è¡Œåˆ°ä»»åŠ¡çš„ä¸€åŠæ—¶ï¼Œæ‰§è¡Œè¯¥çº¿ç¨‹çš„ CPU è¢«è°ƒåº¦å»åšå…¶ä»–äº‹æƒ…ï¼Œå¯¼è‡´è¯¥çº¿ç¨‹æš‚æ—¶ä¸è¿è¡Œï¼Œå®ƒçš„çŠ¶æ€ä¾ç„¶ä¸å˜ï¼Œè¿˜æ˜¯ Runnableï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½éšæ—¶è¢«è°ƒåº¦å›æ¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é˜»å¡çŠ¶æ€&#34;&gt;é˜»å¡çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;åœ¨ Java ä¸­é˜»å¡çŠ¶æ€é€šå¸¸ä¸ä»…ä»…æ˜¯ Blockedï¼Œå®é™…ä¸Šå®ƒåŒ…æ‹¬ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ Blocked(è¢«é˜»å¡ï¼‰ã€Waiting(ç­‰å¾…ï¼‰ã€Timed Waiting(è®¡æ—¶ç­‰å¾…ï¼‰ï¼Œè¿™ä¸‰ ç§çŠ¶æ€ç»Ÿç§°ä¸ºé˜»å¡çŠ¶æ€ï¼Œä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸‰ç§çŠ¶æ€å…·ä½“æ˜¯ä»€ä¹ˆå«ä¹‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;blocked-è¢«é˜»å¡&#34;&gt;Blocked è¢«é˜»å¡&lt;/h4&gt;
&lt;p&gt;ä»ç®­å¤´çš„æµè½¬æ–¹å‘å¯ä»¥çœ‹å‡ºï¼Œä» Runnable çŠ¶æ€è¿›å…¥ Blocked çŠ¶æ€åªæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿›å…¥ synchronized ä¿æŠ¤çš„ä»£ç ï¼ˆsynchronized ä»£ç å—ï¼Œè¿˜æ˜¯ synchronized æ–¹æ³•ï¼‰æ—¶æ²¡æœ‰æŠ¢åˆ° monitor é”ã€‚&lt;br&gt;
å½“å¤„äº Blocked çš„çº¿ç¨‹æŠ¢åˆ° monitor é”ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ°Runnable çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;waiting-ç­‰å¾…&#34;&gt;Waiting ç­‰å¾…&lt;/h4&gt;
&lt;p&gt;çº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€æœ‰ä¸‰ç§å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;LockSupport.park() æ–¹æ³•ã€‚&lt;br&gt;
Blocked ä»…ä»…é’ˆå¯¹ synchronized monitor é”ï¼Œå¯æ˜¯åœ¨ Java ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é”ï¼Œæ¯”å¦‚ ReentrantLockï¼Œå¦‚æœçº¿ç¨‹åœ¨è·å–è¿™ç§é”æ—¶æ²¡æœ‰æŠ¢åˆ°è¯¥é”å°±ä¼šè¿›å…¥ Waiting çŠ¶æ€ï¼Œå› ä¸ºæœ¬è´¨ä¸Šå®ƒæ‰§è¡Œäº† LockSupport.park() æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ Waiting çŠ¶æ€ã€‚åŒæ ·ï¼ŒObject.wait() å’Œ Thread.join() ä¹Ÿä¼šè®©çº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Blocked ä¸ Waiting çš„åŒºåˆ«æ˜¯ Blocked åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾ monitor é”ï¼Œè€Œ Waiting åˆ™æ˜¯åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼Œæ¯”å¦‚ join çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…æ˜¯ notify()/notifyAll() ã€‚&lt;/p&gt;
&lt;h4 id=&#34;timed-waiting-é™æœŸç­‰å¾…&#34;&gt;Timed Waiting é™æœŸç­‰å¾…&lt;/h4&gt;
&lt;p&gt;Waiting å’Œ Timed Waiting çŠ¶æ€éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºæœ‰æ²¡æœ‰æ—¶é—´é™åˆ¶ï¼ŒTimed Waiting ä¼šç­‰å¾…è¶…æ—¶ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ï¼Œæˆ–è€…åœ¨è¶…æ—¶å‰è¢«å”¤é†’ä¿¡å·å”¤é†’ã€‚&lt;br&gt;
ä»¥ä¸‹æƒ…å†µä¼šè®©çº¿ç¨‹è¿›å…¥ Timed Waiting çŠ¶æ€ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.sleep(long millis) æ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Object.wait(long timeout) æ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.join(long millis) æ–¹æ³•ï¼›&lt;/li&gt;
&lt;li&gt;è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ LockSupport.parkNanos(long nanos) æ–¹æ³•å’Œ LockSupport.parkUntil(long deadline) æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä» Blocked çŠ¶æ€è¿›å…¥ Runnable çŠ¶æ€ï¼Œè¦æ±‚çº¿ç¨‹è·å– monitor é”ã€‚&lt;br&gt;
ä» Waiting çŠ¶æ€æµè½¬åˆ°å…¶ä»–çŠ¶æ€åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸º Waiting æ˜¯ä¸é™æ—¶çš„ï¼Œæ— è®ºè¿‡äº†å¤šé•¿æ—¶é—´å®ƒéƒ½ä¸ä¼šä¸»åŠ¨æ¢å¤ï¼Œåªæœ‰å½“æ‰§è¡Œäº† LockSupport.unpark()ï¼Œæˆ–è€… join çš„çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è€…è¢«ä¸­æ–­æ—¶æ‰å¯ä»¥è¿›å…¥ Runnable çŠ¶æ€ã€‚å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll()æ¥å”¤é†’å®ƒï¼Œå®ƒä¼šç›´æ¥è¿›å…¥ Blocked çŠ¶æ€ï¼Œå› ä¸ºå”¤é†’ Waiting çº¿ç¨‹çš„çº¿ç¨‹å¦‚æœè°ƒç”¨ notify() æˆ– notifyAll()ï¼Œè¦æ±‚å¿…é¡»é¦–å…ˆæŒæœ‰è¯¥ monitor é”ï¼Œæ‰€ä»¥å¤„äº Waiting çŠ¶æ€çš„çº¿ç¨‹è¢«å”¤é†’æ—¶æ‹¿ä¸åˆ°è¯¥é”ï¼Œå°±ä¼šè¿›å…¥ Blocked çŠ¶æ€ï¼Œç›´åˆ°æ‰§è¡Œäº† notify()/notifyAll() çš„å”¤é†’å®ƒçš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾ monitor é”ï¼Œæ‰å¯èƒ½è½®åˆ°å®ƒå»æŠ¢å¤ºè¿™æŠŠé”ï¼Œå¦‚æœå®ƒèƒ½æŠ¢åˆ°ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ° Runnable çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Timed Waiting ä¸­æ‰§è¡Œ notify() å’Œ notifyAll() ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œå®ƒä»¬ä¼šå…ˆè¿›å…¥ Blocked çŠ¶æ€ï¼Œç„¶åæŠ¢å¤ºé”æˆåŠŸåï¼Œå†å›åˆ° Runnable çŠ¶æ€ã€‚å¦‚æœå®ƒçš„è¶…æ—¶æ—¶é—´åˆ°äº†ä¸”èƒ½ç›´æ¥è·å–åˆ°é”/joinçš„çº¿ç¨‹è¿è¡Œç»“æŸ/è¢«ä¸­æ–­/è°ƒç”¨äº†LockSupport.unpark()ï¼Œä¼šç›´æ¥æ¢å¤åˆ° Runnable çŠ¶æ€ï¼Œè€Œæ— éœ€ç»å† Blocked çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;terminated-ç»ˆæ­¢&#34;&gt;Terminated ç»ˆæ­¢&lt;/h3&gt;
&lt;p&gt;è¦æƒ³è¿›å…¥è¿™ä¸ªçŠ¶æ€æœ‰ä¸¤ç§å¯èƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹æ­£å¸¸é€€å‡ºã€‚&lt;/li&gt;
&lt;li&gt;å‡ºç°ä¸€ä¸ªæ²¡æœ‰æ•è·çš„å¼‚å¸¸ï¼Œç»ˆæ­¢äº† run() æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´æ„å¤–ç»ˆæ­¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ³¨æ„ç‚¹&#34;&gt;æ³¨æ„ç‚¹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹çš„çŠ¶æ€æ˜¯éœ€è¦æŒ‰ç…§ç®­å¤´æ–¹å‘æ¥èµ°çš„ï¼Œæ¯”å¦‚çº¿ç¨‹ä» New çŠ¶æ€æ˜¯ä¸å¯ä»¥ç›´æ¥è¿›å…¥ Blocked çŠ¶æ€çš„ï¼Œå®ƒéœ€è¦å…ˆç»å† Runnable çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸å¯é€†ï¼šä¸€æ—¦è¿›å…¥ Runnable çŠ¶æ€å°±ä¸èƒ½å›åˆ° New çŠ¶æ€ï¼›ä¸€æ—¦è¢«ç»ˆæ­¢å°±ä¸å¯èƒ½å†æœ‰ä»»ä½•çŠ¶æ€çš„å˜åŒ–ã€‚æ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€æ¬¡ New å’Œ Terminated çŠ¶æ€ï¼Œåªæœ‰å¤„äºä¸­é—´çŠ¶æ€æ‰å¯ä»¥ç›¸äº’è½¬æ¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
">çº¿ç¨‹çŠ¶æ€</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/0N3BonuMR/"" data-c="
          &lt;h2 id=&#34;å¯åŠ¨çº¿ç¨‹&#34;&gt;å¯åŠ¨çº¿ç¨‹&lt;/h2&gt;
&lt;p&gt;å¯åŠ¨çº¿ç¨‹éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ Thread ç±»çš„ start() æ–¹æ³•ï¼Œå¹¶åœ¨ run() æ–¹æ³•ä¸­å®šä¹‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä½†å¦‚æœæƒ³è¦æ­£ç¡®åœæ­¢å®ƒå°±æ²¡é‚£ä¹ˆç®€å•äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸç†ä»‹ç»&#34;&gt;åŸç†ä»‹ç»&lt;/h2&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ä¼šæ‰‹åŠ¨åœæ­¢çº¿ç¨‹ï¼Œè€Œæ˜¯å…è®¸çº¿ç¨‹è¿è¡Œåˆ°ç»“æŸï¼Œè®©å®ƒè‡ªç„¶åœæ­¢ã€‚ä½†æ˜¯ï¼ŒæŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œéœ€è¦æå‰åœæ­¢çº¿ç¨‹ï¼Œæ¯”å¦‚ç¨‹åºè¿è¡Œå‡ºé”™é‡å¯ç­‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ­£ç¡®åœæ­¢çº¿ç¨‹å°±å¾ˆé‡è¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆä¸å¼ºåˆ¶åœæ­¢&#34;&gt;ä¸ºä»€ä¹ˆä¸å¼ºåˆ¶åœæ­¢&lt;/h2&gt;
&lt;p&gt;æ­£ç¡®åœæ­¢çº¿ç¨‹çš„æ–¹å¼æ˜¯ä½¿ç”¨Â interruptã€‚ä½† interrupt ä»…ä»…èµ·åˆ°é€šçŸ¥è¢«åœæ­¢çº¿ç¨‹çš„ä½œç”¨ã€‚è€Œå¯¹äºè¢«åœæ­¢çº¿ç¨‹è€Œè¨€ï¼Œå®ƒæ—¢å¯ä»¥é€‰æ‹©ç«‹å³åœæ­¢ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸€æ®µæ—¶é—´ååœæ­¢ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å‹æ ¹ä¸åœæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;å¼ºåˆ¶åœæ­¢çº¿ç¨‹å¯èƒ½ä¼šé€ æˆä¸€äº›å®‰å…¨çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šçº¿ç¨‹æ­£åœ¨å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ—¶æ”¶åˆ°ç»ˆæ­¢ä¿¡å·ï¼Œå®ƒå°±éœ€è¦æ ¹æ®è‡ªèº«ä¸šåŠ¡åˆ¤æ–­ï¼Œæ˜¯é€‰æ‹©ç«‹å³åœæ­¢ï¼Œè¿˜æ˜¯å°†æ•´ä¸ªæ–‡ä»¶å†™å…¥æˆåŠŸååœæ­¢ï¼Œå¦‚æœé€‰æ‹©ç«‹å³åœæ­¢å°±å¯èƒ½é€ æˆæ•°æ®ä¸å®Œæ•´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”¨-interrupt-åœæ­¢çº¿ç¨‹&#34;&gt;ç”¨ interrupt åœæ­¢çº¿ç¨‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;whileÂ (!Thread.currentThread().isInterrupted()Â &amp;amp;&amp;amp;Â moreÂ workÂ toÂ do)Â {
Â Â Â Â doÂ moreÂ work
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸€æ—¦è°ƒç”¨çº¿ç¨‹çš„ interrupt() ä¹‹åï¼Œè¿™ä¸ªçº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä½å°±ä¼šè¢«è®¾ç½®æˆ trueã€‚çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œåº”è¯¥å®šæœŸæ£€æŸ¥è¿™ä¸ªæ ‡è®°ä½ï¼Œå¦‚æœæ ‡è®°ä½è¢«è®¾ç½®æˆ trueï¼Œå°±è¯´æ˜æœ‰ç¨‹åºæƒ³ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚å¦‚ä»£ç æ‰€ç¤ºï¼Œåœ¨ while å¾ªç¯ä½“åˆ¤æ–­è¯­å¥ä¸­ï¼Œé¦–å…ˆé€šè¿‡ Thread.currentThread().isInterrupt() åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œéšåæ£€æŸ¥æ˜¯å¦è¿˜æœ‰å·¥ä½œè¦åšã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ classÂ StopThreadÂ implementsÂ RunnableÂ {
Â Â Â Â 
    @Override
Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â intÂ countÂ =Â 0;
Â Â Â Â Â Â Â Â whileÂ (!Thread.currentThread().isInterrupted()Â &amp;amp;&amp;amp;Â countÂ &amp;lt;Â 1000)Â {
Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(&amp;quot;countÂ =Â &amp;quot;Â +Â count++);
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â publicÂ staticÂ voidÂ main(String[]Â args)Â throwsÂ InterruptedExceptionÂ {
Â Â Â Â Â Â Â Â ThreadÂ threadÂ =Â newÂ Thread(newÂ StopThread());
Â Â Â Â Â Â Â Â thread.start();
Â Â Â Â Â Â Â Â Thread.sleep(5);
Â Â Â Â Â Â Â Â thread.interrupt();
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ StopThread ç±»çš„ run() æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œç„¶ååˆ¤æ–­ count å€¼æ˜¯å¦å°äº 1000ã€‚çº¿ç¨‹ä¼šåœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹ä¹‹å‰ï¼Œæ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­äº†ã€‚æ¥ä¸‹æ¥åœ¨ main å‡½æ•°ä¸­ä¼šå¯åŠ¨è¯¥çº¿ç¨‹ï¼Œç„¶åä¼‘çœ  5 æ¯«ç§’åç«‹åˆ»ä¸­æ–­çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šæ£€æµ‹åˆ°ä¸­æ–­ä¿¡å·ï¼Œäºæ˜¯åœ¨è¿˜æ²¡æ‰“å°å®Œ1000ä¸ªæ•°çš„æ—¶å€™å°±ä¼šåœä¸‹æ¥ï¼Œè¿™ç§å°±å±äºé€šè¿‡ interrupt æ­£ç¡®åœæ­¢çº¿ç¨‹çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&#34;sleep-æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­&#34;&gt;sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;RunnableÂ runnableÂ =Â ()Â -&amp;gt;Â {
Â Â Â Â intÂ numÂ =Â 0;
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â whileÂ (!Thread.currentThread().isInterrupted()Â &amp;amp;&amp;amp;Â numÂ &amp;lt;=Â 1000)Â {
Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(num);
Â Â Â Â Â Â Â Â Â Â Â Â num++;
Â Â Â Â Â Â Â Â Â Â Â Â Thread.sleep(1000000);
Â Â Â Â Â Â Â Â }
Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ”¹å†™ä¸Šé¢çš„ä»£ç ï¼Œæ¯æ‰“å°ä¸€ä¸ªæ•°å­—ï¼Œå°±è¿›å…¥ä¸€æ¬¡ sleepï¼Œè€Œæ­¤æ—¶å°† Thread.sleep() çš„ä¼‘çœ æ—¶é—´è®¾ç½®ä¸º 1000 ç§’é’Ÿã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class StopDuringSleep {
 
 Â  Â public static void main(String[] args) throws InterruptedException {
 Â  Â  Â  Â Runnable runnable = () -&amp;gt; {
 Â  Â  Â  Â  Â  Â int num = 0;
 Â  Â  Â  Â  Â  Â try {
 Â   Â  Â  Â  Â  Â  Â while (!Thread.currentThread().isInterrupted() &amp;amp;&amp;amp; num &amp;lt;= 1000){
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â System.out.println(num);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â num++;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Thread.sleep(1000000);
 Â  Â  Â  Â  Â  Â  Â  Â }
 Â  Â  Â  Â  Â  Â } catch (InterruptedException e) {
 Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();
 Â  Â  Â  Â  Â  Â }
 Â  Â  Â  Â };
 Â  Â  Â  Â Thread thread = new Thread(runnable);
 Â  Â  Â  Â thread.start();
 Â  Â  Â  Â Thread.sleep(5);
 Â  Â  Â  Â thread.interrupt();
 Â  Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸»çº¿ç¨‹ä¼‘çœ  5 æ¯«ç§’åï¼Œé€šçŸ¥å­çº¿ç¨‹ä¸­æ–­ï¼Œæ­¤æ—¶å­çº¿ç¨‹ä»åœ¨æ‰§è¡Œ sleep è¯­å¥ï¼Œå¤„äºä¼‘çœ ä¸­ã€‚é‚£ä¹ˆåœ¨ä¼‘çœ ä¸­çš„çº¿ç¨‹æ˜¯å¦èƒ½å¤Ÿæ„Ÿå—åˆ°ä¸­æ–­é€šçŸ¥å‘¢ï¼Ÿæ˜¯å¦éœ€è¦ç­‰åˆ°ä¼‘çœ ç»“æŸåæ‰èƒ½ä¸­æ–­çº¿ç¨‹å‘¢ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œå°±ä¼šå¸¦æ¥ä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºå“åº”ä¸­æ–­å¤ªä¸åŠæ—¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ sleepã€wait ç­‰å¯ä»¥è®©çº¿ç¨‹è¿›å…¥é˜»å¡çš„æ–¹æ³•ä½¿çº¿ç¨‹ä¼‘çœ äº†ï¼Œè€Œå¤„äºä¼‘çœ ä¸­çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆçº¿ç¨‹æ˜¯å¯ä»¥æ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·çš„ï¼Œå¹¶ä¸”ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedException å¼‚å¸¸ï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ï¼Œå°†ä¸­æ–­æ ‡è®°ä½è®¾ç½®æˆ falseã€‚è¿™æ ·ä¸€æ¥å³ä¾¿çº¿ç¨‹è¿˜åœ¨ä¼‘çœ ï¼Œä»ç„¶èƒ½å¤Ÿå“åº”ä¸­æ–­é€šçŸ¥ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ€ä½³å¤„ç†æ–¹å¼&#34;&gt;æœ€ä½³å¤„ç†æ–¹å¼&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•å†…è°ƒç”¨äº† sleep æˆ–è€… wait ç­‰èƒ½å“åº”ä¸­æ–­çš„æ–¹æ³•æ—¶ï¼Œä»…ä»… catch ä½å¼‚å¸¸æ˜¯ä¸å¤Ÿçš„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;voidÂ subTas()Â {
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Thread.sleep(1000);
Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â //Â åœ¨è¿™é‡Œä¸å¤„ç†è¯¥å¼‚å¸¸æ˜¯éå¸¸ä¸å¥½çš„
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨ try/catch æˆ–åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜ throws  InterruptedExceptionã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–¹æ³•ç­¾åæŠ›å¼‚å¸¸run-å¼ºåˆ¶-trycatch&#34;&gt;æ–¹æ³•ç­¾åæŠ›å¼‚å¸¸ï¼Œrun() å¼ºåˆ¶ try/catch&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼Œcatch è¯­å¥å—é‡Œä»£ç æ˜¯ç©ºçš„ï¼Œå®ƒå¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†ã€‚å‡è®¾çº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æ­£åœ¨ sleepï¼Œæ­¤æ—¶æœ‰çº¿ç¨‹å‘é€ interrupt é€šçŸ¥è¯•å›¾ä¸­æ–­çº¿ç¨‹ï¼Œå°±ä¼šç«‹å³æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶æ¸…é™¤ä¸­æ–­ä¿¡å·ã€‚æŠ›å‡ºçš„å¼‚å¸¸è¢« catch è¯­å¥å—æ•æ‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæ•æ‰åˆ°å¼‚å¸¸çš„ catch æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†é€»è¾‘ï¼Œç›¸å½“äºæŠŠä¸­æ–­ä¿¡å·ç»™éšè—äº†ï¼Œè¿™æ ·åšæ˜¯ä¸åˆç†çš„ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿé¦–å…ˆï¼Œå¯ä»¥é€‰æ‹©åœ¨æ–¹æ³•ç­¾åä¸­æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;voidÂ subTask2()Â throwsÂ InterruptedExceptionÂ {
Â Â Â Â Thread.sleep(1000);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä»£ç æ‰€ç¤ºï¼Œè¦æ±‚æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨æ–¹æœ‰ä¹‰åŠ¡å»å¤„ç†å¼‚å¸¸ã€‚è°ƒç”¨æ–¹è¦ä¸ä½¿ç”¨ try/catch å¹¶åœ¨ catch ä¸­æ­£ç¡®å¤„ç†å¼‚å¸¸ï¼Œè¦ä¸å°†å¼‚å¸¸å£°æ˜åˆ°æ–¹æ³•ç­¾åä¸­ï¼Œä¾¿å¯ä»¥å°†ä¸­æ–­ä¿¡å·å±‚å±‚ä¼ é€’åˆ°é¡¶å±‚ï¼Œæœ€ç»ˆè®© run() æ–¹æ³•å¯ä»¥æ•è·åˆ°å¼‚å¸¸ã€‚run() æ–¹æ³•æœ¬èº«æ²¡æœ‰æŠ›å‡º checkedException çš„èƒ½åŠ›ï¼Œåªèƒ½é€šè¿‡ try/catch æ¥å¤„ç†å¼‚å¸¸ï¼Œå°±å¯ä»¥æ ¹æ®ä¸åŒé€»è¾‘æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å†æ¬¡ä¸­æ–­&#34;&gt;å†æ¬¡ä¸­æ–­&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;privateÂ voidÂ reInterrupt()Â {
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Thread.sleep(2000);
Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Thread.currentThread().interrupt();
Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;é™¤äº†å°†å¼‚å¸¸å£°æ˜åˆ°æ–¹æ³•ç­¾åä¸­çš„æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥åœ¨ catch è¯­å¥ä¸­å†æ¬¡ä¸­æ–­çº¿ç¨‹ã€‚å¦‚ä»£ç æ‰€ç¤ºï¼Œéœ€è¦åœ¨ catch è¯­å¥å—ä¸­è°ƒç”¨ Thread.currentThread().interrupt() å‡½æ•°ã€‚å› ä¸ºå¦‚æœçº¿ç¨‹åœ¨ä¼‘çœ æœŸé—´è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨æ¸…é™¤ä¸­æ–­ä¿¡å·ã€‚å¦‚æœè¿™æ—¶æ‰‹åŠ¨æ·»åŠ ä¸­æ–­ä¿¡å·ï¼Œä¸­æ–­ä¿¡å·ä¾ç„¶å¯ä»¥è¢«æ•æ‰åˆ°ã€‚è¿™æ ·åç»­æ‰§è¡Œçš„æ–¹æ³•ä¾ç„¶å¯ä»¥æ£€æµ‹åˆ°è¿™é‡Œå‘ç”Ÿè¿‡ä¸­æ–­ï¼Œå¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ•´ä¸ªçº¿ç¨‹å¯ä»¥æ­£å¸¸é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;ä¸èƒ½ç›²ç›®åæ‰ä¸­æ–­ï¼Œå¦‚æœä¸åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜ï¼Œä¹Ÿä¸åœ¨ catch è¯­å¥å—ä¸­å†æ¬¡æ¢å¤ä¸­æ–­ï¼Œè€Œæ˜¯åœ¨ catch ä¸­ä¸ä½œå¤„ç†ï¼Œä¼šå¯¼è‡´ä¸­æ–­ä¿¡å·è¢«å®Œå…¨å¿½ç•¥ï¼Œæœ€ç»ˆå¯¼è‡´çº¿ç¨‹æ— æ³•æ­£ç¡®åœæ­¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆç”¨-volatile-æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„&#34;&gt;ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„&lt;/h2&gt;
&lt;h3 id=&#34;é”™è¯¯çš„åœæ­¢æ–¹æ³•&#34;&gt;é”™è¯¯çš„åœæ­¢æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆï¼Œçœ‹å‡ ç§åœæ­¢çº¿ç¨‹çš„é”™è¯¯æ–¹æ³•ã€‚æ¯”å¦‚ stop()ï¼Œsuspend() å’Œ resume()ï¼Œè¿™äº›æ–¹æ³•å·²ç»è¢« Java ç›´æ¥æ ‡è®°ä¸º @Deprecatedã€‚å¦‚æœå†è°ƒç”¨è¿™äº›æ–¹æ³•ï¼ŒIDE ä¼šå‹å¥½åœ°æç¤ºï¼Œä¸åº”è¯¥å†ä½¿ç”¨å®ƒä»¬äº†ã€‚ stop() ä¼šç›´æ¥æŠŠçº¿ç¨‹åœæ­¢ï¼Œè¿™æ ·å°±æ²¡æœ‰ç»™çº¿ç¨‹è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†æƒ³è¦åœ¨åœæ­¢å‰ä¿å­˜æ•°æ®çš„é€»è¾‘ï¼Œä¼šå¯¼è‡´å‡ºç°æ•°æ®å®Œæ•´æ€§ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå¯¹äº suspend() å’Œ resume() è€Œè¨€ï¼Œå®ƒä»¬çš„é—®é¢˜åœ¨äºå¦‚æœçº¿ç¨‹è°ƒç”¨ suspend()ï¼Œå®ƒå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå°±å¼€å§‹è¿›å…¥ä¼‘çœ ï¼Œä½†æ­¤æ—¶æœ‰å¯èƒ½ä»æŒæœ‰é”ï¼Œè¿™æ ·å°±å®¹æ˜“å¯¼è‡´æ­»é”é—®é¢˜ï¼Œå› ä¸ºè¿™æŠŠé”åœ¨çº¿ç¨‹è¢« resume() ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«é‡Šæ”¾çš„ã€‚æ‰€ä»¥ suspend() å’Œ resume() ç»„åˆä½¿ç”¨çš„æ–¹æ³•ä¹Ÿè¢«åºŸå¼ƒäº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;volatile-ä¿®é¥°æ ‡è®°ä½é€‚ç”¨çš„åœºæ™¯&#34;&gt;volatile ä¿®é¥°æ ‡è®°ä½é€‚ç”¨çš„åœºæ™¯&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ classÂ VolatileCanStopÂ implementsÂ RunnableÂ {Â 

Â Â Â Â privateÂ volatileÂ booleanÂ canceledÂ =Â false;

Â Â Â Â @Override
Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â intÂ numÂ =Â 0;
Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â whileÂ (!canceledÂ &amp;amp;&amp;amp;Â numÂ &amp;lt;=Â 1000000)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (numÂ %Â 10Â ==Â 0)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(numÂ +Â &amp;quot;æ˜¯10çš„å€æ•°ã€‚&amp;quot;);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â num++;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Thread.sleep(1);
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â publicÂ staticÂ voidÂ main(String[]Â args)Â throwsÂ InterruptedExceptionÂ {
Â Â Â Â Â Â Â Â VolatileCanStopÂ rÂ =Â newÂ VolatileCanStop();
Â Â Â Â Â Â Â Â ThreadÂ threadÂ =Â newÂ Thread(r);
Â Â Â Â Â Â Â Â thread.start();
Â Â Â Â Â Â Â Â Thread.sleep(3000);
Â Â Â Â Â Â Â Â r.canceledÂ =Â true;
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä»£ç æ‰€ç¤ºï¼Œåœ¨å¾ªç¯ä½“ä¸­åˆè¿›è¡Œäº†ä¸¤å±‚åˆ¤æ–­ï¼Œé¦–å…ˆåˆ¤æ–­ canceled å˜é‡çš„å€¼ï¼Œcanceled å˜é‡æ˜¯ä¸€ä¸ªè¢« volatile ä¿®é¥°çš„åˆå§‹å€¼ä¸º false çš„å¸ƒå°”å€¼ï¼Œå½“è¯¥å€¼å˜ä¸º true æ—¶ï¼Œwhile è·³å‡ºå¾ªç¯ï¼Œwhile çš„ç¬¬äºŒä¸ªåˆ¤æ–­æ¡ä»¶æ˜¯ num å€¼å°äº1000000ï¼ˆä¸€ç™¾ä¸‡ï¼‰ï¼Œåœ¨while å¾ªç¯ä½“é‡Œï¼Œåªè¦æ˜¯ 10 çš„å€æ•°å°±æ‰“å°å‡ºæ¥ï¼Œç„¶å num++ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå¯åŠ¨çº¿ç¨‹ï¼Œç»è¿‡ 3 ç§’é’Ÿçš„æ—¶é—´ï¼ŒæŠŠç”¨ volatile ä¿®é¥°çš„å¸ƒå°”å€¼çš„æ ‡è®°ä½è®¾ç½®æˆ trueï¼Œè¿™æ ·ï¼Œæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å°±ä¼šåœ¨ä¸‹ä¸€æ¬¡ while å¾ªç¯ä¸­åˆ¤æ–­å‡º canceled çš„å€¼å·²ç»å˜æˆ true äº†ï¼Œè¿™æ ·å°±ä¸å†æ»¡è¶³ while çš„åˆ¤æ–­æ¡ä»¶ï¼Œè·³å‡ºæ•´ä¸ª while å¾ªç¯ï¼Œçº¿ç¨‹å°±åœæ­¢äº†ï¼Œè¿™ç§æƒ…å†µæ˜¯æ¼”ç¤º volatile ä¿®é¥°çš„æ ‡è®°ä½å¯ä»¥æ­£å¸¸å·¥ä½œçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;h3 id=&#34;volatile-ä¿®é¥°æ ‡è®°ä½ä¸é€‚ç”¨çš„åœºæ™¯&#34;&gt;volatile ä¿®é¥°æ ‡è®°ä½ä¸é€‚ç”¨çš„åœºæ™¯&lt;/h3&gt;
&lt;p&gt;æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼çš„æ¡ˆä¾‹æ¥æ¼”ç¤ºä¸ºä»€ä¹ˆè¯´  volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯ä¸å®Œç¾çš„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;classÂ ProducerÂ implementsÂ RunnableÂ {

Â Â Â Â publicÂ volatileÂ booleanÂ canceledÂ =Â false;

Â Â Â Â BlockingQueueÂ storage;

Â Â Â Â publicÂ Producer(BlockingQueueÂ storage)Â {
Â Â Â Â Â Â Â Â this.storageÂ =Â storage;
Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â intÂ numÂ =Â 0;
Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â whileÂ (numÂ &amp;lt;=Â 100000Â &amp;amp;&amp;amp;Â !canceled)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (numÂ %Â 50Â ==Â 0)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â storage.put(num);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(numÂ +Â &amp;quot;æ˜¯50çš„å€æ•°,è¢«æ”¾åˆ°ä»“åº“ä¸­äº†ã€‚&amp;quot;);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â num++;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }Â catchÂ (InterruptedExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â Â Â Â Â }Â finallyÂ {
Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(&amp;quot;ç”Ÿäº§è€…ç»“æŸè¿è¡Œ&amp;quot;);
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å£°æ˜ä¸€ä¸ªç”Ÿäº§è€… Producerï¼Œé€šè¿‡ volatile æ ‡è®°çš„åˆå§‹å€¼ä¸º false çš„å¸ƒå°”å€¼ canceled æ¥åœæ­¢çº¿ç¨‹ã€‚åœ¨ run() æ–¹æ³•ä¸­ï¼Œwhile çš„åˆ¤æ–­è¯­å¥æ˜¯ num æ˜¯å¦å°äº 100000 åŠ canceled æ˜¯å¦è¢«æ ‡è®°ã€‚while å¾ªç¯ä½“ä¸­åˆ¤æ–­ num å¦‚æœæ˜¯ 50 çš„å€æ•°å°±æ”¾åˆ° storage ä»“åº“ä¸­ï¼Œstorage æ˜¯ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´è¿›è¡Œé€šä¿¡çš„å­˜å‚¨å™¨ï¼Œå½“ num å¤§äº 100000 æˆ–è¢«é€šçŸ¥åœæ­¢æ—¶ï¼Œä¼šè·³å‡º while å¾ªç¯å¹¶æ‰§è¡Œ finally è¯­å¥å—ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;classÂ ConsumerÂ {
Â Â Â Â BlockingQueueÂ storage;
Â Â Â Â publicÂ Consumer(BlockingQueueÂ storage)Â {
Â Â Â Â Â Â Â Â this.storageÂ =Â storage;
Â Â Â Â }
Â Â Â Â publicÂ booleanÂ needMoreNums()Â {
Â Â Â Â Â Â Â Â ifÂ (Math.random()Â &amp;gt;Â 0.97)Â {
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ true;
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¶ˆè´¹è€… Consumer ç”Ÿäº§è€…å…±ç”¨åŒä¸€ä¸ªä»“åº“ storageï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…é€šè¿‡ needMoreNums() æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­ä½¿ç”¨æ›´å¤šçš„æ•°å­—ï¼Œç”Ÿäº§è€…ç”Ÿäº§äº†ä¸€äº› 50 çš„å€æ•°ä¾›æ¶ˆè´¹è€…ä½¿ç”¨ï¼Œæ¶ˆè´¹è€…æ˜¯å¦ç»§ç»­ä½¿ç”¨æ•°å­—çš„åˆ¤æ–­æ¡ä»¶æ˜¯äº§ç”Ÿä¸€ä¸ªéšæœºæ•°å¹¶ä¸ 0.97 è¿›è¡Œæ¯”è¾ƒï¼Œå¤§äº 0.97 å°±ä¸å†ç»§ç»­ä½¿ç”¨æ•°å­—ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ staticÂ voidÂ main(String[]Â args)Â throwsÂ InterruptedExceptionÂ {
Â Â Â Â Â Â Â Â ArrayBlockingQueueÂ storageÂ =Â newÂ ArrayBlockingQueue(8);
Â Â Â Â Â Â Â Â ProducerÂ producerÂ =Â newÂ Producer(storage);
Â Â Â Â Â Â Â Â ThreadÂ producerThreadÂ =Â newÂ Thread(producer);
Â Â Â Â Â Â Â Â producerThread.start();
Â Â Â Â Â Â Â Â Thread.sleep(500);
Â Â Â Â Â Â Â Â ConsumerÂ consumerÂ =Â newÂ Consumer(storage);
Â Â Â Â Â Â Â Â whileÂ (consumer.needMoreNums())Â {
Â Â Â Â Â Â Â Â Â Â Â Â System.out.println(consumer.storage.take()Â +Â &amp;quot;è¢«æ¶ˆè´¹äº†&amp;quot;);
Â Â Â Â Â Â Â Â Â Â Â Â Thread.sleep(100);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â System.out.println(&amp;quot;æ¶ˆè´¹è€…ä¸éœ€è¦æ›´å¤šæ•°æ®äº†ã€‚&amp;quot;);
Â Â Â Â Â Â Â Â //ä¸€æ—¦æ¶ˆè´¹ä¸éœ€è¦æ›´å¤šæ•°æ®äº†ï¼Œæˆ‘ä»¬åº”è¯¥è®©ç”Ÿäº§è€…ä¹Ÿåœä¸‹æ¥ï¼Œä½†æ˜¯å®é™…æƒ…å†µå´åœä¸ä¸‹æ¥
Â Â Â Â Â Â Â Â producer.canceledÂ =Â true;
Â Â Â Â Â Â Â Â System.out.println(producer.canceled);
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;main å‡½æ•°ä¸­åˆ›å»ºäº†ç”Ÿäº§è€…/æ¶ˆè´¹è€…å…±ç”¨çš„ä»“åº“ BlockingQueue storageï¼Œä»“åº“å®¹é‡æ˜¯ 8ï¼Œå¹¶ä¸”å»ºç«‹ç”Ÿäº§è€…å¹¶å°†ç”Ÿäº§è€…æ”¾å…¥çº¿ç¨‹åå¯åŠ¨çº¿ç¨‹ï¼Œå¯åŠ¨åè¿›è¡Œ 500 æ¯«ç§’çš„ä¼‘çœ ï¼Œä¼‘çœ æ—¶é—´ä¿éšœç”Ÿäº§è€…æœ‰è¶³å¤Ÿçš„æ—¶é—´æŠŠä»“åº“å¡æ»¡ï¼Œè€Œä»“åº“è¾¾åˆ°å®¹é‡åå°±ä¸ä¼šå†ç»§ç»­å¾€é‡Œå¡ï¼Œè¿™æ—¶ç”Ÿäº§è€…ä¼šé˜»å¡ï¼Œ500 æ¯«ç§’åæ¶ˆè´¹è€…ä¹Ÿè¢«åˆ›å»ºå‡ºæ¥ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨æ›´å¤šçš„æ•°å­—ï¼Œç„¶åæ¯æ¬¡æ¶ˆè´¹åä¼‘çœ  100 æ¯«ç§’ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ¶ˆè´¹è€…ä¸å†éœ€è¦æ•°æ®ï¼Œå°±ä¼šå°† canceled çš„æ ‡è®°ä½è®¾ç½®ä¸º trueï¼Œç†è®ºä¸Šæ­¤æ—¶ç”Ÿäº§è€…ä¼šè·³å‡º while å¾ªç¯ï¼Œå¹¶æ‰“å°è¾“å‡ºâ€œç”Ÿäº§è€…è¿è¡Œç»“æŸâ€ã€‚ç»“æœå´æ˜¯ï¼Œè™½ç„¶æŠŠ canceled è®¾ç½®æˆ trueï¼Œä½†ç”Ÿäº§è€…ä»ç„¶æ²¡æœ‰åœæ­¢ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…åœ¨æ‰§è¡Œ storage.put(num) æ—¶å‘ç”Ÿé˜»å¡ï¼Œåœ¨å®ƒè¢«å«é†’ä¹‹å‰æ˜¯æ²¡æœ‰åŠæ³•è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯åˆ¤æ–­ canceled çš„å€¼çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ç”¨ volatile æ˜¯æ²¡æœ‰åŠæ³•è®©ç”Ÿäº§è€…åœä¸‹æ¥çš„ï¼Œç›¸åå¦‚æœç”¨ interrupt è¯­å¥æ¥ä¸­æ–­ï¼Œå³ä½¿ç”Ÿäº§è€…å¤„äºé˜»å¡çŠ¶æ€ï¼Œä»ç„¶èƒ½å¤Ÿæ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·ï¼Œå¹¶åšå“åº”å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
">åœæ­¢çº¿ç¨‹</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/X4Fq8787p/"" data-c="
          &lt;p&gt;å®ç°çº¿ç¨‹çš„æ–¹å¼åˆ°åº•æœ‰å‡ ç§ï¼Ÿå¤§éƒ¨åˆ†äººä¼šè¯´æœ‰ 2 ç§ã€3 ç§æˆ–æ˜¯ 4 ç§ï¼Œå…¶å®å®ç°çº¿ç¨‹çš„æ–¹æ³•åªæœ‰ 1 ç§ã€‚2 ç§å®ç°æ–¹å¼çš„æè¿°æ˜¯æœ€åŸºæœ¬çš„ï¼Œä¹Ÿæ˜¯æœ€ä¸ºç†ŸçŸ¥çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°-runnable-æ¥å£&#34;&gt;å®ç° Runnable æ¥å£&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ classÂ RunnableThreadÂ implementsÂ RunnableÂ {

Â Â Â @Override
Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â System.out.println(&#39;ç”¨å®ç°Runnableæ¥å£å®ç°çº¿ç¨‹&#39;);
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ 1 ç§æ–¹å¼æ˜¯å®ç° Runnable æ¥å£ï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼ŒRunnableThread ç±»å®ç° Runnable æ¥å£ï¼Œé‡å†™ run() æ–¹æ³•ã€‚åªéœ€è¦æŠŠ RunnableThread çš„å®ä¾‹ä¼ åˆ° Thread ç±»å°±å¯ä»¥å®ç°å¤šçº¿ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»§æ‰¿-thread-ç±»&#34;&gt;ç»§æ‰¿ Thread ç±»&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;publicÂ classÂ ExtendsThreadÂ extendsÂ ThreadÂ {

Â Â Â  @Override
Â Â Â Â publicÂ voidÂ run()Â {
Â Â Â Â Â Â Â Â System.out.println(&#39;ç”¨Threadç±»å®ç°çº¿ç¨‹&#39;);
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ 2 ç§æ–¹å¼æ˜¯ç»§æ‰¿ Thread ç±»ï¼Œå¹¶é‡å†™ run() æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;çº¿ç¨‹æ± åˆ›å»º&#34;&gt;çº¿ç¨‹æ± åˆ›å»º&lt;/h2&gt;
&lt;p&gt;ç¬¬ 3 ç§æ–¹å¼é€šè¿‡çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ã€‚çº¿ç¨‹æ± çš„ç¡®å®ç°äº†å¤šçº¿ç¨‹ï¼Œæ¯”å¦‚ç»™çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡è®¾ç½®æˆ 10ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ 10 ä¸ªå­çº¿ç¨‹æ¥å·¥ä½œã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;static class DefaultThreadFactory implements ThreadFactory {
        private static final AtomicInteger poolNumber = new AtomicInteger(1);
        private final ThreadGroup group;
        private final AtomicInteger threadNumber = new AtomicInteger(1);
        private final String namePrefix;

        DefaultThreadFactory() {
            SecurityManager s = System.getSecurityManager();
            group = (s != null) ? s.getThreadGroup() :
                                  Thread.currentThread().getThreadGroup();
            namePrefix = &amp;quot;pool-&amp;quot; +
                          poolNumber.getAndIncrement() +
                         &amp;quot;-thread-&amp;quot;;
        }

        public Thread newThread(Runnable r) {
            Thread t = new Thread(group, r,
                                  namePrefix + threadNumber.getAndIncrement(),
                                  0);
            if (t.isDaemon())
                t.setDaemon(false);
            if (t.getPriority() != Thread.NORM_PRIORITY)
                t.setPriority(Thread.NORM_PRIORITY);
            return t;
        }
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çº¿ç¨‹æ± é€šè¿‡çº¿ç¨‹å·¥å‚ï¼ˆé»˜è®¤é‡‡ç”¨ DefaultThreadFactoryï¼‰åˆ›å»ºçº¿ç¨‹ ï¼Œå®ƒä¼šç»™çº¿ç¨‹è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œæ¯”å¦‚ï¼Œçº¿ç¨‹çš„åå­—ã€æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œä»¥åŠçº¿ç¨‹çš„ä¼˜å…ˆçº§ç­‰ï¼Œä½†æœ€ç»ˆé€šè¿‡ new Thread() åˆ›å»ºçº¿ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ‰è¿”å›å€¼çš„-callable-åˆ›å»ºçº¿ç¨‹&#34;&gt;æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;classÂ CallableTaskÂ implementsÂ Callable&amp;lt;Integer&amp;gt;Â {

Â Â Â @Override
Â Â Â Â publicÂ IntegerÂ call()Â throwsÂ ExceptionÂ {
Â Â Â Â Â Â Â Â returnÂ newÂ Random().nextInt();
Â Â Â Â }
}
//åˆ›å»ºçº¿ç¨‹æ± 
ExecutorServiceÂ serviceÂ =Â Executors.newFixedThreadPool(10);
//æäº¤ä»»åŠ¡ï¼Œå¹¶ç”¨Â Futureæäº¤è¿”å›ç»“æœ
Future&amp;lt;Integer&amp;gt;Â futureÂ =Â service.submit(newÂ CallableTask());
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ 4 ç§çº¿ç¨‹åˆ›å»ºæ–¹å¼é€šè¿‡æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹ï¼ŒRunnable åˆ›å»ºçº¿ç¨‹æ— è¿”å›å€¼ï¼ŒCallable å’Œä¸ä¹‹ç›¸å…³çš„ Futureã€FutureTaskï¼Œå¯ä»¥æŠŠçº¿ç¨‹æ‰§è¡Œçš„ç»“æœä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œå®ç°äº† Callable æ¥å£ï¼Œå®ƒçš„æ³›å‹è®¾ç½®æˆ Integerï¼Œç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ªéšæœºæ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œæ— è®ºæ˜¯ Callable è¿˜æ˜¯ FutureTaskï¼Œå’Œ Runnable ä¸€æ ·ï¼Œéƒ½æ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ï¼Œå®ƒä»¬æœ¬èº«ä¸æ˜¯çº¿ç¨‹ï¼Œå®ƒä»¬å¯ä»¥æ”¾åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œ submit() æ–¹æ³•æŠŠä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶ç”±çº¿ç¨‹æ± åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œï¼Œè€Œå­çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼æ˜¯å®ç° Runnable æ¥å£å’Œç»§æ‰¿ Thread ç±»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°çº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼&#34;&gt;å®ç°çº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼&lt;/h2&gt;
&lt;p&gt;å…ˆè®¤ä¸ºæœ‰ä¸¤ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆå…¶ä»–æ¯”å¦‚çº¿ç¨‹æ± ï¼Œæ˜¯åœ¨ new Thread() å¤–åšäº†ä¸€å±‚å°è£…ï¼Œæœ€ç»ˆéƒ½æ˜¯åŸºäº Runnable æ¥å£æˆ–ç»§æ‰¿ Thread ç±»å®ç°ï¼‰ï¼Œä¸ºä»€ä¹ˆè¯´è¿™ä¸¤ç§æ–¹å¼æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Override
publicÂ voidÂ run()Â {
Â Â Â Â ifÂ (targetÂ !=Â null)Â {
Â Â Â Â Â Â Â Â target.run();
Â Â Â Â }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å®ç° Runnable æ¥å£æ–¹å¼ã€‚å¯åŠ¨çº¿ç¨‹éœ€è¦è°ƒç”¨ start() æ–¹æ³•ï¼Œè€Œ start() æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ run() æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ–¹å¼ä¸­ ç¬¬ 1 è¡Œä»£ç  if (target != null) ï¼Œåˆ¤æ–­ target æ˜¯å¦ç­‰äº nullï¼Œå¦‚æœä¸ç­‰äº nullï¼Œå°±æ‰§è¡Œç¬¬ 2 è¡Œä»£ç  target.run()ï¼Œè€Œ target å®é™…ä¸Šæ˜¯ä¸€ä¸ª Runnableï¼Œå³ä½¿ç”¨ Runnable æ¥å£å®ç°çº¿ç¨‹æ—¶ä¼ ç»™Threadç±»çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿ Thread æ–¹å¼ï¼Œä¼šæŠŠä¸Šè¿°çš„ run() æ–¹æ³•é‡å†™ï¼Œé‡å†™å run() æ–¹æ³•é‡Œç›´æ¥å°±æ˜¯æ‰€éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæœ€ç»ˆè°ƒç”¨ thread.start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼Œè€Œ start() æ–¹æ³•æœ€ç»ˆä¹Ÿä¼šè°ƒç”¨è¿™ä¸ªå·²ç»è¢«é‡å†™çš„ run() æ–¹æ³•æ¥æ‰§è¡Œå®ƒçš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå®ç°çº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼ï¼Œè€Œè¦æƒ³å®ç°çº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ï¼Œå´æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥é€šè¿‡ å®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œæˆ–æ˜¯ç»§æ‰¿ Thread ç±»é‡å†™ run() æ–¹æ³•çš„æ–¹å¼ï¼ŒæŠŠæƒ³è¦æ‰§è¡Œçš„ä»£ç ä¼ å…¥ï¼Œè®©çº¿ç¨‹å»æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®ç°-runnable-æ¥å£æ¯”ç»§æ‰¿-thread-ç±»å®ç°çº¿ç¨‹è¦å¥½&#34;&gt;å®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½&lt;/h2&gt;
&lt;p&gt;ç°åœ¨å¯¹ä¸¤ç§å®ç°çº¿ç¨‹çš„æ–¹å¼è¿›è¡Œå¯¹æ¯”ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼ŒRunnable é‡Œåªæœ‰ä¸€ä¸ª run() æ–¹æ³•ï¼Œå®ƒå®šä¹‰äº†éœ€è¦æ‰§è¡Œçš„å†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå®ç°äº† Runnable ä¸ Thread ç±»çš„è§£è€¦ï¼ŒThread ç±»è´Ÿè´£çº¿ç¨‹å¯åŠ¨å’Œå±æ€§è®¾ç½®ç­‰å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç‚¹å°±æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½¿ç”¨ç»§æ‰¿ Thread ç±»æ–¹å¼ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå¦‚æœæ­¤æ—¶æ‰§è¡Œçš„å†…å®¹æ¯”è¾ƒå°‘ä¸”éœ€è¦å¤šæ¬¡æ‰§è¡Œï¼Œåˆ›å»ºçº¿ç¨‹ã€é”€æ¯çº¿ç¨‹ï¼Œè¿™äº›æ“ä½œæ“ä½œæ¯” run() æ–¹æ³•æœ¬èº«å¼€é”€è¦å¤§å¾—å¤šã€‚å¦‚æœä½¿ç”¨å®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œå°±å¯ä»¥æŠŠä»»åŠ¡ç›´æ¥ä¼ å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ï¼Œä¸éœ€è¦æ¯æ¬¡æ–°å»ºé”€æ¯çº¿ç¨‹ï¼Œå¤§å¤§é™ä½äº†æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ç‚¹å¥½å¤„åœ¨äº Java è¯­è¨€ä¸æ”¯æŒåŒç»§æ‰¿ï¼Œå¦‚æœä¸€æ—¦ç»§æ‰¿äº† Thread ç±»ï¼Œé‚£ä¹ˆå®ƒåç»­å°±æ²¡æœ‰åŠæ³•å†ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œå¦‚æœæœªæ¥è¿™ä¸ªç±»éœ€è¦ç»§æ‰¿å…¶ä»–ç±»å®ç°ä¸€äº›åŠŸèƒ½ä¸Šçš„æ‹“å±•ï¼Œå®ƒå°±æ²¡æœ‰åŠæ³•åšåˆ°äº†ï¼Œé™åˆ¶äº†ä»£ç æœªæ¥çš„å¯æ‹“å±•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œåº”è¯¥ä¼˜å…ˆé€‰æ‹©é€šè¿‡å®ç° Runnable æ¥å£çš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ã€‚&lt;/p&gt;
">å®ç°çº¿ç¨‹çš„æ–¹æ³•</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;h2 id=&#34;å…´è¶£çˆ±å¥½&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
">å…³äº</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://flipped94.github.io/post/hello-gridea/"" data-c="
          &lt;p&gt;ğŸ‘  æ¬¢è¿ä½¿ç”¨ &lt;strong&gt;Gridea&lt;/strong&gt; ï¼&lt;br&gt;
âœï¸  &lt;strong&gt;Gridea&lt;/strong&gt; ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/getgridea/gridea&#34;&gt;Github&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://gridea.dev/&#34;&gt;Gridea ä¸»é¡µ&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;http://fehey.com/&#34;&gt;ç¤ºä¾‹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹æ€§&#34;&gt;ç‰¹æ€§ğŸ‘‡&lt;/h2&gt;
&lt;p&gt;ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ &lt;strong&gt;Markdown&lt;/strong&gt; è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ&lt;/p&gt;
&lt;p&gt;ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡&lt;/p&gt;
&lt;p&gt;ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„&lt;/p&gt;
&lt;p&gt;ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•&lt;/p&gt;
&lt;p&gt;ğŸ’»  ä½ å¯ä»¥åœ¨ &lt;strong&gt;Windows&lt;/strong&gt;ï¼Œ&lt;strong&gt;MacOS&lt;/strong&gt; æˆ– &lt;strong&gt;Linux&lt;/strong&gt; è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯&lt;/p&gt;
&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ &lt;strong&gt;ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ&lt;/strong&gt; æˆ– &lt;strong&gt;Coding Pages&lt;/strong&gt; å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°&lt;/p&gt;
&lt;p&gt;ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ &lt;a href=&#34;https://github.com/gitalk/gitalk&#34;&gt;Gitalk&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/SukkaW/DisqusJS&#34;&gt;DisqusJS&lt;/a&gt; è¯„è®ºç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨&lt;strong&gt;ä¸­æ–‡ç®€ä½“&lt;/strong&gt;æˆ–&lt;strong&gt;è‹±è¯­&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›&lt;/p&gt;
&lt;p&gt;ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥&lt;/p&gt;
&lt;p&gt;ğŸŒ± å½“ç„¶ &lt;strong&gt;Gridea&lt;/strong&gt; è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ&lt;/p&gt;
&lt;p&gt;æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´&lt;/p&gt;
&lt;p&gt;å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼&lt;/p&gt;
&lt;p&gt;ğŸ˜˜ Enjoy~&lt;/p&gt;
">Hello Gridea</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + 'ç§’ä¹‹å‰';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + 'åˆ†é’Ÿä¹‹å‰';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + 'å°æ—¶ä¹‹å‰';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + 'å¤©ä¹‹å‰';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = '';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 200
  });
</script>





</html>